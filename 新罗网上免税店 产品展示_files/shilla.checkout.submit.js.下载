(function(c){var b=false;var a=false;var d=new Map();d.put("UBC","unionpay,unionpay-noncert");d.put("TEN","tenpay");d.put("PPL","paypal");d.put("WXN","wechatpay");d.put("WXH","wechatpay-hana");d.put("WXS","wechatpay-smartro");d.put("WXT","wechatpay-tnu");d.put("ALP","alipay-direct,cn-alipay-KICC");d.put("QUP","quickpay");d.put("BSP","bestpay");c.ShillaSubmit={options:{nationalityCode:"",krAccessYn:"",contextPath:"",hasToken:false},url:{notReceivedUrl:"/checkout/checkoutNotReceivedOrderCnt",passportUrl:"/checkout/validatePassport",flightSchedule:"/checkout/checkoutFlightSchedule",orderValidateUrl:"/checkout/validate",wechatValidateUrl:"/checkout/ajaxValidateAppVersionForWechat",passportPatternUrl:"/checkout/validatePassportPattern"},paymentMsg:"根据出境地不同，可能会从赠品领取对象中排除,赠送与否可在结算后进行确认。\n请注意，以上出国信息不正确的状况下无法领取商品。\n您确定现在要结算了吗?",wechatMsg:"微信支付付款系统升级了。要继续进行付款的话，请升级至新罗网上免税店应用最新版本。",init:function(e){this.options=c.extend({nationalityCode:"",krAccessYn:"",contextPath:"",hasToken:false},e||{})},getUrl:function(f){var e=this.options.contextPath+c.ShillaSubmit.url[f];return e},getDepartureInfoStr:function(h){var g=c("#orderForm");var p=c(g).find("input[name=psprtNo]").val();var r=c("#airport option:selected").text();var k=c(g).find("input[name=depDate]").val();var l=c(g).find("input[name=depTime]").val();var i=c(g).find("input[name=flightNo]").val();var n=k.substring(0,4);var j=k.substring(4,6);var o=k.substring(6,8);var f=n+"-"+j+"-"+o;var s=l.substring(0,2);var q=l.substring(2);var e=s+":"+q;var m="您的护照号码 : "+p+"\n出境信息 : "+r+"\n航班号: "+i+"\n出境日期 : "+f+" "+e+"\n";if(typeof(h)!="undefined"){m+=h}return m},checkOffer:function(e){var f=true;if(!c.ShillaSubmit.checkCartCoupon(e)){f=false}if(!c.ShillaSubmit.checkLimitMilage(e)||!c.ShillaSubmit.checkLimitAllianceMilage(e)){f=false}if(!c.ShillaSubmit.checkAddtionalMilage(e)){f=false}if(!c.ShillaSubmit.checkMobileMilage(e)){f=false}return f},checkOffrUseCard:function(g,e,i){if(g!=""){if(d.containsKey(g)){if(g!="WXT"){if(e=="wechatpay-hana"||e=="wechatpay-smartro"||e=="wechatpay-tnu"){e="wechatpay"}}if(e==""||d.get(g).indexOf(e)==-1){alert(i);return false}}else{var f=c("#orderForm").find("input[name=wonPaySumAmt]").val();if(f==0){alert(i);return false}else{var h=c("#orderForm").find("input[name=cardIssueCmpyCode]").val();if(h!=g){alert(i);return false}}}}return true},checkCartCoupon:function(e){if(MiniCalculator.data.appliedCartCoupon&&MiniCalculator.data.appliedCartCoupon!="undefined"&&MiniCalculator.data.appliedCartCoupon!=null){var g=MiniCalculator.data.appliedCartCoupon.offerusecardissurcd;if(g!=""&&g!="undefined"){var f=c.ShillaSubmit.getOffUseCardIssurTxt(g);var h="若要使用追加优惠积分，请选择以 ["+f+"]付款。";if(!c.ShillaSubmit.checkOffrUseCard(g,e,h)){return false}}return true}return true},getOffUseCardIssurTxt:function(f){var e="";switch(f){case"UBC":e="中国银联卡 or 银联信用卡";break;case"TEN":e="财付通(Tenpay)";break;case"PPL":e="贝宝(PAYPAL)";break;case"WXN":e="微信支付";break;case"WXH":e="微信支付";break;case"WXS":e="微信支付";break;case"WXT":e="微信支付(公众号)";break;case"ALP":e="支付宝(Alipay)";break;case"QUP":e="银联无跳转支付";break;case"BSP":e="翼支付";break;default:e=c("#defaultCreditCard option[value='"+f+"']").text()}return e},checkLimitMilage:function(e){var i=c("#orderForm");var f=c(i).find("select[name=limitMileageIds] option:selected").index();if(f>0){var j=c(i).find("select[name=limitMileageIds] option:selected").data();var h=j.offerusecardissurcd;if(h!=""){var g=c.ShillaSubmit.getOffUseCardIssurTxt(h);var k="若要使用银联在线活动积分，请选择以["+g+"]付款。";if(!c.ShillaSubmit.checkOffrUseCard(h,e,k)){return false}return true}return true}return true},checkLimitAllianceMilage:function(e){var i=c("#orderForm");var f=c(i).find("select[name=limitAllianceMileageIds] option:selected").index();if(f>0){var j=c(i).find("select[name=limitAllianceMileageIds] option:selected").data();var h=j.offerusecardissurcd;if(h!=""){var g=c.ShillaSubmit.getOffUseCardIssurTxt(h);var k="若要使用银联在线活动积分，请选择以["+g+"]付款。";if(!c.ShillaSubmit.checkOffrUseCard(h,e,k)){return false}return true}return true}return true},checkAddtionalMilage:function(e){var i=c("#orderForm");var f=c(i).find("select[name=additionalMileageId] option:selected").index();if(f>0){var j=c(i).find("select[name=additionalMileageId] option:selected").data();var h=j.offerusecardissurcd;if(h!=""){var g=c.ShillaSubmit.getOffUseCardIssurTxt(h);var k="若要使用特惠积分，请选择["+g+"]付款。";if(!c.ShillaSubmit.checkOffrUseCard(h,e,k)){return false}return true}return true}return true},checkMobileMilage:function(e){var h=c("#orderForm");if(c("#mobMlgDataOfferUsecardIssurcd").val()!=undefined&&c("#totalUsedMobileMileage2").val()>0){var g=c("#mobMlgDataOfferUsecardIssurcd").val();if(g!=""){var f=c.ShillaSubmit.getOffUseCardIssurTxt(g);var i="若要使用合作积分，请选择["+f+"]付款。";if(!c.ShillaSubmit.checkOffrUseCard(g,e,i)){return false}return true}return true}return true},submitHandler:function(f){console.log("Submit Handler");if(b){return false}b=true;if(a){alert(c.ShillaCheckout.getMessage("PA902"));b=false;return false}MiniCalculator.calculatePrice();if(!c.ShillaSubmit.checkDepartureInfo(f)){b=false;return false}if(!c.ShillaSubmit.checkUserInfo(f)){b=false;return false}if(!c.ShillaSubmit.checkOrderDate(f)){b=false;return false}if(!c.ShillaSubmit.checkPassportInfo(f)){b=false;return false}if(!c.ShillaSubmit.checkDeliveryMsg(f)){b=false;return false}var g=c("#orderForm").find("input[name=depPlaceCode]").val();if(g=="CS"){if(!c.ShillaSubmit.privacyCheckAgree()){b=false;return false}}if(!c.ShillaSubmit.checkAgree()){b=false;return false}if(!c.ShillaSubmit.checkDeliveryInfo()){b=false;return false}var e=c(f).find("input[name=nationalityCode]").val();if(e=="HKG"){if(confirm("商品取货时，必须带明示中国国籍的护照。如您点击付款完成按钮，并将看同意进行'中国'国籍订购。如您有其他问题，请咨询客服中心。")){}else{b=false;return false}}c.ShillaSubmit.wechatValidate(f,function(h){if(h&&h.result=="fail"){alert(c.ShillaSubmit.wechatMsg);b=false;return false}else{c.ShillaSubmit.checkValidatePassportCnt(f,function(i){if(i&&i>0){alert(c.ShillaCheckout.getMessage("PA107"));b=false;return false}else{c.ShillaSubmit.checkFlightSchedule(f,function(l){if(l){if("fail"==l.result){alert(c.ShillaCheckout.getMessage("PA109"));b=false;return false}else{var j=c.ShillaSubmit.setPaymentAmount(f);var k=false;if(j>0){k=c.ShillaSubmit.cardPayment(f);if(!k){b=false;return false}}else{if(j==0){c(f).find("input[name=payWayCode]").val("");if(!c.ShillaSubmit.checkOffer("")){b=false;return false}}else{alert("买这个数额是不正确。\n请再次检查");b=false;return false}}c.ShillaSubmit.orderValdate(f,function(r){if(!r||r.isSuccess!="true"){var s=c("<div>").html(r.message).text().replace("\\n","\n");alert(s);c.ShillaSubmit.cancelPayment();return false}else{a=true;var x=c(f).find("input[name=nationalityCode]").val();if(x=="OTH"){alert("以其他国籍注册的顾客中，国籍为中国、中国香港、中国台湾的顾客，请在购买商品前变更国籍。\n若出现与实际国籍不符，提货时将无法正常进行交货。")}if(j>0){var n=c("#confirmMsg").val();if(confirm(n)){var t=c(f).find("input[name=dateOfBirth]").val();var w=computeAge(t);if(w<19){if(confirm("针对客户购买商品未经其法定代理人的同意，可由客户或法定代理人取消购买。")){}else{c.ShillaSubmit.cancelPayment();return false}}if(k){var p=c(f).find("input[name=selPayCardChk]:checked").data();var q=p.code.replace("cn-","");var v=p.provider;var m=p.paywaycode;if(m==""){alert("payWayCode is NULL");c.ShillaSubmit.cancelPayment();return false}if(q=="krp-global-creditCard"){var o=c(f).find("input[name=tenPayMethod]").val();if(o=="P101"||o=="P102"||o=="P104"){p=c(f).find("input[name=mcp]").data();q=p.code.replace("cn-","");v=p.provider;m=p.paywaycode}}if("KICC"==v){if("unionpay"==q){c.ShillaSubmit.easypayUpopPaymentRequest(m,f);b=false;return false}else{if("alipay-KICC"==q){c.ShillaSubmit.alipayPaymentKiccRequest(p.paywaycode,q)}else{if("71"==p.paywaycode||"73"==p.paywaycode){c.ShillaSubmit.easypayAlipayPaymentRequest(p.paywaycode)}else{c.ShillaSubmit.easypayPaymentRequest(m,f);b=false;return false}}}}else{if(p.paywaycode==30){c.ShillaSubmit.alipayPaymentRequest(p.paywaycode,q);b=false;return false}else{if(p.paywaycode==46){c.ShillaSubmit.alliexPaymentRequest(p.paywaycode,q,f);b=false;return false}else{if(p.paywaycode==61){c.ShillaSubmit.smartroPaymentRequest(p.paywaycode,q,f);b=false;return false}else{if(p.paywaycode==54){c.ShillaSubmit.tnuPaymentRequest(p.paywaycode,q,f);b=false;return false}else{if(p.paywaycode==31){c.ShillaSubmit.kcpPaymentRequest(m,f)}else{if("KRP"==v||"KRC"==v){c.ShillaSubmit.tenpayPaymentRequest(m,q,f);b=false;return false}}}}}}}}else{c.ShillaSubmit.cancelPayment();return false}return false}else{a=false;b=false;c.ShillaSubmit.closeProgressDialog();return false}return false}else{var u=c.ShillaSubmit.getDepartureInfoStr();var y=u+c.ShillaCheckout.getMessage("PA904");if(confirm(y)){c.ShillaSubmit.nocardPayment(f)}else{c.ShillaSubmit.cancelPayment();return false}}}})}}})}})}})},tenpayPaymentRequest:function(f,e,i){var h="0";var g=c.ShillaCheckout.getUrl("prePayment");if(c.ShillaSubmit.isKrwPayment(e)){h=c(i).find("input[name=wonPaySumAmt]").val()}else{h=c(i).find("input[name=usdPaySumAmt]").val()}c(i).find("input[name=payWayCode]").val(f);c(i).find("input[name=paymethod]").val(c(i).find("input[name=tenPayMethod]").val());c(i).find("input[name=amt]").val(h);c.ajax({url:g,type:"POST",data:c(i).serialize(),timeout:5000,async:false,error:function(l,j,k){},statusCode:{},success:function(l){if(l.isSuccess){c("#tenpayForm").find("input[name=payWayCode]").val(f);c("#tenpayForm").find("input[name=paymethod]").val(c(i).find("input[name=tenPayMethod]").val());c("#tenpayForm").find("input[name=amt]").val(h);c("#tenpayForm").find("input[name=orderNo]").val(l.orderNo);if(c.ShillaSubmit.isKrwPayment(e)){c("#tenpayForm").find("input[name=cur]").val("KRW")}var j=c(i).find("input[name=isAppConnect]").val();if(j=="true"&&"WXN"==c(i).find("input[name=cardIssueCmpyCode]").val()){c("#tenpayForm").find("input[name=appid]").val(c(i).find("input[name=appid]").val())}c("#tenpayForm").submit()}else{var k="故障发生在与服务器的通信。";if(l.message){k=k+"\n"+l.message}alert(l.message);c.ShillaSubmit.cancelPayment()}}})},alliexPaymentRequest:function(f,e,i){var h="0";var g=c.ShillaCheckout.getUrl("alliexPrePayment");if(c.ShillaSubmit.isKrwPayment(e)){h=c(i).find("input[name=wonPaySumAmt]").val()}else{h=c(i).find("input[name=usdPaySumAmt]").val()}c(i).find("input[name=payWayCode]").val(f);c(i).find("input[name=paymethod]").val(c(i).find("input[name=tenPayMethod]").val());c(i).find("input[name=amt]").val(h);c.ajax({url:g,type:"POST",data:c(i).serialize(),timeout:5000,async:false,error:function(l,j,k){},statusCode:{},success:function(l){if(l.isSuccess){c("#alliexForm").find("input[name=payWayCode]").val(f);c("#alliexForm").find("input[name=ProcessType]").val(c(i).find("input[name=tenPayMethod]").val());c("#alliexForm").find("input[name=MerchantAmount]").val(h);c("#alliexForm").find("input[name=MerchantTransID]").val(l.orderNo);if(c.ShillaSubmit.isKrwPayment(e)){c("#alliexForm").find("input[name=MerchantCurrency]").val("KRW")}var j=c(i).find("input[name=isAppConnect]").val();if(j=="true"&&"WXH"==c(i).find("input[name=cardIssueCmpyCode]").val()){c("#alliexForm").find("input[name=MobileType]").val(c(i).find("input[name=appid]").val())}c("#alliexForm").submit()}else{var k="故障发生在与服务器的通信。";if(l.message){k=k+"\n"+l.message}alert(l.message);c.ShillaSubmit.cancelPayment()}}})},smartroPaymentRequest:function(f,e,i){var h="0";var g=c.ShillaCheckout.getUrl("smartroPrePayment");if(c.ShillaSubmit.isKrwPayment(e)){h=c(i).find("input[name=wonPaySumAmt]").val()}else{h=c(i).find("input[name=usdPaySumAmt]").val()}c(i).find("input[name=payWayCode]").val(f);c(i).find("input[name=paymethod]").val(c(i).find("input[name=tenPayMethod]").val());c(i).find("input[name=amt]").val(h);c.ajax({url:g,type:"POST",data:c(i).serialize(),timeout:5000,async:false,error:function(l,j,k){},statusCode:{},success:function(l){if(l.isSuccess){c("#smartroForm").find("input[name=payWayCode]").val(f);c("#smartroForm").find("input[name=ProcessType]").val(c(i).find("input[name=tenPayMethod]").val());c("#smartroForm").find("input[name=MerchantAmount]").val(h);c("#smartroForm").find("input[name=MerchantTransID]").val(l.orderNo);if(c.ShillaSubmit.isKrwPayment(e)){c("#smartroForm").find("input[name=MerchantCurrency]").val("KRW")}var j=c(i).find("input[name=isAppConnect]").val();if(j=="true"&&"WXH"==c(i).find("input[name=cardIssueCmpyCode]").val()){c("#smartroForm").find("input[name=MobileType]").val(c(i).find("input[name=appid]").val())}c("#smartroForm").submit()}else{var k="故障发生在与服务器的通信。";if(l.message){k=k+"\n"+l.message}alert(l.message);c.ShillaSubmit.cancelPayment()}}})},tnuPaymentRequest:function(f,e,i){var h="0";var g=c.ShillaCheckout.getUrl("tnuPrePayment");if(c.ShillaSubmit.isKrwPayment(e)){h=c(i).find("input[name=wonPaySumAmt]").val()}else{h=c(i).find("input[name=usdPaySumAmt]").val()}c(i).find("input[name=payWayCode]").val(f);c(i).find("input[name=amt]").val(h);c.ajax({url:g,type:"POST",data:c(i).serialize(),timeout:5000,async:false,error:function(l,j,k){},statusCode:{},success:function(k){if(k.isSuccess){c("#tnuForm").find("input[name=payWayCode]").val(f);c("#tnuForm").find("input[name=total_fee]").val(h);c("#tnuForm").find("input[name=cust_trade_no]").val(k.orderNo);if(c.ShillaSubmit.isKrwPayment(e)){c("#tnuForm").find("input[name=fee_type]").val("KRW")}c("#tnuForm").submit()}else{var j="故障发生在与服务器的通信。";if(k.message){j=j+"\n"+k.message}alert(k.message);c.ShillaSubmit.cancelPayment()}}})},kcpPaymentRequest:function(e,g){var f=c.ShillaCheckout.getUrl("kcpRegRequest");if(this.options.hasToken){c(g).find("input[name=quickPayReg]").val("N");f=c.ShillaCheckout.getUrl("kcpPayRequest")}c(g).find("input[name=payWayCode]").val(e);c(g).attr("action",f);c(g).attr("method","post");c(g).submit()},alipayPaymentRequest:function(f,e){var g=c.ShillaCheckout.getUrl("prePaymentAlipay");c("#orderForm").find("input[name=payWayCode]").val(f);c("#orderForm").find("input[name=paymethod]").val(c("#orderForm").find("input[name=alipayMethod]").val());if(c.ShillaSubmit.isKrwPayment(e)){amount=c("#orderForm").find("input[name=wonPaySumAmt]").val()}else{amount=c("#orderForm").find("input[name=usdPaySumAmt]").val()}c("#orderForm").find("input[name=amt]").val(amount);c.ajax({url:g,type:"POST",data:c("#orderForm").serialize(),error:function(){alert("伺服器连线发生错误。");cancelPayment()},statusCode:{404:function(){alert("404")}},success:function(h){if(h.isSuccess){c("#orderForm").find("input[name=payWayCode]").val(f);c("#orderForm").find("input[name=amt]").val(amount);c("#orderForm").find("input[name=orderNo]").val(h.orderNo);if(c.ShillaSubmit.isKrwPayment(e)){c("#orderForm").find("input[name=cur]").val("KRW")}var i=c.ShillaCheckout.getUrl("alipayPaymentRequest");c("#orderForm").attr("action",i);c("#orderForm").submit()}else{var j="故障发生在与服务器的通信。";if(data.message){j=j+"\n"+data.message}alert(data.message);c.ShillaSubmit.cancelPayment()}}})},alipayPaymentKiccRequest:function(f,e){var g=c.ShillaCheckout.getUrl("prePaymentAlipayKicc");c("#orderForm").find("input[name=payWayCode]").val(f);c("#orderForm").find("input[name=paymethod]").val(c("#orderForm").find("input[name=alipayMethod]").val());if(c.ShillaSubmit.isKrwPayment(e)){amount=c("#orderForm").find("input[name=wonPaySumAmt]").val()}else{amount=c("#orderForm").find("input[name=usdPaySumAmt]").val()}c("#orderForm").find("input[name=amt]").val(amount);c.ajax({url:g,type:"POST",data:c("#orderForm").serialize(),error:function(){alert("伺服器连线发生错误。");cancelPayment()},statusCode:{404:function(){alert("404")}},success:function(h){if(h.isSuccess){c("#orderForm").find("input[name=payWayCode]").val(f);c("#orderForm").find("input[name=amt]").val(amount);c("#orderForm").find("input[name=orderNo]").val(h.orderNo);if(c.ShillaSubmit.isKrwPayment(e)){c("#orderForm").find("input[name=cur]").val("KRW")}var i=c.ShillaCheckout.getUrl("alipayPaymentRequestKicc");c("#orderForm").attr("action",i);c("#orderForm").submit()}else{var j="故障发生在与服务器的通信。";if(data.message){j=j+"\n"+data.message}alert(data.message);c.ShillaSubmit.cancelPayment()}}})},easypayUpopPaymentRequest:function(e,g){var f=c.ShillaCheckout.getUrl("upopPrePayment");c(g).find("input[name=payWayCode]").val(e);c.ajax({url:f,type:"POST",data:c(g).serialize(),timeout:5000,async:true,error:function(j,h,i){},statusCode:{},success:function(i){if(i.isSuccess){c(g).find("input[name=orderNo]").val(i.orderNo);c.ShillaSubmit.easypayPaymentRequest(e,g);return false}else{var h="故障发生在与服务器的通信。";if(i.message){h=h+"\n"+i.message}alert(i.message);c.ShillaSubmit.cancelPayment()}}})},easypayPaymentRequest:function(e,g){c(g).find("input[name=payWayCode]").val(e);var f=c.ShillaCheckout.getUrl("easypayRequest");c(g).attr("action",f);c(g).attr("method","post");c(g).submit()},easypayPayment:function(){var e=c.ShillaCheckout.getUrl("easypayPayment");c("#orderForm").attr("target","easypayIFrame");c("#orderForm").attr("action",e);c("#orderForm").submit()},makePaymentIframe:function(){c("#layer-payment").html('<iframe id="easypayIFrame" name="easypayIFrame" width="100%" height="0" src=""></iframe>')},initPaymentIframe:function(){c("#layer-payment").html("")},checkUserInfo:function(g){var h=c(g).find("input[name=originalMobilePhone]").val();var f="";if(c("#cell_phone option:selected").val()=="82"){c("#interTelNumber").val(c("#cell_phone option:selected").val());if(c(g).find("input[name=koreaMobilePhone1]").val()==""||c(g).find("input[name=koreaMobilePhone2]").val()==""||c(g).find("input[name=koreaMobilePhone3]").val()==""){alert(c.ShillaCheckout.getMessage("PA005"));return false}f=c(g).find("input[name=koreaMobilePhone1]").val()+c(g).find("input[name=koreaMobilePhone2]").val()+c(g).find("input[name=koreaMobilePhone3]").val()}else{if(c("#cell_phone option:selected").val()=="86"){c("#interTelNumber").val(c("#cell_phone option:selected").val());if(c("input[name=chinaMobilePhone]").val()==""){alert(c.ShillaCheckout.getMessage("PA005"));return false}f=c("input[name=chinaMobilePhone]").val()}else{if(c("input[name=chinaMobilePhone]").val()==""){alert(c.ShillaCheckout.getMessage("PA005"));return false}f=c("input[name=chinaMobilePhone]").val();var e=f.substring(0,2);c("#interTelNumber").val(e);c("#orderForm").find("input[name=interTelNumber]").val(e);f=f.substring(2);c("input[name=chinaMobilePhone]").val(f)}}c("#mobilePhone").val(f);return true},checkDepartureInfo:function(h){var v=c(h).find("input[name=depPlaceCode]").val();if(v=="CS"){c("#orderForm").find("input:checkbox[id='chk05']").prop("checked",false);c("#orderForm").find("input:checkbox[id='chk05']").val("N");const u=new Date();const q=new Date(u);q.setDate(u.getDate()+60);var x=q.getFullYear();var n=("0"+(1+q.getMonth())).slice(-2);var w=("0"+q.getDate()).slice(-2);var i=x+n+w;c(h).find("input[name=depDate]").val(i);c(h).find("input[name=depTime]").val("0000");c(h).find("input[name=flightNo]").val("EC1234");c(h).find("input[name=arrivPlaceCode]").val("05");c(h).find("input[name=directYn]").val("Y");c("#orderForm").find("input[name=saveDepInfoYn]").val("N");c("#orderForm").find("select[name=date_year]").val("");c("#orderForm").find("select[name=date_month]").val("");c("#orderForm").find("select[name=date_day]").val("");c("#orderForm").find("select[name=depHour]").val("00");c("#orderForm").find("select[name=depMinute]").val("00");c("#orderForm").find("input[id=airport1]").val("");c("#orderForm").find("select[name=arrivPlaceCode1]").val("")}var f=c(h).find("select[name=depHour] option:selected").val();var k=c(h).find("select[name=depMinute] option:selected").val();if(f==""||k==""){alert("请输入回国(韩国出境)日期");return}c(h).find("input[name=depTime]").val(f+k);var p=c(h).find("input[name=depDate]").val();var g=c(h).find("input[name=depTime]").val();var j=c(h).find("input[name=depPlaceCode]").val();var s=c(h).find("input[name=arrivPlaceCode]").val();var r=c(h).find("input[name=flightNo]").val();var t=c(h).find("input[name=directYn]").val();if(r==""){if(c("#airport1").val()!=""){r=c("#airport1").val();var m=c.ShillaCheckout.checkPattern(r,"PASSPORT");if(!m){alert(c.ShillaCheckout.getMessage("PA103"));return false}c(h).find("input[name=flightNo]").val(r)}}if(p==""||g==""||j==""||s==""||r==""||t==""){alert(c.ShillaCheckout.getMessage("PA103"));return false}if(!(j=="P"||j=="U"||j=="I")){if(r.length<5){alert(c.ShillaCheckout.getMessage("PA019"));return false}else{var o=r.substring(0,2);var e=r.substring(2);var l=c.ShillaCheckout.checkDomesticFlight(o,e);if(l.isDomesticFlight){alert(l.message);c("#airport1").val("");(h).find("input[name=flightNo]").val("");return false}}}return true},checkOrderDate:function(g){var i=c(g).find("input[name=depDate]").val().toDate("yyyymmdd");var f=c(g).find(":input[name=addDay]").val();var e=new Date();var h=e.addDays(f);if(i.getTime()>h.getTime()){alert(c.ShillaCheckout.getMessage("PA105").replace("d",f));return false}return true},checkPassportInfo:function(g){var h=false;var f=c(g).find("input[name=psprtNo]").val();var e=c.ShillaSubmit.getUrl("passportPatternUrl");c.ajax({url:e,type:"POST",dataType:"json",data:{psprtNo:f,nationalityCode:this.options.nationalityCode,CSRFToken:ACC.cart.data.token},async:false,error:function(){alert("故障发生在与服务器的通信。")},success:function(i){if(i.result=="success"){h=true}else{alert(i.errorMsg);h=false}}});return h},checkNotReceivedOrderCnt:function(f){var e=c.ShillaSubmit.getUrl("notReceivedUrl");c.ajax({url:e,type:"GET",dataType:"json",timeout:5000,async:true,error:function(i,g,h){},success:function(g){}}).done(function(g){if(typeof f==="function"){f(g)}})},checkValidatePassportCnt:function(g,i){var f=c.ShillaSubmit.getUrl("passportUrl");var h=c(g).find("input[name=originalPsprtNo]").val();var e=c(g).find("input[name=psprtNo]").val();if(e!="undefined"&&e!=""){c.ajax({url:f,type:"POST",dataType:"json",timeout:5000,async:true,data:{psprtNo:e},error:function(l,j,k){},success:function(j){if(j>0){c(g).find("input[name=psprtNo]").val(h)}}}).done(function(j){if(typeof i==="function"){i(j)}})}},checkDeliveryMsg:function(f){var e=c(f).find("textarea[name=dlvryMsg]").val();if(e){if((/[^0-9|^a-z|^A-Z|^가-힣|^一-龥|^\s|^\-|^_|~!。，#$%^&*=+\\|\{};:`.,]/g).test(e)||(/[|]/g).test(e)){alert(c.ShillaCheckout.getMessage("PA108"));return false}}return true},privacyCheckAgree:function(){var e=c("#privacyAgree").is(":checked");if(!e){alert("请同意向第三方提供个人信息。");return false}return true},checkAgree:function(){var e=c("#agree").is(":checked");if(!e){alert("请您确认是否订购同意。");return false}return true},checkDeliveryInfo:function(){var i=document.getElementById("is3rdPartyReturnSaleForRetail");if(typeof(i)=="undefined"||i=="false"){return true}var g=document.getElementById("deliveryAgency");var h=document.getElementById("deliveryAgencyName");var f=document.getElementById("proxyAdress");var e=document.getElementById("deliveryDestination");var j=c("#orderForm select[name=deliveryAgency] option:selected").data();if(g!=null&&typeof(g)!=undefined&&g.value=="AGENCY_ETC"){if(typeof(h)==undefined||h.value==""){alert("物流代理公司是必选项目。");return false}}else{if(g!=null&&typeof(g)!=undefined&&g.value=="AGENCY0"){alert("物流代理公司是必选项目。");return false}}if(f!=null&&typeof(f)!=undefined&&f.checked==false){alert("勾选 ‘个人信息收集/使用同意, 个人信息对第三者提供同意’是必选项目。");return false}if(typeof(j)!="undefined"&&j.checkDeliveryDestination==true&&e.value==""){alert("请输入最终配送地址。");return false}return true},checkFlightSchedule:function(i,l){var e=c(i).find("input[name=depPlaceCode]").val();var k=c(i).find("input[name=depDate]").val();var g=c(i).find("input[name=flightNo]").val();var h=g.substring(0,2);var j=g.substring(2);var f=c.ShillaSubmit.getUrl("flightSchedule");if(e&&(e=="W"||e=="2"||e=="G"||e=="0"||e=="F"||e=="U"||e=="I"||e=="J")){c.ajax({type:"POST",url:f,dataType:"json",timeout:5000,async:true,data:{departurePlaceCode:e,departureDate:k,airLine:h,flightName:j},success:function(m){},error:function(o,m,n){},beforeSend:function(m){},complete:function(m,n){}}).done(function(m){if(typeof l==="function"){l(m)}})}else{if(typeof l==="function"){data="noData";l(data)}}},orderValdate:function(f,g){var e=c.ShillaSubmit.getUrl("orderValidateUrl");c.ajax({url:e,type:"POST",data:c(f).serialize(),timeout:5000,async:true,error:function(j,h,i){},beforeSend:function(h){c.ShillaSubmit.openProgressDialog()},success:function(h){}}).done(function(h){if(typeof g==="function"){g(h)}})},wechatValidate:function(g,j){var i=c(g).find("input[name=selPayCardChk]:checked").data();var e=i.code.replace("cn-","");if(e=="wechatpay"){var f=c.ShillaSubmit.getUrl("wechatValidateUrl");c.ajax({url:f,type:"POST",timeout:5000,async:true,error:function(m,k,l){return true},success:function(k){if(typeof j==="function"){j(k)}}})}else{if(typeof j==="function"){var h={result:"success"};j(h)}}},setPaymentAmount:function(h){var f=c(h).find("input[name=usdPaySumAmt]").val();var g=parseInt(c(h).find("input[name=wonPaySumAmt]").val());var e=g;return e},isKrwPayment:function(e){if(e=="quickpay"||e=="krp-global-creditCard"||e=="mcp"||e=="unionpay-noncert"){return true}return false},cancelPayment:function(){a=false;b=false;c.ShillaSubmit.closeProgressDialog()},openProgressDialog:function(){c("#payment_progressDialog").show()},closeProgressDialog:function(){c("#payment_progressDialog").hide()},nocardPayment:function(e){c(e).find("input[name=payWayCode]").val("");c(e).attr("target","");c(e).attr("action",c.ShillaCheckout.getUrl("nocardPayment"));c(e).submit()},easypayAlipayPaymentMethod:function(){var f=c("#orderForm input[name=CSRFToken]").val();var e=c.ShillaCheckout.getUrl("easypayAlipayPaymentMethod");c.ajax({url:e,type:"POST",data:{CSRFToken:f},error:function(){alert("서버와의 통신에 장애가 발생하였습니다.")},success:function(g){c("#walletBrandName").empty();c("#walletBrandName").append('<option value="" selected="selected">选择</option>');if(g.resCd=="0000"){c.each(g.walletsList,function(h,j){var i=c("<option value='"+j.walletBrandName+"'>"+j.walletBrandName+"</option>");c("#walletBrandName").append(i)})}}})},easypayAlipayPaymentRequest:function(f){c("#orderForm").find("input[name=payWayCode]").val(f);amount=c("#orderForm").find("input[name=usdPaySumAmt]").val();c("#orderForm").find("input[name=amt]").val(amount);var e=c.ShillaCheckout.getUrl("easypayAlipayPrePaymentRequest");if(f=="73"){c("#walletBrandName").val("ALIPAY_CN")}c.ajax({url:e,type:"POST",data:c("#orderForm").serialize(),error:function(){alert("伺服器连线发生错误。");cancelPayment()},statusCode:{404:function(){alert("404")}},success:function(g){if(g.isSuccess){c("#orderForm").find("input[name=orderNo]").val(g.orderNo);var h=c.ShillaCheckout.getUrl("easypayAlipayPaymentRequest");c("#orderForm").attr("action",h);c("#orderForm").submit()}else{if(g.message!=""){alert(g.message)}else{alert("现在网路连线不稳定，请稍候重新再试一次。")}cancelPayment()}}})},cardPayment:function(f){var l=c(f).find("input[name=psprtNo]").val();var k=c(f).find("input[name=selPayCardChk]").is(":checked");if(!k){alert("카드를 선택해 주세요");return false}var i=c(f).find("input[name=usdPaySumAmt]").val();var t=c(f).find("input[name=wonPaySumAmt]").val();var m=c(f).find("input[name=selPayCardChk]:checked").data();c(f).find("input[name=payWayCode]").val(m.paywaycode);var u=m.minimumpaymentamount;var p=m.code.replace("cn-","");var o=m.paywayname;var n=c.ShillaSubmit.getDepartureInfoStr();var e=t;if(m.provider!="KICC"&&!c.ShillaSubmit.isKrwPayment(p)||(m.provider=="KICC"&&"alipay-KICC"==p)&&!c.ShillaSubmit.isKrwPayment(p)){e=i}if(parseInt(e)<parseInt(u)){alert("信用卡最低交易金额为  "+u);return false}var j="(￦)";var r="";switch(p){case"unionpay":c(f).find("input[name=cardIssueCmpyCode]").val("081");c(f).find("input[name=cardIssueCmpyName]").val("은련카드");apdText="银联(UPOP)结算时以韩币(￦)为准结算。\n若出境信息不准确的话，有可能无法取货，请您注意。";break;case"unionpay-noncert":c(f).find("input[name=tenPayMethod]").val("P002");c(f).find("input[name=cardIssueCmpyCode]").val("UBC");c(f).find("input[name=cardIssueCmpyName]").val("UnionPay");apdText="银联(UPOP)结算时以韩币(￦)为准结算。\n若出境信息不准确的话，有可能无法取货，请您注意。";break;case"quickpay":c(f).find("input[name=cardIssueCmpyCode]").val("081");c(f).find("input[name=cardIssueCmpyName]").val("은련카드");apdText="银联(UPOP)结算时以韩币(￦)为准结算。\n若出境信息不准确的话，有可能无法取货，请您注意。";break;case"tenpay":c(f).find("input[name=tenPayMethod]").val("P004");c(f).find("input[name=cardIssueCmpyCode]").val("TEN");c(f).find("input[name=cardIssueCmpyName]").val("Tenpay");apdText="财付通结算时以人民币(￥)为准结算。\n若出境信息不准确的话，有可能无法取货，请您注意。";break;case"wechatpay":var h=c(f).find("input[name=isAppConnect]").val();c(f).find("input[name=tenPayMethod]").val("P142");var g=c.cookie("aptKey");if(typeof(g)=="undefined"){g="wxa7006d1bbde25afb"}c(f).find("input[name=appid]").val(g);c(f).find("input[name=cardIssueCmpyCode]").val("WXN");c(f).find("input[name=cardIssueCmpyName]").val("WeChatPay");apdText="微信支付结算时以人民币(￥)为准结算。\n若出境信息不准确的话，有可能无法取货，请您注意。";break;case"wechatpay-hana":var h=c(f).find("input[name=isAppConnect]").val();c(f).find("input[name=tenPayMethod]").val("PAYMENT");var g=c.cookie("aptKey");if(typeof(g)=="undefined"){g="wxa7006d1bbde25afb"}c(f).find("input[name=appid]").val(g);c(f).find("input[name=cardIssueCmpyCode]").val("WXH");c(f).find("input[name=cardIssueCmpyName]").val("WeChatPay-HANA");apdText="微信支付结算时以人民币(￥)为准结算。\n若出境信息不准确的话，有可能无法取货，请您注意。";break;case"wechatpay-smartro":var h=c(f).find("input[name=isAppConnect]").val();c(f).find("input[name=tenPayMethod]").val("PAYMENT");var g=c.cookie("aptKey");if(typeof(g)=="undefined"){g="wxa7006d1bbde25afb"}c(f).find("input[name=appid]").val(g);c(f).find("input[name=cardIssueCmpyCode]").val("WXS");c(f).find("input[name=cardIssueCmpyName]").val("WeChatPay-Smartro");apdText="微信支付结算时以人民币(￥)为准结算。\n若出境信息不准确的话，有可能无法取货，请您注意。";break;case"wechatpay-tnu":c(f).find("input[name=cardIssueCmpyCode]").val("WXT");c(f).find("input[name=cardIssueCmpyName]").val("WeChatPay-TnU");apdText="微信支付结算时以人民币(￥)为准结算。\n若出境信息不准确的话，有可能无法取货，请您注意。";break;case"paypal":c(f).find("input[name=tenPayMethod]").val("P001");c(f).find("input[name=cardIssueCmpyCode]").val("PPL");c(f).find("input[name=cardIssueCmpyName]").val("Paypal");apdText="贝宝(Paypal)结算时是以韩币(￦)为准结算。\n若出境信息不准确的话，有可能无法取货，请您注意。";break;case"alipay":case"alipay-direct":c(f).find("input[name=tenPayMethod]").val("P003");c(f).find("input[name=cardIssueCmpyCode]").val("ALP");c(f).find("input[name=cardIssueCmpyName]").val("Alipay");apdText="支付宝（ALIPAY)结算时以人民币(￥)为准结算。\n若出境信息不准确的话，有可能无法取货，请您注意。";break;case"alipay-KICC":c(f).find("input[name=cardIssueCmpyCode]").val("ALP");c(f).find("input[name=cardIssueCmpyName]").val("Alipay-KICC");apdText="支付宝（ALIPAY)结算时以人民币(￥)为准结算。\n若出境信息不准确的话，有可能无法取货，请您注意。";break;case"bestpay":c(f).find("input[name=tenPayMethod]").val("P010");c(f).find("input[name=cardIssueCmpyCode]").val("BSP");c(f).find("input[name=cardIssueCmpyName]").val("BestPay");apdText="翼支付结算时以人民币(￥)为准结算。\n若出境信息不准确的话，有可能无法取货，请您注意。";break;case"global-creditCard":if(c("#intrCreditCard option:selected").val()!=""){var v=c("#intrCreditCard option:selected").data();apdText="海外信用卡结算时以韩币(￦)为准结算。\n若出境信息不准确的话，有可能无法取货，请您注意。";c(f).find("input[name=cardIssueCmpyCode]").val(c("#intrCreditCard option:selected").val());c(f).find("input[name=cardIssueCmpyName]").val(c("#intrCreditCard option:selected").text());c(f).find("input[name=reqType]").val("2")}else{alert("请选择海外信用卡.");return false}break;case"krp-global-creditCard":if(c("#intrKrpCreditCard option:selected").val()!=""){var v=c("#intrKrpCreditCard option:selected").data();apdText="海外信用卡结算时以您的国家货币为准结算。\n若出境信息不准确的话，有可能无法取货，请您注意。";c(f).find("input[name=tenPayMethod]").val(v.tenpaymethod);c(f).find("input[name=cardIssueCmpyCode]").val(c("#intrKrpCreditCard option:selected").val());c(f).find("input[name=cardIssueCmpyName]").val("자국환")}else{alert("请选择海外信用卡.");return false}break;case"creditCard":if(c("#korCreditCard option:selected").val()!=""){var s=c(f).find("select[name=cardInstallment] option:selected").val();if("00"!=s){if(t<50000){alert("信用卡结算可以分期付款从KRW50,000以上。");c(f).find("select[name=cardInstallment] option:eq(0)").attr("selected","selected");return false}}apdText="韩国信用卡结算时以韩币(￦)为准结算。\n若出境信息不准确的话，有可能无法取货，请您注意。";c(f).find("input[name=cardIssueCmpyCode]").val(c("#korCreditCard option:selected").val());c(f).find("input[name=cardIssueCmpyName]").val(c("#korCreditCard option:selected").text());c(f).find("input[name=reqType]").val("3")}else{alert("请选韩国信用卡");return false}break;case"alipay-plus":case"alipay-plus2":apdText="使用Alipay+结算时,以您选择的Alipay Wallet各国货币为准进行结算。\n若出境信息不准确的话，有可能无法取货，请您注意。";break}var q="您选择的付款方式: "+o+"\n"+c.ShillaSubmit.getDepartureInfoStr(apdText)+"\n"+c.ShillaSubmit.paymentMsg;c("#confirmMsg").val(q);if(!c.ShillaSubmit.checkOffer(p)){return false}return true}}})(jQuery);