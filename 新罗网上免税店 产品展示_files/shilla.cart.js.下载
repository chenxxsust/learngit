ACC.cart={data:{priceFormat:{usd:{prefix:"$ ",centsSeparator:".",thousandsSeparator:","},krw:{prefix:"￦ ",centsSeparator:".",thousandsSeparator:","},cny:{prefix:"约 ¥ ",centsSeparator:".",thousandsSeparator:","}}},init:function(option){with(ACC.cart){data.commonResourcePath=option.commonResourcePath;data.isAnonymous=option.isAnonymous;data.memberType=option.memberType;data.memberId=option.memberId;data.email=option.email;data.token=option.token;data.loginUrl=option.loginUrl;data.miniCartRemoveItemUrl=option.miniCartRemoveItemUrl;data.miniCartUpdateItemUrl=option.miniCartUpdateItemUrl;data.cartPageUrl=option.cartPageUrl;data.refreshCartPageAjaxUrl=option.refreshCartPageAjaxUrl;data.refreshMiniCartAjaxUrl=option.refreshMiniCartAjaxUrl;data.cartRemoveUrl=option.cartRemoveUrl;data.cartUpdateUrl=option.cartUpdateUrl;data.cartChangeUrl=option.cartChangeUrl;data.addToCartUrl=option.addToCartUrl;data.addToCartListUrl=option.addToCartListUrl;data.buynowUrl=option.buynowUrl;data.wishlistPopupUrl=option.wishlistPopupUrl;data.addToWishlistUrl=option.addToWishlistUrl;data.removeProductForEntryUrl=option.removeProductForEntryUrl;data.requestRestockNotiUrl=option.requestRestockNotiUrl;data.confirmRestockNotiUrl=option.confirmRestockNotiUrl;data.requestSpecialOrderUrl=option.requestSpecialOrderUrl;data.openCsSpecialOrderUrl=option.openCsSpecialOrderUrl;data.getWishlistUrl=option.getWishlistUrl;data.addWishlistPopupUrl=option.addWishlistPopupUrl;data.cartNextPageUrl=option.cartNextPageUrl;data.findUserWishlistPopupUrl=option.findUserWishlistPopupUrl;data.showUserWishlistPopupUrl=option.showUserWishlistPopupUrl;data.removeUnOrderableCartEntriesUrl=option.removeUnOrderableCartEntriesUrl;data.isMajorGuestMember=option.isMajorGuestMember;data.mgMileageHurdle=option.mgMileageHurdle;data.processingAddToCart=false;data.isAppConnect=option.isAppConnect;data.passportNumber=option.passportNumber;data.passportExpireDate=option.passportExpireDate}},goCartPage:function(){with(ACC.cart){if(!data.isAnonymous){location.href=data.cartPageUrl}else{ACC.customer.openLoginPopup(data.cartPageUrl)}}},addToCart:function(productCode,quantity,productOptionValue,planDisplayCode){with(ACC.cart){var params=[{productCode:productCode,quantity:quantity,productOptionValue:productOptionValue,planDisplayCode:planDisplayCode}];ACC.cart.addToCartList(params)}},addToCartList:function(params,successCallback){with(ACC.cart){if(data.processingAddToCart){return false}if(data.isAnonymous){ACC.customer.openLoginPopup();return false}var entries={};for(var i=0;i<params.length;i++){var entry=params[i];var productCode=typeof(entry.productCode)!="undefined"?entry.productCode:entry.productcode;var quantity=entry.quantity;var productOptionValue=typeof(entry.productOptionValue)!="undefined"?entry.productOptionValue:entry.productoptionvalue;var planDisplayCode=typeof(entry.planDisplayCode)!="undefined"?entry.planDisplayCode:entry.plandisplaycode;var specialOrderQnAId=typeof(entry.specialOrderQnAId)!="undefined"?entry.specialOrderQnAId:entry.specialorderqnaid;var reorder=typeof(entry.reorder)!="undefined"?entry.reorder:entry.reorder;if(typeof(quantity)=="undefined"||quantity==null||quantity==""){quantity=1}if(typeof(productOptionValue)=="undefined"||productOptionValue==null||productOptionValue==""){productOptionValue=""}if(typeof(planDisplayCode)=="undefined"||planDisplayCode==null||planDisplayCode==""){planDisplayCode=""}if(typeof(specialOrderQnAId)=="undefined"||specialOrderQnAId==null||specialOrderQnAId==""){specialOrderQnAId=""}if(typeof(reorder)=="undefined"||reorder==null||reorder==""){reorder=false}entries["entries["+i+"].productCode"]=productCode;entries["entries["+i+"].quantity"]=quantity;entries["entries["+i+"].productOptionValue"]=productOptionValue;entries["entries["+i+"].planDisplayCode"]=planDisplayCode;entries["entries["+i+"].specialOrderQnAId"]=specialOrderQnAId;entries["entries["+i+"].reorder"]=reorder}var options={url:data.addToCartUrl,data:$.param(entries)+"&CSRFToken="+data.token,type:"POST",beforeSend:function(){data.processingAddToCart=true},complete:function(){data.processingAddToCart=false},error:ajaxError,success:function(data){ACC.cart.refreshMiniCart(data);if(window.opener!=null){opener.ACC.cart.refreshMiniCartPageAjax()}if(location.href.indexOf(ACC.cart.data.cartPageUrl)!=-1&&location.href.match(/cart$/)!=null){ACC.cart.refreshCartPageAjax()}if(data.reorder){if(data.result=="success"){ACC.cart.showAlert("已经成功加入购物车。")}else{var statusCode=$.grep(data.cartModifications,function(e){return e.statusCode!=null&&e.statusCode!="alreadyExists"&&e.statusCode!="success"})[0];if(typeof(statusCode)=="undefined"||statusCode==null){ACC.cart.showAlert("此商品已加入过购物车。")}else{if(confirm("有些商品暂时缺货，请在购物车里确认购买数量。现在移动至购物车吗？")){ACC.cart.goCartPage()}}}return}if(data.result=="success"){ACC.cart.showAlert("已经成功加入购物车。")}else{if(data.errorCode=="memberTypeNotAllowed"){ACC.customer.goChangeRegularPopup();return false}if(data.errorMsg!=""){ACC.cart.showAlert(data.errorMsg)}else{for(var cartModification in data.cartModifications){ACC.cart.showAlert(cartModification.statusMessage)}}}}};if($.isFunction(successCallback)){options.success=successCallback}$.ajax(options)}},removeCartItemList:function(b){var c=ACC.cart.data.miniCartRemoveItemUrl;if(typeof(b)!="undefined"&&b!=""&&b.length>0){var a={url:c,type:"POST",data:$.param({entryNumbers:b},true),error:ACC.cart.ajaxError,beforeSend:function(){if(typeof(openProgressDialog)=="function"){openProgressDialog()}},complete:function(){if(typeof(closeProgressDialog)=="function"){closeProgressDialog()}},success:function(d){ACC.cart.refreshMiniCart(d);if(location.href.indexOf(ACC.cart.data.cartPageUrl)!=-1&&location.href.match(/cart$/)!=null){ACC.cart.refreshCartPageAjax()}if(d.result=="success"){}else{ACC.cart.showAlert(d.errorMsg)}}};$.ajax(a)}else{ACC.cart.showAlert("您尚未选择商品, 请选择商品。")}},buynow:function(productCode,quantity,productOptionValue,planDisplayCode,entryNumber,sClubPromotionCode){with(ACC.cart){var params=[{productcode:productCode,quantity:quantity,productoptionvalue:productOptionValue,planDisplayCode:planDisplayCode,entryNumber:entryNumber,sClubPromotionCode:sClubPromotionCode}];ACC.cart.buynowList(params)}},buynowList:function(params){with(ACC.cart){if(data.isAnonymous){ACC.customer.openLoginPopup();return false}if(data.memberType!="01"){ACC.customer.goChangeRegularPopup();return false}else{if(ACC.cart.data.passportNumber=="-"||ACC.cart.data.passportExpireDate=="2199-12-31"){ACC.customer.goChangeRegularFromNewPopup();return false}}var is800over=false;var entrynumber=params[0].entryNumber;var miniEntries=MiniCalculator.entries;if(typeof(miniEntries)!="undefined"&&miniEntries!=""&&miniEntries.length>0){for(var i=0;i<miniEntries.length;i++){if(typeof(entrynumber)!="undefined"){if(miniEntries[i].entryNumber==entrynumber){var discountSaleAmount=miniEntries[i].discountSaleAmount;if(discountSaleAmount>=800){is800over=true}}}}}if(is800over){alert("您所订购的订单内包含超过$800以上或平行进口相关的商品。\n\n麻烦请您务必再次确认关于免税商品的交换/退货的流程。\n（客服中心>网络购物指南>取消/交换/退货）\n\n ※ 平行进口商品直接带入(韩国)国内时将无法进行交换/退货，只能以A/S进行售后")}if($("#prdPriceDollar").length>0){var prdPriceDollar=$("#prdPriceDollar").val();if(prdPriceDollar>=800){alert("您所订购的订单内包含超过$800以上或平行进口相关的商品。\n\n麻烦请您务必再次确认关于免税商品的交换/退货的流程。\n（客服中心>网络购物指南>取消/交换/退货）\n\n ※ 平行进口商品直接带入(韩国)国内时将无法进行交换/退货，只能以A/S进行售后")}}var form=$("<form></form>");form.attr("action",data.buynowUrl);form.attr("method","post");form.append('<input type="hidden" name="CSRFToken" value="'+data.token+'">');for(i=0;i<params.length;i++){var entry=params[i];var productCode=typeof(entry.productCode)!="undefined"?entry.productCode:entry.productcode;var quantity=entry.quantity;var productOptionValue=typeof(entry.productOptionValue)!="undefined"?entry.productOptionValue:entry.productoptionvalue;var planDisplayCode=typeof(entry.planDisplayCode)!="undefined"?entry.planDisplayCode:entry.plandisplaycode;var specialOrderQnAId=typeof(entry.specialOrderQnAId)!="undefined"?entry.specialOrderQnAId:entry.specialorderqnaid;var entryNumber=typeof(entry.entryNumber)!="undefined"?entry.entryNumber:entry.entrynumber;var sClubPromotionCode=typeof(entry.sClubPromotionCode)!="undefined"?entry.sClubPromotionCode:entry.sclubpromotioncode;form.append('<input type="hidden" name="entries['+i+'].productCode" value="'+productCode+'">');if(typeof(quantity)!="undefined"&&quantity!=""){form.append('<input type="hidden" name="entries['+i+'].quantity" value="'+quantity+'">')}else{form.append('<input type="hidden" name="entries['+i+'].quantity" value="'+1+'">')}if(typeof(productOptionValue)!="undefined"&&productOptionValue!=""){form.append('<input type="hidden" name="entries['+i+'].productOptionValue" value="'+productOptionValue+'">')}if(typeof(planDisplayCode)!="undefined"&&planDisplayCode!=""){form.append('<input type="hidden" name="entries['+i+'].planDisplayCode" value="'+planDisplayCode+'">')}if(typeof(specialOrderQnAId)!="undefined"&&specialOrderQnAId!=""){form.append('<input type="hidden" name="entries['+i+'].specialOrderQnAId" value="'+specialOrderQnAId+'">')}if(typeof(entryNumber)!="undefined"){form.append('<input type="hidden" name="entries['+i+'].entryNumber" value="'+entryNumber+'">')}if(typeof(sClubPromotionCode)!="undefined"){form.append('<input type="hidden" name="entries['+i+'].sClubPromotionCode" value="'+sClubPromotionCode+'">')}}$("body").append(form);form.submit();$(form).remove()}},openWishlistPopup:function(productDatas){with(ACC.cart){if(data.isAnonymous){ACC.customer.openLoginPopup();return false}if(data.memberType!="01"){ACC.customer.goChangeRegularPopup();$(mask).removeClass("on");$("body").css({overflow:"auto"});return false}$("#popup_layer_addToWishlist input[name='productCodes']").remove();$("#popup_layer_addToWishlist_product").empty();var productCodes=[];for(var i=0;i<productDatas.length;i++){productCodes.push(productDatas[i].productcode);var html="<input type='hidden' name='productCodes' value="+productDatas[i].productcode+">";$("#popup_layer_addToWishlist form").append(html);var productHtml="<p><strong>"+productDatas[i].productbrandname+"/"+productDatas[i].productbrandenname+"</strong>"+productDatas[i].productname+"</p>";$("#popup_layer_addToWishlist_product").append(productHtml)}var actionUrl=ACC.cart.data.getWishlistUrl;var options={url:actionUrl,type:"get",error:ajaxError,success:function(data){$("#popup_layer_addToWishlist select[name='wishlistCode']").empty();if(typeof(data)!="undefined"&&data.length>0){$.each(data,function(index,value){var html="<option value="+value.code+">"+value.name+"</option>";$("#popup_layer_addToWishlist select[name='wishlistCode']").append(html)})}popOpen($("#popup_layer_addToWishlist"))}};$.ajax(options)}},forwardWishlist:function(productCode){with(ACC.cart){if(ACC.cart.data.isAnonymous){ACC.customer.openLoginPopup();return false}var actionUrl=ACC.cart.data.getWishlistUrl;var options={url:actionUrl,type:"get",error:ajaxError,cache:false,success:function(data){var wishCode=data[0].code;var options={url:ACC.cart.data.addToWishlistUrl,data:{CSRFToken:ACC.cart.data.token,wishlistCode:wishCode,productCodes:productCode},type:"POST",error:ajaxError,success:function(data){if(data.result=="success"){if(typeof(data.addedProductCodes)!="undefined"&&data.addedProductCodes.length>0){$.each(data.addedProductCodes,function(index,value){$("#newAddToWishlistBtn_"+value).addClass("on");$(".alert_wish").removeClass("off").find("span").html("成功加入<br>关注商品！");$(".alert_wish").stop(true).fadeIn(500).delay(500).fadeOut(500);$("button[data-productCode="+value+"]").data("wishlistyn","on");$("option[value="+value+"]").data("wishlistyn","on");return false})}}else{var productCodes="";productCodes+="?productCodes="+productCode;$.ajax({type:"GET",url:ACC.cart.data.removeProductForEntryUrl+productCodes,dataType:"json",data:{wishlistCode:wishCode},cache:false,success:function(result){console.log(result);if(result==true){$("#newAddToWishlistBtn_"+productCode+"").removeClass("on");$(".alert_wish").addClass("off").find("span").html("取消加入<br>关注商品");$(".alert_wish").stop(true).fadeIn(500).delay(500).fadeOut(500);$("button[data-productCode="+productCode+"]").data("wishlistyn","");$("option[value="+productCode+"]").data("wishlistyn","");return false}},error:function(a,b,c){console.log(a);alert("伺服器连线发生错误。 : "+a)}})}}};$.ajax(options)}}}$.ajax(options)},addToWishlist:function(wishlistCode,productCode){with(ACC.cart){var options={url:actionUrl,data:{CSRFToken:data.token,wishlistCode:wishlistCode,productCode:productCode},type:"POST",error:ajaxError,success:function(data){if(data.result=="success"){ACC.cart.showAlert("已经被登记的商品。")}else{ACC.cart.showAlert(data.errorMsg)}}};$.ajax(options)}},openAddWishlistPopup:function(){var a=$("<form></form>");a.attr("action",ACC.cart.data.addWishlistPopupUrl);a.attr("method","get");a.attr("target","wishlistPopup");popup=window.open("about:blank","wishlistPopup","width=570, height=255");popup.focus();$("body").append(a);a.submit();$(a).remove()},openFindUserWishlistPopup:function(){var a=$("<form></form>");a.attr("action",ACC.cart.data.findUserWishlistPopupUrl);a.attr("method","get");a.attr("target","wishlistPopup");popup=window.open("about:blank","wishlistPopup","width=520, height=385");popup.focus();$("body").append(a);a.submit();$(a).remove()},openShowUserWishlistPopup:function(a){var c=ACC.cart.data.showUserWishlistPopupUrl+"?userId="+a;var b=$("<form></form>");b.attr("action",ACC.cart.data.showUserWishlistPopupUrl);b.attr("method","post");b.attr("target","wishlistPopup2");b.append("<input type='hidden' name='userId' value='"+a+"'>");b.append("<input type='hidden' name='CSRFToken' value='"+ACC.cart.data.token+"'>");popup=window.open("about:blank","wishlistPopup2");popup.focus();$("body").append(b);b.submit();$(b).remove()},openRequestRestockNotiPopup:function(productCode){with(ACC.cart){if(ACC.cart.data.isAnonymous){ACC.customer.openLoginPopup()}else{if(ACC.cart.data.memberType!="01"){ACC.customer.goChangeRegularPopup();return false}else{if(productCode!=undefined&&productCode!=""){}else{ACC.cart.showAlert("productCode Error")}}}}},bindAll:function(){with(ACC.cart){bindMiniCartUpdateItemBtnClick();bindMiniCartRemoveItemBtnClick();bindMiniCartBuynowBtnClick();bindAddToCartBtn();bindAddToWishlistBntClick();newBindAddToWishlistBntClick();bindBuynowBntClick();bindRemoveCartEntryBntClick();bindUpdateCartEntryClick();bindCartNextBtnClick();bindRemoveSelectedCartEntriesBtnClick();bindAddToWishlistSelectedCartEntriesBtnClick();bindRemoveUnOrderableCartEntriesBtnClick();bindCalculateCartBtnClick();bindRequestRestockNotiBtnClick();bindCheckBoxClick()}},bindMiniCart:function(){with(ACC.cart){bindMiniCartUpdateItemBtnClick()}},bindAddToWishlistBntClick:function(){$(document).off("click",'[id^="addToWishlistBtn"]');$(document).on("click",'[id^="addToWishlistBtn"]',function(){var a=$(this).data();ACC.cart.openWishlistPopup([a]);return false})},newBindAddToWishlistBntClick:function(){$(document).off("click",'[id^="newAddToWishlistBtn"]');$(document).on("click",'[id^="newAddToWishlistBtn"]',function(){var a=$(this).data("productcode");ACC.cart.forwardWishlist(a);return false})},bindAddToCartBtn:function(){$(document).off("click",'[id^="addToCartBtn"]');$(document).on("click",'[id^="addToCartBtn"]',function(){var c=$(this).attr("data-productcode");var b=$(this).attr("data-quantity");var a=$(this).attr("data-productoptionvalue");var d=$(this).attr("data-producttypecode");if(d=="03"){alert("此商品是有选择选项的商品。\n请至商品详情选择商品选项.")}else{ACC.cart.addToCart(c,b,a)}return false})},bindBuynowBntClick:function(){$(document).off("click",'[id^="buynowBtn"]');$(document).on("click",'[id^="buynowBtn"]',function(){var e=$(this).data("productcode");var d=$(this).data("quantity");var c=$(this).data("productoptionvalue");var a=$(this).data("entrynumber");var f=$(this).data("producttypecode");var b=$(this).data("sclubpromotioncode");if(f=="03"){alert("此商品是有选择选项的商品。\n请至商品详情选择商品选项.")}else{ACC.cart.buynow(e,d,c,null,a,b)}return false})},bindRemoveCartEntryBntClick:function(){$('[id^="removeCartEntryBtn"]').off("click");$('[id^="removeCartEntryBtn"]').click(function(){if(confirm("要删除所选择的商品吗?")){var c=ACC.cart.data.cartRemoveUrl;var a=$(this).data("entrynumber");var d=$(this).data("productcode");var b={url:c,data:{entryNumbers:a,productCode:d,CSRFToken:ACC.cart.data.token},type:"POST",error:ACC.cart.ajaxError,beforeSend:function(){if(typeof(openProgressDialog)=="function"){openProgressDialog()}},complete:function(){if(typeof(closeProgressDialog)=="function"){closeProgressDialog()}},success:function(e){ACC.cart.showAlert("所选择的商品已经删除。");ACC.cart.refreshCartPage(e);ACC.cart.refreshMiniCartPageAjax()}};$.ajax(b)}else{}return false})},bindUpdateCartEntryClick:function(){$('[id^="updateCartEntryBtn"]').off("click");$('[id^="updateCartEntryBtn"]').click(function(){var d=ACC.cart.data.cartUpdateUrl;var a=$(this).data("entrynumber");var f=$(this).parents(".product_info").parent().find(".pcount").val();var g;var c=$(this).data("producttype");var e;if(c=="02"){e=$(this).parents(".product_info").parent().find("select").val();if(typeof(e)=="undefined"||e==""){ACC.cart.showAlert("您尚未选择商品, 请选择商品。");return false}}else{if(c=="03"||c=="04"||c=="07"){g=$(this).parents(".product_info").parent().find("select").val();if(typeof(g)=="undefined"||g==""){ACC.cart.showAlert("您尚未选择商品, 请选择商品。");return false}}}if(typeof(g)=="undefined"||g==""){g=$(this).data("productcode")}if(f<=0){ACC.cart.showAlert("最少需购买1个以上才能成立订单");return false}var b={url:d,data:{entryNumber:a,productCode:g,quantity:f,productOptionValue:e,CSRFToken:ACC.cart.data.token},type:"POST",error:ACC.cart.ajaxError,beforeSend:function(){if(typeof(openProgressDialog)=="function"){openProgressDialog()}},complete:function(){if(typeof(closeProgressDialog)=="function"){closeProgressDialog()}},success:function(h){ACC.cart.refreshCartPage(h);ACC.cart.refreshMiniCartPageAjax()}};$.ajax(b);return false})},refreshCartPage:function(a){$("#cart_refreshDiv").html(a);$("#selectedEntryCnt").html("("+$("input[name=cart_entry_check]:checked").length+")");ACC.cart.bindAll();allCheckboxProp("all_check");productAmountCheck();productSwipeColor();cartListOptionCheck();bindOpenPopupBtnClick()},refreshCartPageAjax:function(c){var b=ACC.cart.data.refreshCartPageAjaxUrl;var a={url:b,type:"GET",error:ACC.cart.ajaxError,beforeSend:function(){if(typeof(openProgressDialog)=="function"){openProgressDialog()}},complete:function(){if(typeof(closeProgressDialog)=="function"){closeProgressDialog()}},success:function(d){ACC.cart.refreshCartPage(d)}};$.ajax(a)},refreshMiniCartPageAjax:function(c){if(isAjaxResultFail){return}var b=ACC.cart.data.refreshMiniCartAjaxUrl;var a={url:b,type:"GET",error:ACC.cart.ajaxError,success:function(d){ACC.cart.refreshMiniCart(d)}};$.ajax(a)},refreshMiniCart:function(a){if(typeof(a.miniCart)!="undefined"){$("#miniCartCountSpan").text(a.miniCart.totalItems);$("#unbCartCountSpan").text(a.miniCart.totalItems);$("#miniCartTotalSalePrice").text(a.miniCart.totalSalePrice.formattedValue);$("#miniCartTotalPaymentAmount").text(a.miniCart.totalUsdPaymentAmount.formattedValue);if(ACC.cart.data.isAppConnect){window.location.href='shilladfscn://updateCartNumber?{"number":'+a.miniCart.totalItems+"}"}}else{}ACC.cart.bindMiniCart()},bindRemoveSelectedCartEntriesBtnClick:function(){$("#removeSelectedCartEntrieBtn").off("click");$("#removeSelectedCartEntrieBtn").click(function(){var d=ACC.cart.data.cartRemoveUrl;var c=[];var b=[];$.each($("input[name=cart_entry_check]:checked").parents("li"),function(e,f){c.push($(this).data("entrynumber"));b.push($(this).data("productcode"))});if(typeof(c)!="undefined"&&c!=""&&c.length>0){if(confirm("要删除所选择的商品吗?")){var a={url:d,type:"POST",data:$.param({entryNumbers:c,productCodes:b.join(),CSRFToken:ACC.cart.data.token},true),error:ACC.cart.ajaxError,success:function(e){ACC.cart.showAlert("所选择的商品已经删除。");ACC.cart.refreshCartPage(e);ACC.cart.refreshMiniCartPageAjax()}};$.ajax(a)}else{}}else{ACC.cart.showAlert("您尚未选择商品, 请选择商品。")}return false})},bindAddToWishlistSelectedCartEntriesBtnClick:function(){$("#addToWishlistSelectedCartEntriesBtn").off("click");$("#addToWishlistSelectedCartEntriesBtn").click(function(){var a=[];$.each($("input[name=cart_entry_check]:checked").parents("li"),function(b,c){a.push($(this).data())});if(a.length>0){ACC.cart.openWishlistPopup(a)}else{ACC.cart.showAlert("您尚未选择商品, 请选择商品。")}return false})},bindRemoveUnOrderableCartEntriesBtnClick:function(){$("#removeUnOrderableCartEntriesBtn").off("click");$("#removeUnOrderableCartEntriesBtn").click(function(){var a=false;if($(".product_list li[data-orderable=false]").length>0){a=true}if(a){if(confirm("要删除终止贩卖或暂时缺货的商品吗?")){var c=ACC.cart.data.removeUnOrderableCartEntriesUrl;var b={url:c,type:"POST",data:{CSRFToken:ACC.cart.data.token},error:ACC.cart.ajaxError,beforeSend:function(){if(typeof(openProgressDialog)=="function"){openProgressDialog()}},complete:function(){if(typeof(closeProgressDialog)=="function"){closeProgressDialog()}},success:function(d){ACC.cart.showAlert("已经删除终止贩卖或暂时缺货的商品");ACC.cart.refreshCartPage(d);ACC.cart.refreshMiniCartPageAjax()}};$.ajax(b)}else{}}else{ACC.cart.showAlert("没有停止销售/暂时无货的商品")}return false})},bindCartNextBtnClick:function(){$("#cartNextBtn").off("click");$("#cartNextBtn").click(function(){var o=[];var f=[];var a=[];var n=[];$.each($("input[name=cart_entry_check]:checked").parents("li"),function(i,j){f.push($(this).data("entrynumber"));a.push($(this).data("orderable"));n.push($(this).data("productname"))});var k=0;var m=[];var d=[];$.each($("input[name=cart_entry_check]:checked").parents("li"),function(j,q){var i=$(this).data("producttype");var p;var r;if($(this).find("select").length>0){if(i=="02"){p=$(this).find("select").val();if(typeof(p)=="undefined"||p==""){m.push($(this).data("productname"))}else{if(p!=$(this).data("productoptattrvalue")){d.push($(this).data("productname"))}}}else{if(i=="03"||i=="04"||i=="07"){r=$(this).find("select").val();if(typeof(r)=="undefined"||r==""){m.push($(this).data("productname"))}else{if(r!=$(this).data("productcode")){d.push($(this).data("productname"))}}}}}});if(m.length>0){ACC.cart.showAlert(m.join(", ")+"请选择商品的选项。");return false}if(d.length>0){ACC.cart.showAlert(d.join(", ")+"变更了商品的选项。请点击‘修改’ 按钮存储选项。");return false}if(f.length<1){ACC.cart.showAlert("最少需购买1个以上才能成立订单");return false}$.each(a,function(i,j){if(!j){o.push(n[i]);return false}});if(o.length>0){ACC.cart.showAlert(o.join(", ")+"目前缺货 。");return false}var b=false;var e=MiniCalculator.entries;if(typeof(e)!="undefined"&&e!=""&&e.length>0){for(var h=0;h<e.length;h++){if(typeof(f)!="undefined"&&f!=""&&f.length>0){for(var g=0;g<f.length;g++){if(e[h].entryNumber==f[g]){var l=e[h].discountSaleAmount;if(l>=800){b=true}}}}}}var c=$("input[name=cart_entry_check]:checked").parents("li[data-orderable=false]");if(c.length>0){ACC.cart.showAlert("'"+c.data("productname")+"’ 目前缺货 。");return false}if(ACC.cart.data.isAnonymous){ACC.customer.openLoginPopup("","ACC.cart.goCartNextPage")}else{if(ACC.cart.data.memberType!="01"){ACC.customer.goChangeRegularPopup();return false}else{if(ACC.cart.data.passportNumber=="-"||ACC.cart.data.passportExpireDate=="2199-12-31"){ACC.customer.goChangeRegularFromNewPopup();return false}}}if(b){alert("您所订购的订单内包含超过$800以上或平行进口相关的商品。\n\n麻烦请您务必再次确认关于免税商品的交换/退货的流程。\n（客服中心>网络购物指南>取消/交换/退货）\n\n ※ 平行进口商品直接带入(韩国)国内时将无法进行交换/退货，只能以A/S进行售后")}ACC.cart.goCartNextPage();return false})},goCartNextPage:function(){var a=[];$.each($("input[name=cart_entry_check]:checked").parents("li"),function(e,f){a.push($(this).data("entrynumber"))});var c=$("#checkoutForm");if(typeof(c)=="undefined"||c.length==0){c=$("<form></form>")}var d=new Date();c.attr("action",ACC.cart.data.cartNextPageUrl+"?time="+d.getTime());c.attr("method","post");c.append('<input type="hidden" name="CSRFToken" value="'+ACC.cart.data.token+'">');for(var b=0;b<a.length;b++){c.append('<input type="hidden" name="entryNumbers" value="'+a[b]+'">')}if(ACC.cart.data.isAnonymous){c.append('<input type="hidden" name="guestCheckout" value="'+true+'">')}if(typeof(c.parent())=="undefined"||c.parent().length==0){$("body").append(c)}c.submit();return false},bindCalculateCartBtnClick:function(){$("#calculateCartBtn").off("click");$("#calculateCartBtn").click(function(){var c=$(this).data("action");var a=$(this).data("token");var b=$("<form></form>");b.attr("action",c);b.attr("method","post");b.attr("target","newPopup");b.append('<input type="hidden" name="CSRFToken" value="'+a+'">');popup=window.open("about:blank","newPopup","width=792, height=652");popup.focus();$("body").append(b);b.submit();$(b).remove();return false})},bindRequestRestockNotiBtnClick:function(){$(document).off("click",'[id^="requestRestockNotiBtn"]');$(document).on("click",'[id^="requestRestockNotiBtn"]',function(){var a=$(this).data("productcode");ACC.cart.openRequestRestockNotiPage(a);return false})},bindMiniCartRemoveItemBtnClick:function(){$("#miniCartRemoveItemBtn").off("click");$("#miniCartRemoveItemBtn").click(function(){var a=[];$.each($('input[name="miniCart_entry_check"]:checked'),function(b,c){a.push($(this).data("entrynumber"))});ACC.cart.removeCartItemList(a);return false})},bindMiniCartBuynowBtnClick:function(){$("#miniCartBuynowBtn").off("click");$("#miniCartBuynowBtn").click(function(){var a=[];$.each($('input[name="miniCart_entry_check"]:checked'),function(b,c){a.push($(this).data())});if(typeof(a)!="undefined"&&a!=""&&a.length>0){ACC.cart.buynowList(a)}else{ACC.cart.showAlert("您尚未选择商品, 请选择商品。")}return false})},bindMiniCartUpdateItemBtnClick:function(){$('[id^="miniCartUpdateItemBtn"]').off("click");$('[id^="miniCartUpdateItemBtn"]').click(function(){var c=ACC.cart.data.miniCartUpdateItemUrl;var a=$(this).data("entrynumber");var d=$(this).parent().find(".pcount").val();var b={url:c,data:{entryNumber:a,quantity:d,CSRFToken:ACC.cart.data.token},type:"POST",error:ACC.cart.ajaxError,success:function(e){ACC.cart.refreshMiniCart(e);if(location.href.indexOf(ACC.cart.data.cartPageUrl)!=-1&&location.href.match(/cart$/)!=null){ACC.cart.refreshCartPageAjax()}if(e.result=="success"){}else{ACC.cart.showAlert(e.errorMsg)}ACC.cart.refreshMiniCart(e)}};$.ajax(b);return false})},bindCheckBoxClick:function(){$(".product_list input[name=cart_entry_check]").on("change",function(){var a=[];$.each($("input[name=cart_entry_check]:checked").parents("li"),function(b,c){a.push($(this).data("entrynumber"))});$("#selectedEntryCnt").html("("+$("input[name=cart_entry_check]:checked").length+")");ACC.cart.refreshMiniCalculator(a)});$("#all_check, #all_check1").on("change",function(){var a=[];if($(this).is(":checked")){$.each($("input[name=cart_entry_check]").parents("li"),function(b,c){a.push($(this).data("entrynumber"))});$("#selectedEntryCnt").html("("+$("input[name=cart_entry_check]").length+")")}else{$("#selectedEntryCnt").html("("+0+")")}ACC.cart.refreshMiniCalculator(a)});$(".cart_list_sky input[name=cart_entry_check]").on("change",function(){$("#selectedMiniCartEntryCount").html($("input[name=miniCart_entry_check]:checked").length)})},refreshMiniCalculator:function(b,d){if(typeof(b)!="undefined"&&b!=""&&b.length!=0){if(MiniCalculator.data.processingCart){return false}var c=contextPath+"/cart/miniCalculator";var d=true;var a={url:c,data:$.param({entryNumbers:b,infomationNeededToMiniCalculator:d},true),async:false,type:"POST",error:ACC.cart.ajaxError,beforeSend:function(){if(typeof(openProgressDialog)=="function"){openProgressDialog()}MiniCalculator.data.processingCart=true},complete:function(){if(typeof(closeProgressDialog)=="function"){closeProgressDialog()}MiniCalculator.data.processingCart=false},success:function(e){$("#miniCalculator_refreshDiv").html(e);$("#totalUnlimitAvailMileageAmount3").hide();bindOpenPopupBtnClick("miniCalculator_refreshDiv")}};$.ajax(a)}else{$("#totalSaleAmount").text("$0");$("#totalDiscountAmount2").text("$0");$(".minusList").hide();$("#totalPaymentAmount2").text("$0");$("#totalPaymentAmount3").text("(￦ 0 / 约 ¥ 0)")}},ajaxError:function(a){ACC.cart.showAlert("伺服器连线发生错误。")},formatPrice:function(a){return a.formattedValue.split(".")[0]},getImageUrl:function(c,d){var b="";if(c.galleryImages&&c.galleryImages.length>0){if(typeof(c.galleryImages[0][d])=="object"){b=c.galleryImages[0][d].url;var a=b.split("://");var e=a[0]+":";if(e!=location.protocol){b=location.protocol+"//"+a[1]}}}return b},openRequestRestockNotiPage:function(b){if(ACC.cart.data.isAnonymous){ACC.customer.openLoginPopup();return false}else{if(ACC.cart.data.memberType!="01"){ACC.customer.goChangeRegularPopup();return false}}if(b!=undefined&&b!=""){var a=$("<form></form>");a.attr("action",ACC.cart.data.requestRestockNotiUrl);a.attr("method","get");a.append('<input type="hidden" name="productCode" value="'+b+'">');$("body").append(a);a.submit();$(a).remove()}else{ACC.cart.showAlert("product code error")}},openRequestSpecialOrderPage:function(b){if(ACC.cart.data.isAnonymous){ACC.customer.openLoginPopup();return false}else{if(ACC.cart.data.memberType!="01"){ACC.customer.goChangeRegularPopup();return false}else{if(ACC.cart.data.passportNumber=="-"||ACC.cart.data.passportExpireDate=="2199-12-31"){ACC.customer.goChangeRegularFromNewPopup();return false}}}if(b!=undefined&&b!=""){var a=ACC.cart.data.requestSpecialOrderUrl+"?productCode="+b;window.location.href=a}else{ACC.cart.showAlert("产品代码错误")}},openCsSpecialOrderPage:function(){if(ACC.cart.data.isAnonymous){ACC.customer.openLoginPopup();return false}else{if(ACC.cart.data.memberType!="01"){ACC.customer.goChangeRegularPopup();return false}else{if(ACC.cart.data.passportNumber=="-"||ACC.cart.data.passportExpireDate=="2199-12-31"){ACC.customer.goChangeRegularFromNewPopup();return false}}window.location.href=ACC.cart.data.openCsSpecialOrderUrl}},showAlert:function(a){var b=$("<div>").html(a).text().replace("\\n","\n");alert(b)},popupExMileageList:function(){var a=contextPath+"/cart/downAbleExMileageList";$("#brandPointBody").empty();var c=null;var b=Number($("#addListCounter").val())+10;if(b<10){b=10}$("#addListCounter").val(b);$.ajax({type:"POST",url:a,crossOrigin:true,data:{CSRFToken:ACC.cart.data.token,productCode:c,page:0},error:function(f,d,e){alert(e)},success:function(m){var d=m.searchPageData.results;if(d.length==0){var f=$('<div class="none_txt"><p>没有可下载的专用积分。</p></div>');$("#exMileageTable").append(f)}else{for(var g=0;g<d.length;g++){var l="";var k=d[g].dcTypeCd.code;var e=d[g].payDescValue;if(k=="1"){l="￦"+convertNumber(e)}else{if(k=="2"){l="$"+convertNumber(e)}else{if(k=="3"){l=convertNumber(e)+"%"}else{l=convertNumber(e)}}}var h='<tr><td><div class="ck_box"><input class="css-checkbox" type="checkbox" name="downloadExMileage" data-offrid="'+d[g].offrId+'" data-productcode="'+d[g].useProductCode+'"data-coupontype="" id="downloadableCoupon'+g+'"><label for="downloadableCoupon'+g+'" class="css-label" style="background-position: 0px 0px;"></label><p class="mg_txt"><strong>'+l+"</strong>"+d[g].offrNm+"</p>";h+="</tr>";$("#brandPointBody").append(h)}$("#exMileagePagination").remove();var j='<p id="exMileagePagination" class="view_more"><a href="#">再看更多</a></p>';if(m.searchPageData.pagination.totalNumberOfResults>10){$("#mileageViewMore").append(j)}}}})}};function convertNumber(g,a){var c=parseFloat(g);var b=2;if(isNaN(c)){return"0"}if(typeof(a)!="undefined"){b=a}b=Math.pow(10,b);c=c*b;c=Math.round(c);c=c/b;c=String(c);var f=/(^[+-]?\d+)(\d{3})/;var e=c.split(".");var i=e[0];var h=e[1]?"."+e[1]:"";while(f.test(i)){i=i.replace(f,"$1,$2")}return i+h}function bindOpenPopupBtnClick(b){if(b=="miniCalculator_refreshDiv"){var c=$("#cal");c.on("click",function(d){if($("input[name=cart_entry_check]:checked").parents("li").length<=0){alert("没有可用的积分。");return false}popClick($(this));d.preventDefault()})}var a=$(".open-popup");a.on("click",function(d){popClick($(this));d.preventDefault()})}$(document).ready(function(){});