MiniCalculator={priceFormat:{usd:{prefix:"$ ",centsSeparator:".",thousandsSeparator:",",centsLimit:2,limit:false,allowNegative:true},KRW:{prefix:"￦ ",suffix:"",centsSeparator:".",thousandsSeparator:",",centsLimit:0,limit:false,allowNegative:true},CNY:{prefix:"约 ¥ ",centsSeparator:".",thousandsSeparator:",",centsLimit:2,limit:false,allowNegative:true},usdWithoutSymbol:{prefix:"",centsSeparator:".",thousandsSeparator:",",centsLimit:2,limit:false,allowNegative:true},KRWWithoutSymbol:{prefix:"",suffix:"",centsSeparator:".",thousandsSeparator:",",centsLimit:0,limit:false,allowNegative:true}},exchangeRate:{KRW:1000,CNY:1},entries:{},duplicateMileageIds:{},categoryMileageIds:{},mobileMileageIds:{},brandClassInfos:{},excludeMileageProducts:[],excludeClubMileageProducts:[],excludeSClubMileageProducts:[],couponAmountAllEntries:[],isSRewardsIntgrPreOpen:true,data:{commonResourcePath:"/estore/_ui/desktop/common",mileageCurrency:"",totalPrice:0,totalWonPrice:0,totalBasisDiscount:0,totalWonBasisDiscount:0,totalDiscount:0,totalWonDiscount:0,totalPayment:0,totalWonPayment:0,totalCnyPayment:0,totalCouponDiscount:0,totalOrderCouponDiscount:0,totalWonCouponDiscount:0,totalSavedMileage:0,totalAdjustAmount:0,totalWonAdjustAmount:0,totalProductCouponUse:0,totalCartCouponUse:0,totalAdditionalCouponUse:0,totalAppliedSavedMileage:0,totalAppliedSavedMileageReserve:0,totalAppliedSavedMileageUse:0,totalOriAppliedSavedMileage:0,totalAppliedUnlimitMileageUse:0,totalAppliedLimitMileageUse:0,totalAppliedLimitAllianceMileageUse:0,totalAppliedDuplicateMileageUse:0,totalAppliedMobileMileageUse:0,totalAppliedUsdVoucherMileageUse:0,totalAppliedVoucherMileageUse:0,totalAppliedAdditionalMileageUse:0,totalAppliedEventMileage:0,totalAppliedEventMileageUse:0,totalAppliedMileageUse:0,totalAppliedShillaMoneyUse:0,totalAppliedSRewardUse:0,totalAppliedSRewardUsePoint:0,totalAppliedShillaDepositUse:0,totalAppliedOkCashBackUse:0,totalAppliedHappyMoneyUse:0,totalAppliedOhPointUse:0,totalAppliedOllehPointUse:0,totalAppliedClubMileageUse:0,totalAppliedClubMileageUsePoint:0,totalAppliedSpecialSRewardUse:0,totalAppliedSpecialSRewardUsePoint:0,totalAppliedSavedClubMileage:0,totalWonProductCouponUse:0,totalWonCartCouponUse:0,totalWonAdditionalCouponUse:0,totalWonAppliedSavedMileage:0,totalWonAppliedSavedMileageReserve:0,totalWonAppliedSavedMileageUse:0,totalWonAppliedUnlimitMileageUse:0,totalWonAppliedLimitMileageUse:0,totalWonAppliedDuplicateMileageUse:0,totalWonAppliedMobileMileageUse:0,totalWonAppliedUsdVoucherMileageUse:0,totalWonAppliedVoucherMileageUse:0,totalWonAppliedAdditionalMileageUse:0,totalWonAppliedEventMileage:0,totalWonAppliedEventMileageUse:0,totalWonAppliedMileageUse:0,totalWonAppliedShillaMoneyUse:0,totalWonAppliedSRewardUse:0,totalWonAppliedShillaDepositUse:0,totalWonAppliedOkCashBackUse:0,totalWonAppliedHappyMoneyUse:0,totalWonAppliedOhPointUse:0,totalWonAppliedOllehPointUse:0,totalWonAppliedClubMileageUse:0,totalWonAppliedSpecialSRewardUse:0,appliedCartCoupon:null,appliedAdditionalCoupon:null,appliedCartCouponCount:0,appliedAdditionalCouponCount:0,appliedProductCoupons:[],appliedLimitMileages:[],appliedLimitAllianceMileages:[],appliedDuplicateMileages:[],appliedOllehInfo:null,appliedHappyMoneyInfo:null,availableUnlimtMileage:0,availableUsdVoucherMileage:0,availableVoucherMileage:0,availableShillaMoney:0,availableSReward:0,availableSRewardPoint:0,availableShillaDeposit:0,availableOPoint:0,availableOkCashBack:0,availableMobileMileage:0,availableSClubMileage:0,availableSClubEventMileage:0,sclubMlgeUseOrderLimitAmt:0,sclubMlgeHurdleRate:0,sclubMlgeHurdleAmount:0,sclubMileageMinimumUse:0,expectedSClubMileage:null},init:function(option){if(option.exchangeRate){with(MiniCalculator.exchangeRate){KRW=option.exchangeRate.KRW;CNY=option.exchangeRate.CNY}}if(option.paymentMode){MiniCalculator.paymentMode=option.paymentMode}if(option.entries){MiniCalculator.entries=option.entries;$.each(MiniCalculator.entries,function(index,el){el.productName=MiniCalculator.decodeEntities(el.productName)});MiniCalculator.entries.sort(function(a,b){if(a.discountSaleAmount==b.discountSaleAmount){return a.entryNumber-b.entryNumber}return a.discountSaleAmount-b.discountSaleAmount})}if(option.duplicateMileageIds){MiniCalculator.duplicateMileageIds=option.duplicateMileageIds}if(option.categoryMileageIds){MiniCalculator.categoryMileageIds=option.categoryMileageIds}if(option.mobileMileageIds){MiniCalculator.mobileMileageIds=option.mobileMileageIds}if(option.brandClassInfos){MiniCalculator.brandClassInfos=option.brandClassInfos}if(option.excludeMileageProducts){MiniCalculator.excludeMileageProducts=option.excludeMileageProducts}if(option.excludeClubMileageProducts){MiniCalculator.excludeClubMileageProducts=option.excludeClubMileageProducts}if(option.excludeSClubMileageProducts){MiniCalculator.excludeSClubMileageProducts=option.excludeSClubMileageProducts}MiniCalculator.isSRewardsIntgrPreOpen=option.isSRewardsIntgrPreOpen;with(MiniCalculator.data){commonResourcePath=option.commonResourcePath;mileageCurrency=option.mileageCurrency;totalPrice=option.totalPrice;totalWonPrice=option.totalWonPrice;totalPayment=option.totalPayment;totalWonPayment=option.totalWonPayment;totalBasisDiscount=option.totalBasisDiscount;totalWonBasisDiscount=option.totalWonBasisDiscount;totalSavedMileage=option.totalSavedMileage;totalUsableMileage=option.totalUsableMileage;availableUnlimtMileage=option.availableUnlimtMileage;availableUsdVoucherMileage=option.availableUsdVoucherMileage;availableVoucherMileage=option.availableVoucherMileage;availableShillaMoney=option.availableShillaMoney;availableShillaDeposit=option.availableShillaDeposit;availableMobileMileage=0;totalOriAppliedSavedMileage=option.totalOriAppliedSavedMileage;availableSClubMileage=option.availableSClubMileage;availableSClubEventMileage=option.availableSClubEventMileage;sclubMlgeUseOrderLimitAmt=option.sclubMlgeUseOrderLimitAmt;sclubMlgeHurdleRate=option.sclubMlgeHurdleRate;sclubMileageMinimumUse=option.sclubMileageMinimumUse;expectedSClubMileage=option.expectedSClubMileage;totalProductCouponUse=0;totalCartCouponUse=0;totalAdditionalCouponUse=0;totalAppliedSavedMileage=0;totalAppliedSavedMileageUse=0;totalAppliedUnlimitMileageUse=0;totalAppliedLimitMileageUse=0;totalAppliedLimitAllianceMileageUse=0;totalAppliedDuplicateMileageUse=0;totalAppliedMobileMileageUse=0;totalAppliedUsdVoucherMileageUse=0;totalAppliedVoucherMileageUse=0;totalAppliedAdditionalMileageUse=0;totalAppliedEventMileage=0;totalAppliedEventMileageUse=0;totalAppliedMileageUse=0;totalAppliedShillaMoneyUse=0;totalAppliedSRewardUse=0;totalAppliedShillaDepositUse=0;totalAppliedOkCashBackUse=0;totalAppliedHappyMoneyUse=0;totalAppliedOhPointUse=0;totalAppliedOllehPointUse=0;totalAppliedClubMileageUse=0;totalAppliedSpecialSRewardUse=0;totalAppliedSavedClubMileage=0;totalWonProductCouponUse=0;totalWonCartCouponUse=0;totalWonAdditionalCouponUse=0;totalWonAppliedSavedMileage=0;totalWonAppliedSavedMileageUse=0;totalWonAppliedUnlimitMileageUse=0;totalWonAppliedLimitMileageUse=0;totalWonAppliedDuplicateMileageUse=0;totalWonAppliedMobileMileageUse=0;totalWonAppliedUsdVoucherMileageUse=0;totalWonAppliedVoucherMileageUse=0;totalWonAppliedAdditionalMileageUse=0;totalWonAppliedEventMileage=0;totalWonAppliedEventMileageUse=0;totalWonAppliedMileageUse=0;totalWonAppliedShillaMoneyUse=0;totalWonAppliedSRewardUse=0;totalWonAppliedShillaDepositUse=0;totalWonAppliedOkCashBackUse=0;totalWonAppliedHappyMoneyUse=0;totalWonAppliedOhPointUse=0;totalWonAppliedOllehPointUse=0;totalWonAppliedClubMileageUse=0;totalWonAppliedSpecialSRewardUse=0;appliedCartCoupon=null;appliedAdditionalCoupon=null;appliedCartCouponCount=0;appliedAdditionalCouponCount=0;appliedProductCoupons=[];appliedLimitMileages=[];appliedLimitAllianceMileages=[];appliedDuplicateMileages=[]}},decodeEntities:function(b){var c,a=document.createElement("p");a.innerHTML=b;c=a.textContent||a.innerText;a=null;return c},exchange:function(b,a){return round(b*a*100)/100},calculatePrice:function(recalulate){with(MiniCalculator.data){totalCouponDiscount=MiniCalculator.round(totalProductCouponUse+totalCartCouponUse+totalAdditionalCouponUse,2);totalWonCouponDiscount=totalWonProductCouponUse+totalWonCartCouponUse+totalWonAdditionalCouponUse;totalOrderCouponDiscount=MiniCalculator.round(totalCartCouponUse+totalAdditionalCouponUse,2);totalAppliedMileageUse=MiniCalculator.round(totalAppliedSavedMileageUse+totalAppliedUnlimitMileageUse+totalAppliedLimitMileageUse+totalAppliedDuplicateMileageUse+totalAppliedMobileMileageUse+totalAppliedAdditionalMileageUse+totalAppliedEventMileageUse,2);totalWonAppliedMileageUse=totalWonAppliedSavedMileageUse+totalWonAppliedUnlimitMileageUse+totalWonAppliedLimitMileageUse+totalWonAppliedDuplicateMileageUse+totalWonAppliedMobileMileageUse+totalWonAppliedAdditionalMileageUse+totalWonAppliedEventMileageUse;totalDiscount=MiniCalculator.round(totalBasisDiscount+totalCouponDiscount+totalAppliedMileageUse+totalAppliedSRewardUse+totalAppliedShillaMoneyUse+totalAppliedShillaDepositUse+totalAppliedOkCashBackUse+totalAppliedHappyMoneyUse+totalAppliedOhPointUse+totalAppliedOllehPointUse+totalAppliedUsdVoucherMileageUse+totalAppliedVoucherMileageUse+totalAdjustAmount+totalAppliedClubMileageUse+totalAppliedSpecialSRewardUse,2);totalWonDiscount=totalWonBasisDiscount+totalWonCouponDiscount+totalWonAppliedMileageUse+totalWonAppliedSRewardUse+totalWonAppliedShillaMoneyUse+totalWonAppliedShillaDepositUse+totalWonAppliedOkCashBackUse+totalWonAppliedHappyMoneyUse+totalWonAppliedOhPointUse+totalWonAppliedOllehPointUse+totalWonAppliedUsdVoucherMileageUse+totalWonAppliedVoucherMileageUse+totalWonAdjustAmount+totalWonAppliedClubMileageUse+totalWonAppliedSpecialSRewardUse;totalPayment=MiniCalculator.round(totalPrice-totalDiscount,2);totalWonPayment=totalWonPrice-totalWonDiscount;totalCnyPayment=MiniCalculator.exchange(totalPayment,MiniCalculator.exchangeRate.CNY);MiniCalculator.applyOlleh(appliedOllehInfo);MiniCalculator.adjustAmount(recalulate);MiniCalculator.extraProcess();MiniCalculator.refreshPage();MiniCalculator.expectedSaveClubMileage()}},extraProcess:function(){},applyProductCoupon:function(coupon,isApply){with(MiniCalculator){resetForCouponUse();resetForUpdateCoupon();if(isApply){for(i=0;i<data.appliedProductCoupons.length;i++){if(data.appliedProductCoupons[i].productcode==coupon.productcode){$("#productCoupon_"+data.appliedProductCoupons[i].couponid).click()}}data.appliedProductCoupons.push(coupon)}else{for(i=0;i<data.appliedProductCoupons.length;i++){if(data.appliedProductCoupons[i].couponid==coupon.couponid){data.appliedProductCoupons.splice(i,1)}}}var discountamount=0;var wondiscountamount=0;if(typeof data.appliedProductCoupons!="undefined"&&data.appliedProductCoupons!=null){for(i=0;i<data.appliedProductCoupons.length;i++){discountamount=round(discountamount+parseFloat(data.appliedProductCoupons[i].discountamount),2);wondiscountamount=round(wondiscountamount+parseFloat(data.appliedProductCoupons[i].wondiscountamount))}}data.totalProductCouponUse=round(parseFloat(discountamount),2);data.totalWonProductCouponUse=round(parseFloat(wondiscountamount));updateSavedMileage();calculatePrice()}},applyCartCoupon:function(coupon){with(MiniCalculator){resetForCouponUse();resetForUpdateCoupon();var prodUsdCpnDcSumAmt=data.totalPrice-data.totalCouponDiscount;var prodWonCpnDcSumAmt=data.totalWonPrice-data.totalWonCouponDiscount;var cartCouponDiscountSumAmount=0;var wonCartCouponDiscountSumAmount=0;var targetItemIndex=Array();var targetAmount=0;if(typeof(coupon)!="undefined"&&typeof(coupon.couponid)!="undefined"){var prodArrs=coupon.dcprodlist.split(",");data.appliedCartCouponCount=0;$.each(prodArrs,function(index,el){if(el!=""){var entry=$.grep(MiniCalculator.entries,function(e){return e.entryNumber==el});if(typeof(entry)!="undefined"&&entry.length>0){var discountSaleAmount=parseFloat(entry[0].discountSaleAmount,10);var quantity=parseInt(entry[0].quantity,10);var couponDiscountAmount=round(discountSaleAmount*coupon.dcfixrate/100,2);cartCouponDiscountSumAmount=round(cartCouponDiscountSumAmount+couponDiscountAmount*quantity,2);wonCartCouponDiscountSumAmount=wonCartCouponDiscountSumAmount+MiniCalculator.toWonAmt(couponDiscountAmount)*quantity;targetItemIndex.push(index);targetAmount+=round(discountSaleAmount*quantity,2);data.appliedCartCouponCount=data.appliedCartCouponCount+1}}});if(typeof(coupon.maxdcamt)!="undefined"&&coupon.maxdcamt!=""&&!isNaN(coupon.maxdcamt)&&cartCouponDiscountSumAmount>coupon.maxdcamt){cartCouponDiscountSumAmount=coupon.maxdcamt;wonCartCouponDiscountSumAmount=toWonAmt(cartCouponDiscountSumAmount)}if(coupon.dctype=="1"){cartCouponDiscountSumAmount=toUsdAmt(coupon.dcfixamt);wonCartCouponDiscountSumAmount=coupon.dcfixamt}else{if(coupon.dctype=="2"){cartCouponDiscountSumAmount=coupon.dcfixamt;wonCartCouponDiscountSumAmount=toWonAmt(coupon.dcfixamt)}}if(prodArrs.length==0){alert("目前没有可使用优惠券的商品。");data.totalCartCouponUse=0;data.totalWonCartCouponUse=0}else{data.totalCartCouponUse=round(parseFloat(cartCouponDiscountSumAmount),2);data.totalWonCartCouponUse=round(parseFloat(wonCartCouponDiscountSumAmount));data.appliedCartCoupon=coupon}}else{data.totalCartCouponUse=0;data.totalWonCartCouponUse=0;data.appliedCartCouponCount=0;data.appliedCartCoupon=coupon}updateSavedMileage();calculatePrice()}},applyAdditionalCoupon:function(coupon){with(MiniCalculator){resetForCouponUse();resetForUpdateCoupon();var prodUsdCpnDcSumAmt=data.totalPrice-data.totalCouponDiscount;var prodWonCpnDcSumAmt=data.totalWonPrice-data.totalWonCouponDiscount;var additionalCouponDiscountSumAmount=0;var wonAdditionalCouponDiscountSumAmount=0;var targetItemIndex=Array();var targetAmount=0;if(typeof(coupon)!="undefined"&&typeof(coupon.couponid)!="undefined"){var prodArrs=coupon.dcprodlist.split(",");data.appliedAdditionalCouponCount=0;$.each(prodArrs,function(index,el){if(el!=""){var entry=$.grep(MiniCalculator.entries,function(e){return e.entryNumber==el});if(typeof(entry)!="undefined"&&entry.length>0){var discountSaleAmount=parseFloat(entry[0].discountSaleAmount,10);var quantity=parseInt(entry[0].quantity,10);var couponDiscountAmount=round(discountSaleAmount*coupon.dcfixrate/100,2);additionalCouponDiscountSumAmount=round(additionalCouponDiscountSumAmount+couponDiscountAmount*quantity,2);wonAdditionalCouponDiscountSumAmount=wonAdditionalCouponDiscountSumAmount+MiniCalculator.toWonAmt(couponDiscountAmount)*quantity;targetItemIndex.push(index);targetAmount+=round(discountSaleAmount*quantity,2);data.appliedAdditionalCouponCount=data.appliedAdditionalCouponCount+1}}});if(typeof(coupon.maxdcamt)!="undefined"&&coupon.maxdcamt!=""&&!isNaN(coupon.maxdcamt)&&additionalCouponDiscountSumAmount>coupon.maxdcamt){additionalCouponDiscountSumAmount=coupon.maxdcamt;wonAdditionalCouponDiscountSumAmount=toWonAmt(additionalCouponDiscountSumAmount)}if(coupon.dctype=="1"){additionalCouponDiscountSumAmount=toUsdAmt(coupon.dcfixamt);wonAdditionalCouponDiscountSumAmount=coupon.dcfixamt}else{if(coupon.dctype=="2"){additionalCouponDiscountSumAmount=coupon.dcfixamt;wonAdditionalCouponDiscountSumAmount=toWonAmt(coupon.dcfixamt)}}if(prodArrs.length==0){alert("目前没有可使用优惠券的商品。");data.totalAdditionalCouponUse=0;data.totalWonAdditionalCouponUse=0}else{data.totalAdditionalCouponUse=round(parseFloat(additionalCouponDiscountSumAmount),2);data.totalWonAdditionalCouponUse=round(parseFloat(wonAdditionalCouponDiscountSumAmount));data.appliedAdditionalCoupon=coupon}}else{data.totalAdditionalCouponUse=0;data.totalWonAdditionalCouponUse=0;data.appliedAdditionalCouponCount=0;data.appliedAdditionalCoupon=coupon}updateSavedMileage();calculatePrice()}},releaseCoupon:function(couponId){with(MiniCalculator){for(i=0;i<data.appliedProductCoupons.length;i++){if(data.appliedProductCoupons[i].couponId==couponId){data.appliedProductCoupons.splice(i,1)}}if(typeof data.appliedCartCoupon!="undefined"&&data.appliedCartCoupon!=null&&data.appliedCartCoupon.couponId==couponId){data.appliedCartCoupon=null}calculatePrice()}},resetForUpdateCoupon:function(){$.each(MiniCalculator.entries,function(a,b){if(b.savedMileage!=b.oriSavedMileage){b.savedMileage=b.oriSavedMileage}})},resetForCouponUse:function(){with(MiniCalculator){if(data.totalWonAppliedUnlimitMileageUse!=0||data.totalAppliedUsdVoucherMileageUse!=0||data.totalAppliedVoucherMileageUse!=0||data.totalAppliedMobileMileageUse!=0||data.totalAppliedShillaDepositUse!=0||data.totalAppliedShillaMoneyUse!=0||data.totalAppliedDuplicateMileageUse!=0||data.totalAppliedAdditionalMileageUse!=0||data.totalAppliedSavedMileage!=0||data.totalAppliedEventMileageUse!=0||data.totalAppliedClubMileageUse!=0||data.totalAppliedSRewardUse!=0||data.totalAppliedSpecialSRewardUse!=0||($("#searchSReward").length>0&&$("#searchSReward").css("display")=="none")||($("#searchSpecialReward").length>0&&$("#searchSpecialReward").css("display")=="none")){if(!data.alerted){alert("选择使用或取消使用优惠券时，您需再次输入要折抵的积分金额。");data.alerted=true}applyMobileMileage(0);applyShillaDeposit(0);applyClubMileage(0);applySpecialSReward(null);applyUsdVoucherMileage(0);applyVoucherMileage(0);applyShillaMny(0);applyMileage(0);applyAdditionalMileage(0);applySavedMileage(0);applyEventMileage(0);if(typeof(SRewardDisable)!="undefined"){SRewardDisable()}$("#maxUnlimitMileage").attr("checked",false);$("#maxUnlimitMileage").next("label").css("background-position","0px 0px");$("#useAllShillaMoney").attr("checked",false);$("#useAllShillaMoney").next("label").css("background-position","0px 0px");$("#totalUsedUsdVoucherMileage").attr("checked",false);$("#totalUsedUsdVoucherMileage").next("label").css("background-position","0px 0px");$("#totalUsedVoucherMileage").attr("checked",false);$("#totalUsedVoucherMileage").next("label").css("background-position","0px 0px");$("#useAllShillaDeposit").attr("checked",false);$("#useAllShillaDeposit").next("label").css("background-position","0px 0px");if(isSRewardsIntgrPreOpen){$("#totalUsedClubMileage").prop("checked",false);$("#totalUsedClubMileage").next("label").css("background-position","0px 0px")}if(typeof(OnlineRewardDisable)!="undefined"){OnlineRewardDisable()}$("#availableEventMileage").attr("checked",false);$("#availableEventMileage").next("label").css("background-position","0px 0px");if(mobileMileageIds.length>0&&$("#mobileMileageIds").length>0){$("#mobileMileageIds option:eq(0)").prop("selected",true)}data.alerted=false}}},resetForMileageUse:function(){with(MiniCalculator){if(data.totalAppliedUsdVoucherMileageUse!=0||data.totalAppliedVoucherMileageUse!=0||data.totalAppliedShillaDepositUse!=0||data.totalAppliedShillaMoneyUse!=0||data.totalAppliedClubMileageUse!=0||data.totalAppliedSRewardUse!=0||data.totalAppliedMobileMileageUse!=0||data.totalAppliedSpecialSRewardUse!=0||($("#searchSReward").length>0&&$("#searchSReward").css("display")=="none")||($("#searchSpecialReward").length>0&&$("#searchSpecialReward").css("display")=="none")){if(!data.alerted){var rewardsText=(isSRewardsIntgrPreOpen?"Rewards Point":"S.Rewards");var srewardsText=(isSRewardsIntgrPreOpen?"新罗金币":"中文网 S.Rewards");alert("重新使用或取消积分使用时，需重新输入欲用优惠积分，特惠积分, 合作积分, "+rewardsText+", "+srewardsText+" 等。");data.alerted=true}applyMobileMileage(0);applyShillaDeposit(0);applyClubMileage(0);applySpecialSReward(null);applyUsdVoucherMileage(0);applyVoucherMileage(0);applyShillaMny(0);if(typeof(SRewardDisable)!="undefined"){SRewardDisable()}$("#useAllShillaMoney").attr("checked",false);$("#useAllShillaMoney").next("label").css("background-position","0px 0px");$("#totalUsedUsdVoucherMileage").attr("checked",false);$("#totalUsedUsdVoucherMileage").next("label").css("background-position","0px 0px");$("#totalUsedVoucherMileage").attr("checked",false);$("#totalUsedVoucherMileage").next("label").css("background-position","0px 0px");$("#useAllShillaDeposit").attr("checked",false);$("#useAllShillaDeposit").next("label").css("background-position","0px 0px");if(isSRewardsIntgrPreOpen){$("#totalUsedClubMileage").prop("checked",false);$("#totalUsedClubMileage").next("label").css("background-position","0px 0px")}if(typeof(OnlineRewardDisable)!="undefined"){OnlineRewardDisable()}if(mobileMileageIds.length>0&&$("#mobileMileageIds").length>0){$("#mobileMileageIds option:eq(0)").prop("selected",true)}data.alerted=false}}},resetForSReward:function(){with(MiniCalculator){if(data.totalAppliedUsdVoucherMileageUse!=0||data.totalAppliedVoucherMileageUse!=0||data.totalAppliedShillaDepositUse!=0||data.totalAppliedMobileMileageUse!=0||data.totalAppliedShillaMoneyUse!=0||data.totalAppliedClubMileageUse!=0||data.totalAppliedSpecialSRewardUse!=0||($("#searchSpecialReward").length>0&&$("#searchSpecialReward").css("display")=="none")){if(!data.alerted){alert((isSRewardsIntgrPreOpen?"Rewards Point":"S.Rewards")+" 适用取消时，要重新输入之前输入的Point。");data.alerted=true}applyMobileMileage(0);applyShillaDeposit(0);applyClubMileage(0);applySpecialSReward(null);applyUsdVoucherMileage(0);applyVoucherMileage(0);applyShillaMny(0);$("#useAllShillaMoney").attr("checked",false);$("#useAllShillaMoney").next("label").css("background-position","0px 0px");$("#totalUsedUsdVoucherMileage").attr("checked",false);$("#totalUsedUsdVoucherMileage").next("label").css("background-position","0px 0px");$("#totalUsedVoucherMileage").attr("checked",false);$("#totalUsedVoucherMileage").next("label").css("background-position","0px 0px");if(isSRewardsIntgrPreOpen){$("#totalUsedClubMileage").prop("checked",false);$("#totalUsedClubMileage").next("label").css("background-position","0px 0px")}if(typeof(OnlineRewardDisable)!="undefined"){OnlineRewardDisable()}$("#useAllShillaDeposit").attr("checked",false);$("#useAllShillaDeposit").next("label").css("background-position","0px 0px");if(mobileMileageIds.length>0&&$("#mobileMileageIds").length>0){$("#mobileMileageIds option:eq(0)").prop("selected",true)}data.alerted=false}}},resetForShillaMoenyUse:function(){with(MiniCalculator){if(data.totalAppliedUsdVoucherMileageUse!=0||data.totalAppliedVoucherMileageUse!=0||data.totalAppliedShillaDepositUse!=0||data.totalAppliedMobileMileageUse!=0){applyMobileMileage(0);applyShillaDeposit(0);applyUsdVoucherMileage(0);applyVoucherMileage(0);$("#totalUsedUsdVoucherMileage").attr("checked",false);$("#totalUsedUsdVoucherMileage").next("label").css("background-position","0px 0px");$("#totalUsedVoucherMileage").attr("checked",false);$("#totalUsedVoucherMileage").next("label").css("background-position","0px 0px");$("#useAllShillaDeposit").attr("checked",false);$("#useAllShillaDeposit").next("label").css("background-position","0px 0px");if(mobileMileageIds.length>0&&$("#mobileMileageIds").length>0){$("#mobileMileageIds option:eq(0)").prop("selected",true)}alert("选择使用或取消折抵积分时，商品券转换积分，新罗金币。")}}},resetForUsdVoucherMileageUse:function(){with(MiniCalculator){if(data.totalAppliedVoucherMileageUse!=0||data.totalAppliedShillaDepositUse!=0||data.totalAppliedClubMileageUse!=0||data.totalAppliedMobileMileageUse!=0||data.totalAppliedSpecialSRewardUse!=0||($("#searchSpecialReward").length>0&&$("#searchSpecialReward").css("display")=="none")){if(!data.alerted){var srewardsText=(isSRewardsIntgrPreOpen?"新罗金币":"中文网 S.Rewards");alert("重新使用或取消积分使用时，需重新输入欲用优惠积分，"+srewardsText+"等。");data.alerted=true}applyMobileMileage(0);applyShillaDeposit(0);applyClubMileage(0);applySpecialSReward(null);applyVoucherMileage(0);$("#totalUsedVoucherMileage").attr("checked",false);$("#totalUsedVoucherMileage").next("label").css("background-position","0px 0px");$("#useAllShillaDeposit").attr("checked",false);$("#useAllShillaDeposit").next("label").css("background-position","0px 0px");if(isSRewardsIntgrPreOpen){$("#totalUsedClubMileage").prop("checked",false);$("#totalUsedClubMileage").next("label").css("background-position","0px 0px")}if(typeof(OnlineRewardDisable)!="undefined"){OnlineRewardDisable()}if(mobileMileageIds.length>0&&$("#mobileMileageIds").length>0){$("#mobileMileageIds option:eq(0)").prop("selected",true)}data.alerted=false}}},resetForVoucherMileageUse:function(){with(MiniCalculator){if(data.totalAppliedShillaDepositUse!=0||data.totalAppliedClubMileageUse!=0||data.totalAppliedMobileMileageUse!=0||data.totalAppliedSpecialSRewardUse!=0||($("#searchSpecialReward").length>0&&$("#searchSpecialReward").css("display")=="none")){if(!data.alerted){var srewardsText=(isSRewardsIntgrPreOpen?"新罗金币":"中文网 S.Rewards");alert("重新使用或取消积分使用时，需重新输入欲用优惠积分，"+srewardsText+"等。");data.alerted=true}applyMobileMileage(0);applyShillaDeposit(0);applyClubMileage(0);applySpecialSReward(null);$("#useAllShillaDeposit").attr("checked",false);$("#useAllShillaDeposit").next("label").css("background-position","0px 0px");if(isSRewardsIntgrPreOpen){$("#totalUsedClubMileage").prop("checked",false);$("#totalUsedClubMileage").next("label").css("background-position","0px 0px")}if(typeof(OnlineRewardDisable)!="undefined"){OnlineRewardDisable()}if(mobileMileageIds.length>0&&$("#mobileMileageIds").length>0){$("#mobileMileageIds option:eq(0)").prop("selected",true)}data.alerted=false}}},resetForSpecialRewardUse:function(){with(MiniCalculator){if(data.totalAppliedMobileMileageUse!=0||data.totalAppliedClubMileageUse!=0){applyClubMileage(0);applyMobileMileage(0)}}},resetForClubMileageUse:function(){with(MiniCalculator){if(data.totalAppliedMobileMileageUse!=0){applyMobileMileage(0);if(mobileMileageIds.length>0&&$("#mobileMileageIds").length>0){$("#mobileMileageIds option:eq(0)").prop("selected",true)}}}},getEntryMileageHurdleValue:function(a){if(ACC.cart.data.isMajorGuestMember){if(ACC.cart.data.mgMileageHurdle==""||ACC.cart.data.mgMileageHurdle>100){return 100}else{return parseFloat(ACC.cart.data.mgMileageHurdle)}}if(typeof(MiniCalculator.paymentMode._17)!="undefined"&&MiniCalculator.paymentMode._17.useProductMileageHurdle==true){if(a.mileageHurdleValue>=0){return parseFloat(a.mileageHurdleValue)}}return parseFloat(MiniCalculator.paymentMode._17.maxPaymentAmountPercent)},setUseCouponAmount:function(){with(MiniCalculator){couponAmountAllEntries=[];$.each(MiniCalculator.entries,function(index,entry){couponAmountAllEntries.push({couponAmount:0,couponWonAmount:0,entry:entry})});getProductCouponUseAmount(couponAmountAllEntries,data.appliedProductCoupons,data.totalProductCouponUse);getCouponUseAmount(couponAmountAllEntries,data.appliedCartCoupon,data.totalCartCouponUse,data.totalWonCartCouponUse,data.appliedCartCouponCount);getCouponUseAmount(couponAmountAllEntries,data.appliedAdditionalCoupon,data.totalAdditionalCouponUse,data.totalWonAdditionalCouponUse,data.appliedAdditionalCouponCount)}},getProductCouponUseAmount:function(couponAmountEntries,appliedCoupons,totalCouponUse){with(MiniCalculator){if(typeof(appliedCoupons)=="undefined"||appliedCoupons==null||totalCouponUse<=0){return}$.each(appliedCoupons,function(index,coupon){var strProductCode=coupon.productcode;$.each(couponAmountEntries,function(idx,couponAmountEntry){if(couponAmountEntry.entry.productCode==strProductCode){couponAmountEntry.couponAmount=Math.round((couponAmountEntry.couponAmount+coupon.discountamount)*100)/100;couponAmountEntry.couponWonAmount=parseInt(couponAmountEntry.couponWonAmount+coupon.wondiscountamount)}})})}},getCouponUseAmount:function(couponAmountEntries,appliedCoupon,totalCouponUse,totalWonCouponUse,appliedCouponCount){with(MiniCalculator){if(typeof(appliedCoupon)=="undefined"||appliedCoupon==null||appliedCouponCount<=0||totalCouponUse<=0){return}var usdTotal=0;var lastUsdCpnDcAmt=0;var lastWonCpnDcAmt=0;var wonCpnDcEntrySumAmt=0;var appliedCouponEntries=[];var strEntryNumbers=appliedCoupon.dcprodlist;var entryNumbers=strEntryNumbers.toString().split(",");$.each(MiniCalculator.entries,function(index,entry){if($.inArray(entry.entryNumber.toString(),entryNumbers)>-1){appliedCouponEntries.push(entry);usdTotal=Math.round((usdTotal+(entry.discountSaleAmount*entry.quantity))*100)/100}});if(totalCouponUse!=null){lastUsdCpnDcAmt=totalCouponUse}if(totalWonCouponUse!=null){lastWonCpnDcAmt=parseInt(totalWonCouponUse)}appliedCouponEntries.sort(function(a,b){if(a.discountSaleAmount==b.discountSaleAmount){return a.entryNumber-b.entryNumber}return a.discountSaleAmount-b.discountSaleAmount});for(var i=0,length=appliedCouponEntries.length;i<length;i++){var entry=appliedCouponEntries[i];var rate=Math.ceil(((entry.discountSaleAmount*entry.quantity)/usdTotal)*1000000)/1000000;var usdDcAmt=Math.round(totalCouponUse*rate*100)/100;var wonDcAmt=parseInt(Math.round(parseInt(totalWonCouponUse)*rate));if(i==appliedCouponEntries.length-1){usdDcAmt=lastUsdCpnDcAmt;wonDcAmt=lastWonCpnDcAmt}if(entry.usdpaymentamount<usdDcAmt){usdDcAmt=entry.usdpaymentamount}if(entry.wonPaymentAmount<wonDcAmt){wonDcAmt=parseInt(entry.wonPaymentAmount)}if(lastUsdCpnDcAmt<usdDcAmt){usdDcAmt=lastUsdCpnDcAmt}if(lastWonCpnDcAmt<wonDcAmt){wonDcAmt=lastWonCpnDcAmt}lastUsdCpnDcAmt=Math.round((lastUsdCpnDcAmt-usdDcAmt)*100)/100;lastWonCpnDcAmt-=wonDcAmt;$.each(couponAmountEntries,function(idx,couponAmountEntry){if(couponAmountEntry.entry==entry){couponAmountEntry.couponAmount=Math.round((couponAmountEntry.couponAmount+usdDcAmt)*100)/100;couponAmountEntry.couponWonAmount=parseInt(couponAmountEntry.couponWonAmount+wonDcAmt);return false}});wonCpnDcEntrySumAmt+=wonDcAmt}var orderCpnDiff=parseInt(parseInt(totalWonCouponUse)-wonCpnDcEntrySumAmt);if(orderCpnDiff!=0){for(var i=0,length=appliedCouponEntries.length;i<length;i++){var entry=appliedCouponEntries[i];if(orderCpnDiff>0){var tmpDiff=parseInt(entry.wonPaymentAmount)-orderCpnDiff;if(tmpDiff>=0){var CouponAmountEntry=getCouponEntry(couponAmountEntries,entry);var reSetAmount=Math.round((CouponAmountEntry.couponAmount+toUsdAmt(orderCpnDiff))*100)/100;var reSetWonAmount=parseInt(CouponAmountEntry.couponWonAmount+orderCpnDiff);setCouponEntry(couponAmountEntries,entry,reSetAmount,reSetWonAmount);orderCpnDiff=0}else{var CouponAmountEntry=getCouponEntry(couponAmountEntries,entry);var reSetAmount=Math.round((CouponAmountEntry.couponAmount+toUsdAmt(parseInt(entry.wonPaymentAmount)))*100)/100;var reSetWonAmount=parseInt(CouponAmountEntry.couponWonAmount+parseInt(entry.wonPaymentAmount));setCouponEntry(couponAmountEntries,entry,reSetAmount,reSetWonAmount);orderCpnDiff=-tmpDiff}}else{if(orderCpnDiff<0){var CouponAmountEntry=getCouponEntry(couponAmountEntries,entry);var tmpDiff=parseInt(toWonAmt(CouponAmountEntry.couponAmount)+orderCpnDiff);if(tmpDiff>=0){setCouponEntry(couponAmountEntries,entry,toUsdAmt(tmpDiff),tmpDiff);orderCpnDiff=0}else{setCouponEntry(couponAmountEntries,entry,0,0);orderCpnDiff=tmpDiff}}}if(orderCpnDiff==0){break}}}return}},setCouponEntry:function(a,b,d,c){$.each(a,function(e,f){if(f.entry==b){f.couponAmount=d;f.couponWonAmount=c;return false}})},getCouponEntry:function(a,b){var c=null;$.each(a,function(d,e){if(e.entry==b){c=e;return false}});return c},getDuplicateMileageBalance:function(b,c){var a=0;$.each(b,function(d,f){var e=MiniCalculator.getUsableDuplicateMileage(f,c);if(e>0&&f.amount>e){a+=(f.amount-e)}});return a},getUsableDuplicateMileage:function(b,c){var a=[];var d=0;$.each(MiniCalculator.entries,function(e,f){if(MiniCalculator.isDupAndCategoryMileageEntry(b,f)){a.push(f)}});d=MiniCalculator.getGroupMileageHurdle(c,a);return d},getEventMileageAmount:function(a){var c=0;var b=0;$.each(a,function(d,j){var g=MiniCalculator.data.appliedLimitMileages;if(typeof(g)!="undefined"&&g!=null&&g.length>0){var f=g[0].entrynumbers;var e=f.toString().split(",");if($.inArray(j.entryNumber.toString(),e)>-1){c=parseFloat(g[0].amount)}}var h=MiniCalculator.data.appliedLimitAllianceMileages;if(typeof(h)!="undefined"&&h!=null&&h.length>0){var f=h[0].entrynumbers;var e=f.toString().split(",");if($.inArray(j.entryNumber.toString(),e)>-1){b=parseFloat(h[0].amount)}}});return(c+b)},getGroupMileageHurdle:function(d,b,f){if(b==undefined){b=MiniCalculator.entries}var e=[];var a=MiniCalculator.getExcludeProductCodes();$.each(b,function(h,k){if(k.productType=="05"){return}if($.inArray(k.productCode,a)<0||d==0){var j=MiniCalculator.getEntryMileageHurdleValue(k);var g=false;$.each(e,function(l,m){if(m.hurdleValue==j){m.entries.push(k);g=true;return false}});if(!g){e.push({hurdleValue:j,entries:[k]})}}});var c=0;$.each(e,function(g,h){var j=0;$.each(h.entries,function(k,l){j+=MiniCalculator.getAvailableDiscountSaleAmount(true,l,MiniCalculator.couponAmountAllEntries);if(ACC.cart.data.isMajorGuestMember&&MiniCalculator.data.totalAppliedSavedMileageUse>0){j=j-(l.savedMileage*l.quantity)}});c=(parseFloat(c)+parseFloat(h.hurdleValue*j/100)).toFixed(2)});return parseFloat(c)},getAvailableDiscountSaleAmount:function(g,e,b){var a=e.discountSaleAmount;var c=0;var d=MiniCalculator.getCouponEntry(b,e);c=d.couponAmount;if(!g){a=MiniCalculator.toWonAmt(a);if(ACC.cart.data.isMajorGuestMember){c=d.couponWonAmount}else{c=MiniCalculator.toWonAmt(c)}}var f=Math.round((a*e.quantity)*100)/100;return f-c},getUnlimitMileageHurdle:function(b){if(b==undefined){b=MiniCalculator.getExcludePrice()}var c=MiniCalculator.getGroupMileageHurdle(b);var d=MiniCalculator.getDupAndCategoryMileageBalance(b);if(d[0].DuplicateBalanceSum>0||d[0].CategoryBalanceSum>0){var a=(MiniCalculator.data.availableUnlimtMileage-d[0].DuplicateBalanceSum-d[0].CategoryBalanceSum);if(c>(a+MiniCalculator.data.totalAppliedLimitMileageUse)){return a+MiniCalculator.data.totalAppliedLimitMileageUse}}return c},getLimitMileageHurdle:function(d,b){var a=[];if(b!=undefined&&b.entrynumbers!=undefined){var c=b.entrynumbers.toString().split(",");$.each(MiniCalculator.entries,function(e,f){if($.inArray(f.entryNumber.toString(),c)>-1){a.push(f)}})}return MiniCalculator.getGroupMileageHurdle(d,a,true)},getMobileMileageHurdle:function(){with(MiniCalculator){var entriesMaxHurdles=new Map();var maxRate=100;if(!ACC.cart.data.isMajorGuestMember){maxRate=parseFloat(MiniCalculator.paymentMode._21.maxPaymentAmountPercent)}$.each(entries,function(index,el){var entryMaxHurdle=0;if(data.mileageCurrency=="USD"){entryMaxHurdle=round((el.discountSaleAmount-el.discountUnit-el.cartCouponUnit-el.additionalCouponUnit)*el.quantity*(maxRate/100),2)}else{if(data.mileageCurrency=="KRW"){entryMaxHurdle=getDigitAmount(toWonAmt(el.discountSaleAmount-el.discountUnit-el.cartCouponUnit-el.additionalCouponUnit)*el.quantity*(maxRate/100),0)}}if(typeof(entriesMaxHurdles.put)=="function"){entriesMaxHurdles.put(el.entryNumber,entryMaxHurdle)}else{if(typeof(entriesMaxHurdles.set)=="function"){entriesMaxHurdles.set(el.entryNumber,entryMaxHurdle)}}});var totalUseableMileageAmt=0;$.each(mobileMileageIds,function(index,mileage){var mileageUseableAmount=mileage.amount;var mileageMaxHurdle=0;var discountSalesAmountTotal=0;$.each(mileage.entries,function(index,el){var entryMaxHurdle=entriesMaxHurdles.get(el.entryNumber);mileageMaxHurdle=Math.round((mileageMaxHurdle+entryMaxHurdle)*100)/100;discountSalesAmountTotal=Math.round((discountSalesAmountTotal+el.discountSaleAmount*el.quantity)*100)/100});mileageUseableAmount=Math.min(mileageUseableAmount,mileageMaxHurdle);totalUseableMileageAmt=Math.round((totalUseableMileageAmt+mileageUseableAmount)*100)/100;var amt=0;var lastMobileMlgeUseSumAmt=mileageUseableAmount;for(var i=0;i<mileage.entries.length;i++){var entry=mileage.entries[i];var rate=Math.ceil((entry.discountSaleAmount*entry.quantity/discountSalesAmountTotal)*1000000)/1000000;if(data.mileageCurrency=="KRW"){amt=Math.floor(mileageUseableAmount*rate)}else{amt=Math.round(mileageUseableAmount*rate*100)/100}if(i==entries.length-1){amt=lastMobileMlgeUseSumAmt}if(amt>entriesMaxHurdles.get(entry.entryNumber)){amt=entriesMaxHurdles.get(entry.entryNumber)}lastMobileMlgeUseSumAmt=Math.round((lastMobileMlgeUseSumAmt-amt)*100)/100;var entryMaxHurdle=Math.round((entriesMaxHurdles.get(entry.entryNumber)-amt)*100)/100;if(typeof(entriesMaxHurdles.put)=="function"){entriesMaxHurdles.put(entry.entryNumber,entryMaxHurdle)}else{if(typeof(entriesMaxHurdles.set)=="function"){entriesMaxHurdles.set(entry.entryNumber,entryMaxHurdle)}}}});return Math.floor(totalUseableMileageAmt*100)/100}},getMaxUsableLimitMileage:function(e){var d="";if($("select[name=limitMileageIds]")){var b=$("select[name=limitMileageIds] option:selected").index();if(b>0){var f=$("select[name=limitMileageIds] option:selected").data();d+=f.entrynumbers.toString()}}if($("select[name=limitAllianceMileageIds]")){var b=$("select[name=limitAllianceMileageIds] option:selected").index();if(b>0){var f=$("select[name=limitAllianceMileageIds] option:selected").data();if(d!=""){d+=","}d+=f.entrynumbers.toString()}}var a=[];var c=d.split(",");$.each(MiniCalculator.entries,function(g,h){if($.inArray(h.entryNumber.toString(),c)>-1){a.push(h)}});return parseFloat(MiniCalculator.getGroupMileageHurdle(e,a))},getExcludeProductCodes:function(){var a=[];$.each(MiniCalculator.entries,function(b,c){if(c.brandCode=="0369"){a.push(c.productCode)}$.each(MiniCalculator.excludeMileageProducts,function(d,e){if(c.productCode==e){a.push(c.productCode)}})});return a},getExcludePrice:function(){var a=0;$.each(MiniCalculator.entries,function(b,c){if(c.brandCode=="0369"){a+=c.usdpaymentamount}$.each(MiniCalculator.excludeMileageProducts,function(d,e){if(c.productCode==e){a=MiniCalculator.calc(a,c.usdpaymentamount)}})});return a},getExcludeProductEntries:function(){var a=[];var b=[];a=MiniCalculator.getExcludeProductCodes();$.each(MiniCalculator.entries,function(c,d){$.each(a,function(e,f){if(d.productCode==f){b.push(d);return}})});return b},getBrandMileagefromExclude:function(e){var b=[];var d=[];var c=0;d=MiniCalculator.getExcludeProductEntries();$.each(MiniCalculator.duplicateMileageIds,function(f,g){$.each(d,function(h,j){if(MiniCalculator.isDupAndCategoryMileageEntry(g,j)&&($.inArray(g,b)<0)){b.push(g);var k=MiniCalculator.getUsableDuplicateMileage(g,e);if(g.amount>k){c=c+g.amount-k}return}})});var a=MiniCalculator.getDuplicateMileageBalance(b,0);if(a>0){c=c-a}return c},getDupAndCategoryMileageBalance:function(excludePrice){with(MiniCalculator){var DupAndCategoryentries=[];var DupAndCategoryBalance=[];var DuplicateMileageBalance=0;var CategoryMileageBalance=0;var excludeProductCodes=MiniCalculator.getExcludeProductCodes();$.each(MiniCalculator.entries,function(idx,entry){if(entry.productType=="05"){return}if($.inArray(entry.productCode,excludeProductCodes)<0||excludePrice==0){if(MiniCalculator.isDupAndCategoryEntry(entry)){var inputEntries=[];inputEntries.push(entry);DupAndCategoryentries.push({entry:entry,MaxMileage:MiniCalculator.getGroupMileageHurdle(0,inputEntries)})}}});DuplicateMileageBalance=getMileageBalance(MiniCalculator.duplicateMileageIds,DupAndCategoryentries);CategoryMileageBalance=getMileageBalance(MiniCalculator.categoryMileageIds,DupAndCategoryentries);DupAndCategoryBalance.push({DuplicateBalanceSum:DuplicateMileageBalance,CategoryBalanceSum:CategoryMileageBalance});return DupAndCategoryBalance}},getMileageBalance:function(c,b){var a=0;$.each(c,function(d,e){var f=0;f=e.amount;$.each(b,function(g,h){if(MiniCalculator.isDupAndCategoryMileageEntry(e,h.entry)){if(h.MaxMileage<f){f=f-h.MaxMileage;h.MaxMileage=0}else{h.MaxMileage=h.MaxMileage-f;f=0}}});a=a+f});return a},isDupAndCategoryEntry:function(entry){with(MiniCalculator){var result=false;$.each(MiniCalculator.duplicateMileageIds,function(idx,duplicateMileageId){if(MiniCalculator.isDupAndCategoryMileageEntry(duplicateMileageId,entry)){result=true;return false}});if(result){return result}$.each(MiniCalculator.categoryMileageIds,function(idx,categoryMilegeId){if(MiniCalculator.isDupAndCategoryMileageEntry(categoryMilegeId,entry)){result=true;return false}});return result}},isDupAndCategoryMileageEntry:function(MileageId,entry){with(MiniCalculator){var returnValue=false;$.each(MileageId.entries,function(idx,mileageEntry){if(mileageEntry.productCode==entry.productCode){returnValue=true;return false}});return returnValue}},applyMileage:function(amount,useAll){with(MiniCalculator){if(useAll&&ACC.customer.data.isRestrictedUseMileage){alert("该账号仅限使用立即折扣积分");useAll=false;amount=0}if(typeof(MiniCalculator.paymentMode._17)=="undefined"&&typeof(MiniCalculator.paymentMode._18)=="undefined"&&typeof(MiniCalculator.paymentMode._37)=="undefined"){return false}resetForMileageUse();amount=parseFloat(amount);data.totalAppliedUnlimitMileageUse=0;data.totalWonAppliedUnlimitMileageUse=0;var minimumPaymentAmount=parseFloat(MiniCalculator.paymentMode._17.minimumPaymentAmount);var maximumPaymentAmount;var maxPaymentAmountAbsolute=parseFloat(MiniCalculator.paymentMode._17.maxPaymentAmountAbsolute);var maxPaymentAmountPercent=parseFloat(MiniCalculator.paymentMode._17.maxPaymentAmountPercent);var _maxPaymentAmountPercent=maxPaymentAmountPercent;var _maxPaymentAmount=0;var excludePrice=0;$.each(MiniCalculator.entries,function(index,el){if(el.brandCode=="0369"){excludePrice+=el.usdpaymentamount}$.each(MiniCalculator.excludeMileageProducts,function(idx,product){if(el.productCode==product){excludePrice=calc(excludePrice,el.usdpaymentamount)}})});setUseCouponAmount();maxPaymentAmountPercent=getUnlimitMileageHurdle(excludePrice);_maxPaymentAmount=getUnlimitMileageHurdle(0);if(ACC.cart.data.isMajorGuestMember){maxPaymentAmountPercent=Math.min(maxPaymentAmountPercent,data.totalPrice-data.totalCouponDiscount-excludePrice);_maxPaymentAmount=Math.min(_maxPaymentAmount,data.totalPrice-data.totalCouponDiscount)}var avaliableExcludeDuplicateMileage=0;if(excludePrice>0){avaliableExcludeDuplicateMileage=getBrandMileagefromExclude(excludePrice)}maxPaymentAmountPercent=maxPaymentAmountPercent+avaliableExcludeDuplicateMileage;if(!isNaN(maxPaymentAmountAbsolute)){maximumPaymentAmount=maxPaymentAmountAbsolute}if(!isNaN(maxPaymentAmountPercent)){maximumPaymentAmount=maxPaymentAmountPercent}if(!isNaN(maxPaymentAmountAbsolute)&&!isNaN(maxPaymentAmountPercent)){maximumPaymentAmount=Math.min(maxPaymentAmountAbsolute,maxPaymentAmountPercent)}maximumPaymentAmount=Math.min(maximumPaymentAmount,_maxPaymentAmount);var floorBalance=0;floorBalance=maximumPaymentAmount-Math.floor(maximumPaymentAmount);maximumPaymentAmount=Math.floor(maximumPaymentAmount);if(isEmpty(amount)||isNaN(amount)||amount<0){amount=0}if(amount>data.availableUnlimtMileage){alert("优惠积分是只可使用会员折扣后金额的30%以内。\n但有些品牌的优惠积分使用条件可能不一样。\n请您参考一下商品详细信息。");amount=0}if(amount>0&&minimumPaymentAmount>amount){alert("优惠积分是只可使用会员折扣后金额的30%以内。\n但有些品牌的优惠积分使用条件可能不一样。\n请您参考一下商品详细信息。");amount=0}if(!isNaN(parseFloat(maximumPaymentAmount))&&amount+data.totalAppliedLimitMileageUse>maximumPaymentAmount){amount=maximumPaymentAmount-data.totalAppliedLimitMileageUse;if(useAll!=true){var str=maximumPaymentAmount;if(maximumPaymentAmount==maxPaymentAmountPercent){str=MiniCalculator.paymentMode._17.maxPaymentAmountPercent+"%"}alert("优惠积分是只可使用会员折扣后金额的30%以内。\n但有些品牌的优惠积分使用条件可能不一样。\n请您参考一下商品详细信息。")}}var compraeAmount=amount;if(ACC.cart.data.isMajorGuestMember){compraeAmount=amount+floorBalance}if(compraeAmount>=data.totalAppliedUnlimitMileageUse+data.totalPayment){amount=data.totalAppliedUnlimitMileageUse+data.totalPayment}if(amount>maximumPaymentAmount){maximumPaymentAmount=amount}if(amount<0){amount=0}var valid=true;var _amount=amount;if(valid){$.each(MiniCalculator.duplicateMileageIds,function(idx,el){var duplicateAmount=parseFloat(el.amount);if(amount>duplicateAmount){amount=amount-duplicateAmount}else{duplicateAmount=amount;amount=0}if(data.mileageCurrency=="USD"){data.totalAppliedUnlimitMileageUse=data.totalAppliedUnlimitMileageUse+duplicateAmount;data.totalWonAppliedUnlimitMileageUse=data.totalWonAppliedUnlimitMileageUse+toWonAmt(duplicateAmount)}else{if(data.mileageCurrency=="KRW"){data.totalAppliedUnlimitMileageUse=data.totalAppliedUnlimitMileageUse+toUsdAmt(duplicateAmount);data.totalWonAppliedUnlimitMileageUse=data.totalWonAppliedUnlimitMileageUse+duplicateAmount}}});if(amount>0){if(data.mileageCurrency=="USD"){data.totalAppliedUnlimitMileageUse=data.totalAppliedUnlimitMileageUse+amount;data.totalWonAppliedUnlimitMileageUse=toWonAmt(data.totalAppliedUnlimitMileageUse)}else{if(data.mileageCurrency=="KRW"){data.totalWonAppliedUnlimitMileageUse=data.totalWonAppliedUnlimitMileageUse+amount;data.totalAppliedUnlimitMileageUse=toUsdAmt(data.totalWonAppliedUnlimitMileageUse)}}}}else{data.totalAppliedUnlimitMileageUse=0;data.totalWonAppliedUnlimitMileageUse=0}calculatePrice();refreshUseAllCheckbox($("#maxUnlimitMileage"),parseFloat(_amount)+parseFloat(data.totalAppliedLimitMileageUse),parseFloat(data.availableUnlimtMileage)+parseFloat(data.totalAppliedLimitMileageUse),maximumPaymentAmount)}},applyLimitMileage:function(amount,allianceAmount,obj){with(MiniCalculator){resetForLimitMileageUse();setUseCouponAmount();data.appliedLimitMileages=[];var tmpMileage;if(obj!=undefined){tmpMileage=$("option:selected",obj).data()}if(typeof(tmpMileage.mileageid)!="undefined"){var valid=true;var excludePrice=getExcludePrice();var maxUsableLimitMileage=getMaxUsableLimitMileage(excludePrice);var limitMileageHurdle=round(getLimitMileageHurdle(excludePrice,tmpMileage));if(MiniCalculator.data.totalPayment<amount){alert("优惠积分是只可使用会员折扣后金额的30%以内。\n但有些品牌的优惠积分使用条件可能不一样。\n请您参考一下商品详细信息。");$("select[name=limitMileageIds]").val("");amount=0;valid=false}else{if(parseFloat(amount)>limitMileageHurdle||parseFloat(amount+allianceAmount)>maxUsableLimitMileage){alert("优惠积分是只可使用会员折扣后金额的30%以内。\n但有些品牌的优惠积分使用条件可能不一样。\n请您参考一下商品详细信息。");$("select[name=limitMileageIds]").val("");amount=0;valid=false}}if(valid==true){data.appliedLimitMileages.push(tmpMileage)}}var limitAmount=amount+allianceAmount;if(data.mileageCurrency=="USD"){data.totalAppliedLimitMileageUse=parseFloat(limitAmount);data.totalWonAppliedLimitMileageUse=toWonAmt(limitAmount);data.totalAppliedLimitAllianceMileageUse=parseFloat(allianceAmount)}else{if(data.mileageCurrency=="KRW"){data.totalWonAppliedLimitMileageUse=parseFloat(limitAmount);data.totalAppliedLimitMileageUse=toUsdAmt(limitAmount);data.totalAppliedLimitAllianceMileageUse=toUsdAmt(allianceAmount)}}calculatePrice()}},applyLimitAllianceMileage:function(amount,allianceAmount,obj){with(MiniCalculator){resetForLimitMileageUse();setUseCouponAmount();data.appliedLimitAllianceMileages=[];var tmpMileage;if(obj!=undefined){tmpMileage=$("option:selected",obj).data()}if(typeof(tmpMileage.mileageid)!="undefined"){var valid=true;var excludePrice=getExcludePrice();var maxUsableLimitMileage=getMaxUsableLimitMileage(excludePrice);var limitAllianceMileageHurdle=round(getLimitMileageHurdle(excludePrice,tmpMileage));if(MiniCalculator.data.totalPayment<allianceAmount){alert("优惠积分是只可使用会员折扣后金额的30%以内。\n但有些品牌的优惠积分使用条件可能不一样。\n请您参考一下商品详细信息。");$("select[name=limitAllianceMileageIds]").val("");allianceAmount=0;valid=false}else{if(parseFloat(allianceAmount)>limitAllianceMileageHurdle||parseFloat(amount+allianceAmount)>maxUsableLimitMileage){alert("优惠积分是只可使用会员折扣后金额的30%以内。\n但有些品牌的优惠积分使用条件可能不一样。\n请您参考一下商品详细信息。");$("select[name=limitAllianceMileageIds]").val("");allianceAmount=0;valid=false}}if(valid==true){data.appliedLimitAllianceMileages.push(tmpMileage)}}var limitAmount=amount+allianceAmount;if(data.mileageCurrency=="USD"){data.totalAppliedLimitMileageUse=parseFloat(limitAmount);data.totalWonAppliedLimitMileageUse=toWonAmt(limitAmount);data.totalAppliedLimitAllianceMileageUse=parseFloat(allianceAmount)}else{if(data.mileageCurrency=="KRW"){data.totalWonAppliedLimitMileageUse=parseFloat(limitAmount);data.totalAppliedLimitMileageUse=toUsdAmt(limitAmount);data.totalAppliedLimitAllianceMileageUse=toUsdAmt(allianceAmount)}}calculatePrice()}},resetForLimitMileageUse:function(){with(MiniCalculator){if(data.totalWonAppliedUnlimitMileageUse!=0||data.totalAppliedUsdVoucherMileageUse!=0||data.totalAppliedVoucherMileageUse!=0||data.totalAppliedMobileMileageUse!=0||data.totalAppliedShillaDepositUse!=0||data.totalAppliedShillaMoneyUse!=0||data.totalAppliedClubMileageUse!=0||data.totalAppliedSpecialSRewardUse!=0||($("#searchSpecialReward").length>0&&$("#searchSpecialReward").css("display")=="none")){if(!data.alerted){alert("请注意，先使用活动积分后，可使用优惠积分，新罗金币。");data.alerted=true}applyMobileMileage(0);applyShillaDeposit(0);applyClubMileage(0);applySpecialSReward(null);applyUsdVoucherMileage(0);applyVoucherMileage(0);applyShillaMny(0);applyMileage(0);$("#maxUnlimitMileage").attr("checked",false);$("#maxUnlimitMileage").next("label").css("background-position","0px 0px");$("#useAllShillaMoney").attr("checked",false);$("#useAllShillaMoney").next("label").css("background-position","0px 0px");$("#totalUsedUsdVoucherMileage").attr("checked",false);$("#totalUsedUsdVoucherMileage").next("label").css("background-position","0px 0px");$("#totalUsedVoucherMileage").attr("checked",false);$("#totalUsedVoucherMileage").next("label").css("background-position","0px 0px");$("#useAllShillaDeposit").attr("checked",false);$("#useAllShillaDeposit").next("label").css("background-position","0px 0px");if(isSRewardsIntgrPreOpen){$("#totalUsedClubMileage").prop("checked",false);$("#totalUsedClubMileage").next("label").css("background-position","0px 0px")}if(typeof(OnlineRewardDisable)!="undefined"){OnlineRewardDisable()}if(mobileMileageIds.length>0&&$("#mobileMileageIds").length>0){$("#mobileMileageIds option:eq(0)").prop("selected",true)}data.alerted=false}}},applyUsdVoucherMileage:function(amount,useAll){with(MiniCalculator){if(typeof(MiniCalculator.paymentMode._67)=="undefined"){return}resetForUsdVoucherMileageUse();amount=parseFloat(amount);var minimumPaymentAmount=parseFloat(MiniCalculator.paymentMode._67.minimumPaymentAmount);var maximumPaymentAmount;var maxPaymentAmountAbsolute=parseFloat(MiniCalculator.paymentMode._67.maxPaymentAmountAbsolute);var maxPaymentAmountPercent=parseFloat(MiniCalculator.paymentMode._67.maxPaymentAmountPercent);maxPaymentAmountPercent=round(maxPaymentAmountPercent*(data.totalPrice)/100);if(!isNaN(maxPaymentAmountAbsolute)){maximumPaymentAmount=maxPaymentAmountAbsolute}if(!isNaN(maxPaymentAmountPercent)){maximumPaymentAmount=maxPaymentAmountPercent}if(!isNaN(maxPaymentAmountAbsolute)&&!isNaN(maxPaymentAmountPercent)){maximumPaymentAmount=Math.min(maxPaymentAmountAbsolute,maxPaymentAmountPercent)}var totalPayment=data.totalPayment>0?data.totalPayment:0;if(isNaN(maximumPaymentAmount)||maximumPaymentAmount>totalPayment){maximumPaymentAmount=totalPayment+data.totalAppliedUsdVoucherMileageUse}if(isEmpty(amount)||isNaN(amount)||amount<0){amount=0}if(amount>data.availableUsdVoucherMileage){alert("超过可使用的金额。");amount=0}if(amount>0&&minimumPaymentAmount>amount){alert("您的订购金额需在"+minimumPaymentAmount+"韩元以上，才使用商品券转换积分。");amount=0}if(!isNaN(parseFloat(maximumPaymentAmount))&&amount>maximumPaymentAmount){amount=maximumPaymentAmount>=minimumPaymentAmount?maximumPaymentAmount:0;if(useAll!=true){alert("超过可使用的金额。")}}if(amount>data.totalAppliedUsdVoucherMileageUse+data.totalPayment){amount=data.totalAppliedUsdVoucherMileageUse+data.totalPayment}if(amount<0){amount=0}var valid=true;if(valid){data.totalAppliedUsdVoucherMileageUse=parseFloat(amount);data.totalWonAppliedUsdVoucherMileageUse=toWonAmt(data.totalAppliedUsdVoucherMileageUse)}else{data.totalAppliedUsdVoucherMileageUse=0;data.totalWonAppliedUsdVoucherMileageUse=0}calculatePrice();refreshUseAllCheckbox($("#totalUsedUsdVoucherMileage"),parseFloat(amount),data.availableUsdVoucherMileage,maximumPaymentAmount)}},applyVoucherMileage:function(amount,useAll){with(MiniCalculator){if(typeof(MiniCalculator.paymentMode._20)=="undefined"){return}resetForVoucherMileageUse();amount=parseFloat(amount);var minimumPaymentAmount=parseFloat(MiniCalculator.paymentMode._20.minimumPaymentAmount);var maximumPaymentAmount;var maxPaymentAmountAbsolute=parseFloat(MiniCalculator.paymentMode._20.maxPaymentAmountAbsolute);var maxPaymentAmountPercent=parseFloat(MiniCalculator.paymentMode._20.maxPaymentAmountPercent);maxPaymentAmountPercent=round(maxPaymentAmountPercent*(data.totalPrice)/100);if(!isNaN(maxPaymentAmountAbsolute)){maximumPaymentAmount=maxPaymentAmountAbsolute}if(!isNaN(maxPaymentAmountPercent)){maximumPaymentAmount=maxPaymentAmountPercent}if(!isNaN(maxPaymentAmountAbsolute)&&!isNaN(maxPaymentAmountPercent)){maximumPaymentAmount=Math.min(maxPaymentAmountAbsolute,maxPaymentAmountPercent)}var totalWonPayment=data.totalWonPayment>0?data.totalWonPayment:0;if(isNaN(maximumPaymentAmount)||maximumPaymentAmount>totalWonPayment){maximumPaymentAmount=totalWonPayment+data.totalWonAppliedVoucherMileageUse}if(isEmpty(amount)||isNaN(amount)||amount<0){amount=0}if(amount>data.availableVoucherMileage){alert("超过可使用的金额。");amount=0}if(amount>0&&minimumPaymentAmount>amount){alert("您的订购金额需在"+minimumPaymentAmount+"韩元以上，才使用商品券转换积分。");amount=0}if(!isNaN(parseFloat(maximumPaymentAmount))&&amount>maximumPaymentAmount){amount=maximumPaymentAmount>=minimumPaymentAmount?maximumPaymentAmount:0;if(useAll!=true){alert("超过可使用的金额。")}}if(amount>data.totalWonAppliedVoucherMileageUse+data.totalWonPayment){amount=data.totalWonAppliedVoucherMileageUse+data.totalWonPayment}if(amount<0){amount=0}var valid=true;if(valid){data.totalWonAppliedVoucherMileageUse=parseFloat(amount);data.totalAppliedVoucherMileageUse=toUsdAmt(data.totalWonAppliedVoucherMileageUse)}else{data.totalAppliedVoucherMileageUse=0;data.totalWonAppliedVoucherMileageUse=0}calculatePrice();refreshUseAllCheckbox($("#totalUsedVoucherMileage"),parseFloat(amount),data.availableVoucherMileage,maximumPaymentAmount)}},applySavedMileage:function(amount){with(MiniCalculator){updateSavedMileage();resetForMileageUse();if(data.mileageCurrency=="USD"){var totalAppliedSavedMileageAmount=convertToFomat(data.totalAppliedSavedMileageReserve,priceFormat.usd);$("#totalSavedMileageAmount3").html("[立即折扣积分] 预计累积金额  "+totalAppliedSavedMileageAmount+"");data.totalAppliedSavedMileage=parseFloat(amount);data.totalAppliedSavedMileageUse=parseFloat(amount);var totalWonAppliedSavedMileage=0;if(data.totalAppliedSavedMileage!=0){$.each(entries,function(idx,el){if(el.productType=="05"){return}totalWonAppliedSavedMileage=round(totalWonAppliedSavedMileage+round(toWonAmt(el.savedMileage)*el.quantity))})}data.totalWonAppliedSavedMileage=totalWonAppliedSavedMileage;data.totalWonAppliedSavedMileageUse=totalWonAppliedSavedMileage;data.totalWonAppliedSavedMileage=totalWonAppliedSavedMileage}else{if(data.mileageCurrency=="KRW"){var totalAppliedSavedMileageAmount=convertToFomat(data.totalWonAppliedSavedMileageReserve,priceFormat.KRW);$("#totalSavedMileageAmount3").html("[立即折扣积分] 预计累积金额  "+totalAppliedSavedMileageAmount+"");data.totalWonAppliedSavedMileage=parseFloat(amount);data.totalWonAppliedSavedMileageUse=parseFloat(amount);var totalAppliedSavedMileage=0;if(data.totalWonAppliedSavedMileage!=0){$.each(entries,function(idx,el){if(el.productType=="05"){return}totalAppliedSavedMileage=round(totalAppliedSavedMileage+round(toUsdAmt(el.savedMileage)*el.quantity,2),2)})}data.totalAppliedSavedMileage=totalAppliedSavedMileage;data.totalAppliedSavedMileageUse=totalAppliedSavedMileage}}calculatePrice()}},updateSavedMileage:function(){with(MiniCalculator){setEntrySavedMileage();resetForMileageUse();var totalWonAppliedSavedMileage=0;var totalAppliedSavedMileage=0;var totalWonAppliedSavedMileageReserve=0;var totalAppliedSavedMileageReserve=0;var totalWonAppliedEventMileage=0;var totalAppliedEventMileage=0;if(data.mileageCurrency=="USD"){$.each(MiniCalculator.entries,function(index,el){if(el.productType=="05"){return}totalWonAppliedSavedMileage=round(totalWonAppliedSavedMileage+round(toWonAmt(el.savedMileage)*el.quantity));totalAppliedSavedMileage=round(totalAppliedSavedMileage+round(el.savedMileage*el.quantity,2),2);totalWonAppliedSavedMileageReserve=round(totalWonAppliedSavedMileageReserve+round(toWonAmt(el.savedMileageReserve)*el.quantity));totalAppliedSavedMileageReserve=round(totalAppliedSavedMileageReserve+round(el.savedMileageReserve*el.quantity,2),2);totalWonAppliedEventMileage=totalWonAppliedEventMileage+round(toWonAmt(el.usedEventMileage));totalAppliedEventMileage=totalAppliedEventMileage+el.usedEventMileage})}else{if(data.mileageCurrency=="KRW"){$.each(MiniCalculator.entries,function(index,el){if(el.productType=="05"){return}totalWonAppliedSavedMileage=round(totalWonAppliedSavedMileage+round(el.savedMileage*el.quantity));totalAppliedSavedMileage=round(totalAppliedSavedMileage+round(toUsdAmt(el.savedMileage)*el.quantity,2),2);totalWonAppliedSavedMileageReserve=round(totalWonAppliedSavedMileageReserve+round(el.savedMileageReserve*el.quantity));totalAppliedSavedMileageReserve=round(totalAppliedSavedMileageReserve+round(toUsdAmt(el.savedMileageReserve)*el.quantity,2),2);totalWonAppliedEventMileage=totalWonAppliedEventMileage+el.usedEventMileage;totalAppliedEventMileage=totalAppliedEventMileage+round(toUsdAmt(el.usedEventMileage),2)})}}data.totalWonAppliedSavedMileage=totalWonAppliedSavedMileage;data.totalAppliedSavedMileage=totalAppliedSavedMileage;data.totalWonAppliedSavedMileageReserve=totalWonAppliedSavedMileageReserve;data.totalAppliedSavedMileageReserve=totalAppliedSavedMileageReserve;data.totalWonAppliedEventMileage=totalWonAppliedEventMileage;data.totalAppliedEventMileage=totalAppliedEventMileage;var totalSavedMileageUsedYn=$("input:radio[name=totalSavedMileageUsedYn]:checked").val();if(totalSavedMileageUsedYn=="Y"){data.totalWonAppliedSavedMileageUse=totalWonAppliedSavedMileage;data.totalAppliedSavedMileageUse=totalAppliedSavedMileage;data.totalWonAppliedSavedMileageReserve=totalWonAppliedSavedMileageReserve-totalWonAppliedSavedMileage;data.totalAppliedSavedMileageReserve=round(totalAppliedSavedMileageReserve-totalAppliedSavedMileage,2)}else{if(totalSavedMileageUsedYn=="N"){data.totalWonAppliedSavedMileageUse=0;data.totalAppliedSavedMileageUse=0;data.totalWonAppliedSavedMileageReserve=totalWonAppliedSavedMileageReserve;data.totalAppliedSavedMileageReserve=totalAppliedSavedMileageReserve}}if(data.mileageCurrency=="USD"){updateSavedMilageVal(totalAppliedSavedMileage)}else{if(data.mileageCurrency=="KRW"){updateSavedMilageVal(totalWonAppliedSavedMileage)}}calculatePrice()}},applyDuplicateMileage:function(amount){with(MiniCalculator){resetForMileageUse();if(MiniCalculator.data.totalPayment<amount){alert("您目前所设定的积分不适用。请确认后再次设定积分金额。");$("select[name=duplicateMileageIds]").val("");amount=0}if(data.mileageCurrency=="USD"){data.totalAppliedDuplicateMileageUse=parseFloat(amount);data.totalWonAppliedDuplicateMileageUse=toWonAmt(data.totalAppliedDuplicateMileageUse)}else{if(data.mileageCurrency=="KRW"){data.totalWonAppliedDuplicateMileageUse=parseFloat(amount);data.totalAppliedDuplicateMileageUse=toUsdAmt(data.totalWonAppliedDuplicateMileageUse)}}calculatePrice()}},applyAdditionalMileage:function(amount){with(MiniCalculator){resetForMileageUse();if(MiniCalculator.data.totalPayment<amount){alert("您目前所设定的积分不适用。请确认后再次设定积分金额。");$("select[name=additionalMileageId]").val("");amount=0}if(data.mileageCurrency=="USD"){data.totalAppliedAdditionalMileageUse=parseFloat(amount);data.totalWonAppliedAdditionalMileageUse=toWonAmt(data.totalAppliedAdditionalMileageUse)}else{if(data.mileageCurrency=="KRW"){data.totalWonAppliedAdditionalMileageUse=parseFloat(amount);data.totalAppliedAdditionalMileageUse=toUsdAmt(data.totalWonAppliedAdditionalMileageUse)}}calculatePrice()}},applyFixedrateMobileMileage:function(selectedData){with(MiniCalculator){data.totalAppliedMobileMileageUse=parseFloat(0);data.totalWonAppliedMobileMileageUse=parseFloat(0);calculatePrice();var distributes=$.ShillaCheckout.orderDistributes();var totalPaymentAmt=0;var mileageEntriesNums;if(typeof(selectedData.mileageentrynums)=="string"){mileageEntriesNums=selectedData.mileageentrynums.split(",")}else{mileageEntriesNums=selectedData.mileageentrynums.toString()}$.each(distributes,function(index,entry){if(entry.brandCode=="0369"){return true}if(typeof(mileageEntriesNums.includes)=="function"){if(mileageEntriesNums.includes(entry.entryNumber.toString())){totalPaymentAmt=round(parseFloat(totalPaymentAmt+entry.paymentUsdAmount),2)}}else{if(typeof(mileageEntriesNums)=="string"){if(mileageEntriesNums==entry.entryNumber.toString()){totalPaymentAmt=round(parseFloat(totalPaymentAmt+entry.paymentUsdAmount),2)}}if(typeof(mileageEntriesNums)=="object"){mileageEntriesNums.forEach(function(e){if(e==entry.entryNumber.toString()){totalPaymentAmt=round(parseFloat(totalPaymentAmt+entry.paymentUsdAmount),2)}})}}});var maxDcAmt=parseFloat(selectedData.offermaxdcamt);var dcRate=parseFloat(selectedData.offerpaydescval);var mobileMlgAmt=floor(totalPaymentAmt*dcRate/100,2);var applyMobileMlgAmt=Math.min(maxDcAmt,mobileMlgAmt);data.availableMobileMileage=parseFloat(applyMobileMlgAmt);applyMobileMileage()}},applyMobileMileage:function(amount,useAll){with(MiniCalculator){if(typeof(MiniCalculator.paymentMode._21)=="undefined"){return}if(typeof(amount)=="undefined"){amount=parseFloat(data.availableMobileMileage)}else{amount=parseFloat(amount)}var minimumPaymentAmount=parseInt(MiniCalculator.paymentMode._21.minimumPaymentAmount);var maximumPaymentAmount;var maxPaymentAmountAbsolute=parseInt(MiniCalculator.paymentMode._21.maxPaymentAmountAbsolute);var maxPaymentAmountPercent=parseFloat(MiniCalculator.paymentMode._21.maxPaymentAmountPercent);var excludePrice=0;$.each(MiniCalculator.entries,function(index,el){if(el.brandCode=="0369"){excludePrice+=el.usdpaymentamount}});if(!ACC.cart.data.isMajorGuestMember){maxPaymentAmountPercent=Math.floor((maxPaymentAmountPercent/100)*(data.totalPrice-data.totalCouponDiscount-excludePrice)*100)/100}else{maxPaymentAmountPercent=Math.floor((data.totalPrice-data.totalCouponDiscount-excludePrice)*100)/100}maxPaymentAmountPercent=getMobileMileageHurdle();if(!isNaN(maxPaymentAmountAbsolute)){maximumPaymentAmount=maxPaymentAmountAbsolute}if(!isNaN(maxPaymentAmountPercent)){maximumPaymentAmount=maxPaymentAmountPercent}if(!isNaN(maxPaymentAmountAbsolute)&&!isNaN(maxPaymentAmountPercent)){maximumPaymentAmount=Math.min(maxPaymentAmountAbsolute,maxPaymentAmountPercent)}var totalPayment=data.totalPayment>0?data.totalPayment:0;if(isNaN(maximumPaymentAmount)||maximumPaymentAmount>totalPayment){maximumPaymentAmount=totalPayment+data.totalAppliedMobileMileageUse}if(isEmpty(amount)||isNaN(amount)){amount=0}if(amount>data.availableMobileMileage){alert("您目前所设定的积分不适用。请确认后再次设定积分金额。 ");amount=0}if(amount>0&&minimumPaymentAmount>amount){alert("您目前所设定的积分不适用。请确认后再次设定积分金额。 ");amount=0}if(!isNaN(parseFloat(maximumPaymentAmount))&&amount>maximumPaymentAmount){if(useAll!=true){alert("您目前所设定的积分不适用。请确认后再次设定积分金额。 ")}amount=maximumPaymentAmount>=minimumPaymentAmount?maximumPaymentAmount:0}if(amount>data.totalAppliedMobileMileageUse+data.totalPayment){amount=data.totalAppliedMobileMileageUse+data.totalPayment}if(amount<0){amount=0}if(data.availableMobileMileage>amount&&amount>0){alert("您目前所设定的积分不适用。请确认后再次设定积分。");amount=0}if(data.mileageCurrency=="USD"){data.totalAppliedMobileMileageUse=parseFloat(amount);data.totalWonAppliedMobileMileageUse=toWonAmt(data.totalAppliedMobileMileageUse)}else{if(data.mileageCurrency=="KRW"){data.totalWonAppliedMobileMileageUse=parseFloat(amount);data.totalAppliedMobileMileageUse=toUsdAmt(data.totalWonAppliedMobileMileageUse)}}calculatePrice();refreshUseAllCheckbox($("#useAllMobileMileage"),parseFloat(amount),data.availableMobileMileage,maximumPaymentAmount)}},applyEventMileage:function(amount){with(MiniCalculator){resetForMileageUse();if(amount!=0){amount=$("#totalEventMileage").html().replace(/[^0-9.]/g,"")}if(data.mileageCurrency=="USD"){data.totalAppliedEventMileageUse=parseFloat(amount);data.totalWonAppliedEventMileageUse=toWonAmt(data.totalAppliedEventMileageUse)}else{if(data.mileageCurrency=="KRW"){data.totalWonAppliedEventMileageUse=parseFloat(amount);data.totalAppliedEventMileageUse=toUsdAmt(data.totalWonAppliedEventMileageUse)}}calculatePrice()}},applyClubMileage:function(amount,useAll){with(MiniCalculator){if(typeof $("#totalUsedMobileMileage2").val()!="undefined"){if($("#totalUsedMobileMileage2").val()>0){resetForMileageUse()}}if(typeof(MiniCalculator.paymentMode._52)=="undefined"){return}resetForClubMileageUse();if(isSRewardsIntgrPreOpen){amount=Math.round(parseFloat(amount)*100)/100}else{amount=Math.round(amount*100)/100/1000}if(data.availableSClubEventMileage>0){if(amount<Math.round(data.availableSClubEventMileage*100)/100){if(amount>Math.round(data.availableSClubMileage*100)/100){amount=0}}}var minimumPaymentAmount=data.sclubMileageMinimumUse;var maximumPaymentAmount;var maxPaymentAmountAbsolute=parseFloat(MiniCalculator.paymentMode._52.maxPaymentAmountAbsolute);var maxPaymentAmountPercent=parseFloat(MiniCalculator.paymentMode._52.maxPaymentAmountPercent);var totalSClubMileage=Math.round(parseFloat(data.availableSClubMileage+data.availableSClubEventMileage)*100)/100;var totalSClubMileagePoint=totalSClubMileage*1000;maxPaymentAmountPercent=Math.floor(maxPaymentAmountPercent*(data.totalPrice-data.totalCouponDiscount)*100)/100;if(!isNaN(maxPaymentAmountAbsolute)){maximumPaymentAmount=maxPaymentAmountAbsolute}if(!isNaN(maxPaymentAmountPercent)){maximumPaymentAmount=maxPaymentAmountPercent}if(!isNaN(maxPaymentAmountAbsolute)&&!isNaN(maxPaymentAmountPercent)){maximumPaymentAmount=Math.min(maxPaymentAmountAbsolute,maxPaymentAmountPercent)}var totalPayment=data.totalPayment>0?data.totalPayment:0;if(isNaN(maximumPaymentAmount)||maximumPaymentAmount>totalPayment){maximumPaymentAmount=Math.round(parseFloat(totalPayment+data.totalAppliedClubMileageUse)*100)/100}if(!isSRewardsIntgrPreOpen){if(isNaN(maximumPaymentAmount)||maximumPaymentAmount>totalSClubMileagePoint-totalSClubMileagePoint%10){maximumPaymentAmount=totalSClubMileagePoint-totalSClubMileagePoint%10}}if(isNaN(maximumPaymentAmount)||maximumPaymentAmount>data.sclubMlgeHurdleAmount){maximumPaymentAmount=data.sclubMlgeHurdleAmount;if(maximumPaymentAmount==0&&amount>0){amount=maximumPaymentAmount;if(isSRewardsIntgrPreOpen){alert("今日新罗金币使用超额或不可使用新罗金币的品牌。")}else{alert("今日中文网 S.Rewards 使用超额或不可使用中文网 S.Rewards 的品牌。")}}}if(isEmpty(amount)||isNaN(amount)){amount=0}if(amount>(totalSClubMileage)){alert("您目前所设定的积分不适用。请确认后再次设定积分金额。 ");amount=0}if(amount>0&&minimumPaymentAmount>amount){alert("您目前所设定的积分不适用。请确认后再次设定积分金额。 ");amount=0}if(!isNaN(parseFloat(maximumPaymentAmount))&&amount>maximumPaymentAmount){if(useAll!=true){alert("您目前所设定的积分不适用。请确认后再次设定积分金额。 ")}amount=maximumPaymentAmount>=minimumPaymentAmount?maximumPaymentAmount:0}if(amount>data.totalAppliedClubMileageUse+data.totalPayment){amount=Math.round(parseFloat(data.totalAppliedClubMileageUse+data.totalPayment)*100)/100}if(amount<0){amount=0}if(!isSRewardsIntgrPreOpen){if(Math.round(amount*1000)%10!=0){alert("中文网 S.Rewards 可以10Point为单位使用。");amount=0}}if(data.mileageCurrency=="USD"){data.totalAppliedClubMileageUse=parseFloat(amount);data.totalWonAppliedClubMileageUse=toWonAmt(data.totalAppliedClubMileageUse);data.totalAppliedClubMileageUsePoint=data.totalAppliedClubMileageUse*1000}else{if(data.mileageCurrency=="KRW"){data.totalWonAppliedClubMileageUse=parseFloat(amount);data.totalAppliedClubMileageUse=toUsdAmt(data.totalWonAppliedClubMileageUse);data.totalAppliedClubMileageUsePoint=data.totalAppliedClubMileageUse*1000}}calculatePrice();if(isSRewardsIntgrPreOpen){refreshUseAllCheckbox($("#totalUsedClubMileage"),parseFloat(amount),totalSClubMileage,maximumPaymentAmount)}else{refreshUseAllCheckbox($("#totalUsedOnlineReward"),parseFloat(amount),totalSClubMileage,maximumPaymentAmount)}}},applySReward:function(amount,useAll){with(MiniCalculator){if(typeof(MiniCalculator.paymentMode._50)=="undefined"){return}resetForSReward();amount=parseFloat(amount);var minimumPaymentAmount=parseFloat(MiniCalculator.paymentMode._50.minimumPaymentAmount);var maximumPaymentAmount;var maxPaymentAmountAbsolute=parseFloat(MiniCalculator.paymentMode._50.maxPaymentAmountAbsolute);var maxPaymentAmountPercent=parseFloat(MiniCalculator.paymentMode._50.maxPaymentAmountPercent);maxPaymentAmountPercent=round(maxPaymentAmountPercent*(data.totalPayment*1000)/100);if(isNaN(minimumPaymentAmount)){minimumPaymentAmount=0}if(!isNaN(maxPaymentAmountAbsolute)){maximumPaymentAmount=maxPaymentAmountAbsolute}if(!isNaN(maxPaymentAmountPercent)){maximumPaymentAmount=maxPaymentAmountPercent}if(!isNaN(maxPaymentAmountAbsolute)&&!isNaN(maxPaymentAmountPercent)){maximumPaymentAmount=Math.min(maxPaymentAmountAbsolute,maxPaymentAmountPercent)}var totalPayment=data.totalPayment>0?data.totalPayment*1000:0;if(isNaN(maximumPaymentAmount)||maximumPaymentAmount>totalPayment){maximumPaymentAmount=totalPayment+data.totalAppliedSRewardUsePoint}if(isNaN(maximumPaymentAmount)||maximumPaymentAmount>data.availableSRewardPoint-data.availableSRewardPoint%10){maximumPaymentAmount=data.availableSRewardPoint-data.availableSRewardPoint%10}if(isEmpty(amount)||isNaN(amount)||amount<0){amount=0}var rewardsText=(isSRewardsIntgrPreOpen?"Rewards Point":"S.Rewards");if(amount>data.availableSRewardPoint){alert("已输入比拥有的"+rewardsText+"更多金额。");amount=0}if(amount%10!=0){alert(rewardsText+" 可以10Point为单位使用。");amount=0}if(amount>0&&minimumPaymentAmount>amount){alert(rewardsText+" 可从最少"+convertToFomat(minimumPaymentAmount,priceFormat.KRW)+"开始使用。");amount=0}if(!isNaN(parseFloat(maximumPaymentAmount))&&amount>maximumPaymentAmount){amount=maximumPaymentAmount>=minimumPaymentAmount?maximumPaymentAmount:0;if(useAll!=true){alert(rewardsText+" 最多"+convertToFomat(maximumPaymentAmount,priceFormat.KRW)+"可使用。")}}if(amount>data.totalAppliedSRewardUsePoint+data.totalPayment*1000){amount=data.totalAppliedSRewardUsePoint+data.totalPayment*1000}if(amount<0){amount=0}var valid=true;if(valid){data.totalAppliedSRewardUse=parseFloat(amount/1000);data.totalWonAppliedSRewardUse=toWonAmt(data.totalAppliedSRewardUse);data.totalAppliedSRewardUsePoint=parseFloat(amount)}else{$("input[name=wonUseSRewardAmt]").val("0");$("input[name=usdUseSRewardAmt]").val("0");data.totalWonAppliedSRewardUse=0;data.totalAppliedSRewardUse=0;data.totalAppliedSRewardUsePoint=0}calculatePrice();refreshUseAllCheckbox($("#useAllSReward"),parseFloat(amount),data.availableSRewardPoint,maximumPaymentAmount)}},applySpecialSReward:function(sreward){with(MiniCalculator){if(typeof(MiniCalculator.paymentMode._65)=="undefined"){return}resetForSpecialRewardUse();var amount=0;var beforeAmount=0;if(sreward==null||typeof(sreward.offrid)=="undefined"){$("input[type='hidden'][name^='totalUsedSpecialSRewardId']").val("");$("input[type='hidden'][name='totalUsedSpecialSReward']").val("0");$("input[type='hidden'][name='totalUsedSpecialSRewardPoint']").val("0")}else{if(!!sreward&&typeof(sreward)!="undefined"&&typeof(sreward.offrid)!="undefined"&&typeof(sreward.offrubmg)!="undefined"){amount=parseFloat(sreward.offrubmg)/1000;beforeAmount=parseFloat($("input[type='hidden'][name='totalUsedSpecialSReward']").val());var specSRewardIdPm=sreward.offrid+"_"+sreward.offrpmdt+"_"+sreward.offrpmno;$("input[type='hidden'][name='totalUsedSpecialSRewardId']").val(specSRewardIdPm);$("input[type='hidden'][name='totalUsedSpecialSReward']").val(amount);$("input[type='hidden'][name='totalUsedSpecialSRewardPoint']").val(sreward.offrubmg)}}if(MiniCalculator.data.totalPayment+beforeAmount<amount){alert("您目前所设定的积分不适用。请确认后再次设定积分金额。");$("select[id=specialRewardIds]").val("");$("input[type='hidden'][name^='totalUsedSpecialSRewardId']").val("");$("input[type='hidden'][name='totalUsedSpecialSReward']").val("0");$("input[type='hidden'][name='totalUsedSpecialSRewardPoint']").val("0");amount=0}data.totalAppliedSpecialSRewardUse=parseFloat(amount);data.totalAppliedSpecialSRewardUsePoint=data.totalAppliedSpecialSRewardUse*1000;data.totalWonAppliedSpecialSRewardUse=toWonAmt(amount);calculatePrice()}},applyShillaMny:function(amount,useAll){with(MiniCalculator){if(typeof(MiniCalculator.paymentMode._14)=="undefined"){return}resetForShillaMoenyUse();amount=parseFloat(amount);var minimumPaymentAmount=parseFloat(MiniCalculator.paymentMode._14.minimumPaymentAmount);var maximumPaymentAmount;var maxPaymentAmountAbsolute=parseFloat(MiniCalculator.paymentMode._14.maxPaymentAmountAbsolute);var maxPaymentAmountPercent=parseFloat(MiniCalculator.paymentMode._14.maxPaymentAmountPercent);maxPaymentAmountPercent=round(maxPaymentAmountPercent*(data.totalWonPrice)/100);if(!isNaN(maxPaymentAmountAbsolute)){maximumPaymentAmount=maxPaymentAmountAbsolute}if(!isNaN(maxPaymentAmountPercent)){maximumPaymentAmount=maxPaymentAmountPercent}if(!isNaN(maxPaymentAmountAbsolute)&&!isNaN(maxPaymentAmountPercent)){maximumPaymentAmount=Math.min(maxPaymentAmountAbsolute,maxPaymentAmountPercent)}var totalWonPayment=data.totalWonPayment>0?data.totalWonPayment:0;if(isNaN(maximumPaymentAmount)||maximumPaymentAmount>totalWonPayment){maximumPaymentAmount=totalWonPayment+data.totalWonAppliedShillaMoneyUse}if(isEmpty(amount)||isNaN(amount)||amount<0){amount=0}if(amount>data.availableShillaMoney){alert("보유한 신라선불 보다 큰 금액을 입력하셨습니다.");amount=0}if(amount>0&&minimumPaymentAmount>amount){alert("신라선불은 "+convertToFomat(minimumPaymentAmount,priceFormat.KRW)+" 이상부터 사용 가능합니다.");amount=0}if(!isNaN(parseFloat(maximumPaymentAmount))&&amount>maximumPaymentAmount){amount=maximumPaymentAmount>=minimumPaymentAmount?maximumPaymentAmount:0;if(useAll!=true){alert("신라선불은 "+convertToFomat(maximumPaymentAmount,priceFormat.KRW)+" 까지 사용 가능합니다.")}}if(amount>data.totalWonAppliedShillaMoneyUse+data.totalWonPayment){amount=data.totalWonAppliedShillaMoneyUse+data.totalWonPayment}if(amount<0){amount=0}var valid=true;if(valid){data.totalWonAppliedShillaMoneyUse=parseFloat(amount);data.totalAppliedShillaMoneyUse=toUsdAmt(data.totalWonAppliedShillaMoneyUse)}else{$("input[name=wonUseShillaMnyAmt]").val("0");$("input[name=usdUseShillaMnyAmt]").val("0");data.totalWonAppliedShillaMoneyUse=0;data.totalAppliedShillaMoneyUse=0}calculatePrice();refreshUseAllCheckbox($("#useAllShillaMoney"),parseFloat(amount),data.availableShillaMoney,maximumPaymentAmount)}},applyShillaDeposit:function(amount){with(MiniCalculator){if(typeof(MiniCalculator.paymentMode._13)=="undefined"){return}amount=parseFloat(amount);var minimumPaymentAmount=parseFloat(MiniCalculator.paymentMode._13.minimumPaymentAmount);var maximumPaymentAmount;var maxPaymentAmountAbsolute=parseFloat(MiniCalculator.paymentMode._13.maxPaymentAmountAbsolute);var maxPaymentAmountPercent=parseFloat(MiniCalculator.paymentMode._13.maxPaymentAmountPercent);maxPaymentAmountPercent=round(maxPaymentAmountPercent*(data.totalWonPrice)/100);if(!isNaN(maxPaymentAmountAbsolute)){maximumPaymentAmount=maxPaymentAmountAbsolute}if(!isNaN(maxPaymentAmountPercent)){maximumPaymentAmount=maxPaymentAmountPercent}if(!isNaN(maxPaymentAmountAbsolute)&&!isNaN(maxPaymentAmountPercent)){maximumPaymentAmount=Math.min(maxPaymentAmountAbsolute,maxPaymentAmountPercent)}var totalWonPayment=data.totalWonPayment>0?data.totalWonPayment:0;if(isNaN(maximumPaymentAmount)||maximumPaymentAmount>totalWonPayment){maximumPaymentAmount=totalWonPayment+data.totalWonAppliedShillaDepositUse}if(isEmpty(amount)||isNaN(amount)||amount<0){amount=0}if(amount>data.availableShillaDeposit){alert("보유한 예치금 보다 큰 금액을 입력하셨습니다.");amount=0}if(amount>0&&minimumPaymentAmount>amount){alert("예치금은 "+convertToFomat(minimumPaymentAmount,priceFormat.KRW)+" 이상부터 사용 가능합니다.");amount=0}if(!isNaN(parseFloat(maximumPaymentAmount))&&amount>maximumPaymentAmount){amount=maximumPaymentAmount>=minimumPaymentAmount?maximumPaymentAmount:0;if(useAll!=true){alert("예치금은 "+convertToFomat(maximumPaymentAmount,priceFormat.KRW)+" 까지 사용 가능합니다.")}}if(amount>=data.totalWonAppliedShillaDepositUse+data.totalWonPayment){amount=data.totalWonAppliedShillaDepositUse+data.totalWonPayment}if(amount<0){amount=0}var valid=true;if(valid){if(data.mileageCurrency=="USD"){data.totalAppliedShillaDepositUse=parseFloat(amount);data.totalWonAppliedShillaDepositUse=toWonAmt(data.totalAppliedShillaDepositUse)}else{if(data.mileageCurrency=="KRW"){data.totalWonAppliedShillaDepositUse=parseFloat(amount);data.totalAppliedShillaDepositUse=toUsdAmt(data.totalWonAppliedShillaDepositUse)}}}else{data.totalAppliedShillaDepositUse=0;data.totalWonAppliedShillaDepositUse=0}calculatePrice();refreshUseAllCheckbox($("#useAllShillaDeposit"),parseFloat(amount),data.availableShillaDeposit,maximumPaymentAmount)}},applyOlleh:function(ollehInfo){with(MiniCalculator){var amount=0;var temp=data.totalWonAppliedOllehPointUse;if(typeof(ollehInfo)!=null&&ollehInfo!=null){amount=(data.totalWonPayment-data.totalWonAppliedOllehPointUse)*ollehInfo.dcRate;if(amount>ollehInfo.dcLimitAmt){amount=ollehInfo.dcLimitAmt}data.totalWonAppliedOllehPointUse=parseFloat(amount);data.totalAppliedOllehPointUse=toUsdAmt(amount);data.appliedOllehInfo=ollehInfo}else{data.totalWonAppliedOllehPointUse=0;data.totalAppliedOllehPointUse=0;data.appliedOllehInfo=null}if(temp!=data.totalWonAppliedOllehPointUse){calculatePrice()}}},applyOCB:function(type,amount){with(MiniCalculator){amount=parseFloat(amount);if(isEmpty(amount)||isNaN(amount)){amount=0}if(amount>data.availableOkCashBack){alert("사용가능한금액을 넘었습니다.");amount=0}if(amount>data.totalWonAppliedOkCashBackUse+data.totalWonPayment){amount=data.totalWonAppliedOkCashBackUse+data.totalWonPayment}if(amount<0){amount=0}if(type=="01"||type=="03"){data.totalWonAppliedOkCashBackUse=parseFloat(amount);data.totalAppliedOkCashBackUse=toUsdAmt(amount)}else{data.totalWonAppliedOkCashBackUse=0;data.totalAppliedOkCashBackUse=0}calculatePrice()}},applyOPoint:function(type,amount){with(MiniCalculator){amount=parseFloat(amount);if(isEmpty(amount)||isNaN(amount)){amount=0}if(amount>data.availableOPoint){alert("사용가능한금액을 넘었습니다.");amount=0}if(amount>data.totalWonAppliedOhPointUse+data.totalWonPayment){amount=data.totalWonAppliedOhPointUse+data.totalWonPayment}if(amount<0){amount=0}if(amount>0&&amount%10!=0){alert("오포인트는 10포인트 단위로 사용 가능합니다.");amount=parseInt(amount/10)*10}if(type=="01"||type=="03"){data.totalWonAppliedOhPointUse=parseFloat(amount);data.totalAppliedOhPointUse=toUsdAmt(amount)}else{data.totalWonAppliedOhPointUse=0;data.totalAppliedOhPointUse=0}calculatePrice()}},applyHappyMoney:function(happyMoneyInfo){with(MiniCalculator){var amount=happyMoneyInfo.amount;if(typeof(happyMoneyInfo)!=null&&happyMoneyInfo!=null){data.totalWonAppliedHappyMoneyUse=parseFloat(amount);data.totalAppliedHappyMoneyUse=toUsdAmt(amount);data.appliedHappyMoneyInfo=happyMoneyInfo}else{data.totalAppliedHappyMoneyUse=0;data.totalWonAppliedHappyMoneyUse=0;data.appliedHappyMoneyInfo=null}calculatePrice()}},setEntrySavedMileage:function(){with(MiniCalculator){var cartCouponEntrySum=0;var cartWonCouponEntrySum=0;var additionalCouponEntrySum=0;var additionalWonCouponEntrySum=0;var cartCouponApplyCount=0;var additionalCouponApplyCount=0;$.each(MiniCalculator.entries,function(index,el){var discountUnit=0;var wonDiscountUnit=0;for(i=0;i<data.appliedProductCoupons.length;i++){if(el.productCode==data.appliedProductCoupons[i].productcode){discountUnit=round(parseFloat(data.appliedProductCoupons[i].discountamount/el.quantity),2);wonDiscountUnit=round(parseFloat(data.appliedProductCoupons[i].wondiscountamount/el.quantity));break}}var cartCouponUnit=0;var cartWonCouponUnit=0;if(data.totalCartCouponUse>0&&data.totalWonCartCouponUse>0){var entryCount=data.appliedCartCouponCount;var prodArrs=data.appliedCartCoupon.dcprodlist.split(",");var rateTotal=0;var rate=0;$.each(MiniCalculator.entries,function(index,el1){$.each(prodArrs,function(idx1,pl1){if(pl1!=""&&pl1==el1.entryNumber){rateTotal=rateTotal+(el1.discountSaleAmount*el1.quantity)}})});$.each(prodArrs,function(idx,pl){if(pl!=""&&pl==el.entryNumber){rate=getEntryRate(el.discountSaleAmount,el.quantity,rateTotal);if(cartCouponApplyCount===entryCount-1){cartCouponUnit=round((data.totalCartCouponUse-cartCouponEntrySum)/el.quantity,2);cartWonCouponUnit=round((data.totalWonCartCouponUse-cartWonCouponEntrySum)/el.quantity)}else{var cartCouponEntry=Math.round(data.totalCartCouponUse*rate*100)/100;var cartWonCouponEntry=round(data.totalWonCartCouponUse*rate);cartCouponEntrySum=calc(cartCouponEntrySum,cartCouponEntry);cartWonCouponEntrySum=calc(cartWonCouponEntrySum,cartWonCouponEntry);cartCouponUnit=round(cartCouponEntry/el.quantity,2);cartWonCouponUnit=round(cartWonCouponEntry/el.quantity)}cartCouponApplyCount=cartCouponApplyCount+1}})}var additionalCouponUnit=0;var additionalWonCouponUnit=0;if(data.totalAdditionalCouponUse>0&&data.totalWonAdditionalCouponUse>0){var entryCount=data.appliedAdditionalCouponCount;var prodArrs=data.appliedAdditionalCoupon.dcprodlist.split(",");var rateTotal=0;var rate=0;$.each(MiniCalculator.entries,function(index,el1){$.each(prodArrs,function(idx1,pl1){if(pl1!=""&&pl1==el1.entryNumber){rateTotal=rateTotal+(el1.discountSaleAmount*el1.quantity)}})});$.each(prodArrs,function(idx,pl){if(pl!=""&&pl==el.entryNumber){rate=getEntryRate(el.discountSaleAmount,el.quantity,rateTotal);if(additionalCouponApplyCount===entryCount-1){additionalCouponUnit=round((data.totalAdditionalCouponUse-additionalCouponEntrySum)/el.quantity,2);additionalWonCouponUnit=round((data.totalWonAdditionalCouponUse-additionalWonCouponEntrySum)/el.quantity)}else{var additionalCouponEntry=Math.round(data.totalAdditionalCouponUse*rate*100)/100;var additionalWonCouponEntry=round(data.totalWonAdditionalCouponUse*rate);additionalCouponEntrySum=calc(additionalCouponEntrySum,additionalCouponEntry);additionalWonCouponEntrySum=calc(additionalWonCouponEntrySum,additionalWonCouponEntry);additionalCouponUnit=round(additionalCouponEntry/el.quantity,2);additionalWonCouponUnit=round(additionalWonCouponEntry/el.quantity)}additionalCouponApplyCount=additionalCouponApplyCount+1}})}var excludeEventMileage=false;$.each(MiniCalculator.excludeMileageProducts,function(idx,product){if(el.productCode==product){excludeEventMileage=true;return false}});el.discountUnit=discountUnit;el.cartCouponUnit=cartCouponUnit;el.additionalCouponUnit=additionalCouponUnit;var eventMileageDcRate=0;if($("#eventMileageDcRate"+el.entryNumber).length>0){eventMileageDcRate=$("#eventMileageDcRate"+el.entryNumber).val()}if(data.mileageCurrency=="USD"){if(ACC.cart.data.isMajorGuestMember&&discountUnit==0&&cartCouponUnit==0&&additionalCouponUnit==0){el.savedMileage=el.oriSavedMileage;el.savedMileageReserve=el.oriSavedMileage}else{el.savedMileage=round((el.discountSaleAmount-discountUnit-cartCouponUnit-additionalCouponUnit)*(el.mileageRate/100),2);el.savedMileageReserve=round((el.discountSaleAmount-discountUnit-cartCouponUnit-additionalCouponUnit)*(el.mileageReserveRate/100),2)}if(isNumber(eventMileageDcRate)&&(el.brandCode!="0369"&&!excludeEventMileage)){el.usedEventMileage=round((el.discountSaleAmount-discountUnit-cartCouponUnit-additionalCouponUnit)*(eventMileageDcRate/100),2)*el.quantity}else{el.usedEventMileage=0}}else{if(data.mileageCurrency=="KRW"){if(ACC.cart.data.isMajorGuestMember&&discountUnit==0&&cartCouponUnit==0&&additionalCouponUnit==0){el.savedMileage=el.oriSavedMileage;el.savedMileageReserve=el.oriSavedMileage}else{el.savedMileage=getDigitAmount(toWonAmt(el.discountSaleAmount-discountUnit-cartCouponUnit-additionalCouponUnit)*(el.mileageRate/100),0);el.savedMileageReserve=getDigitAmount(toWonAmt(el.discountSaleAmount-discountUnit-cartCouponUnit-additionalCouponUnit)*(el.mileageReserveRate/100),0)}if(isNumber(eventMileageDcRate)&&(el.brandCode!="0369"&&!excludeEventMileage)){el.usedEventMileage=getDigitAmount(toWonAmt(el.discountSaleAmount-discountUnit-cartCouponUnit-additionalCouponUnit)*(eventMileageDcRate/100),0)*el.quantity}else{el.usedEventMileage=0}}}})}},getEntryRate:function(a,d,c){var b=Math.ceil(a*d/c*1000000)/1000000;return b},adjustAmount:function(recalulate){with(MiniCalculator){var changed=false;if(data.totalPayment==0&&data.totalWonPayment!=0){data.totalWonAdjustAmount=data.totalWonPayment;data.totalAdjustAmount=0;data.totalWonPayment=0;changed=true}else{if(data.totalPayment!=0&&data.totalWonPayment==0){data.totalWonAdjustAmount=0;data.totalAdjustAmount=data.totalPayment;data.totalPayment=0;changed=true}else{data.totalAdjustAmount=0;data.totalWonAdjustAmount=0}}if((typeof(recalulate)=="undefined"||!recalulate)&&changed){recalulate=true;calculatePrice(recalulate)}}},getAvailableAmount:function(g,d,c,j){var f=0;var h=parseFloat(g.minimumPaymentAmount);var b;var e=parseFloat(g.maxPaymentAmountAbsolute);var k=parseFloat(g.maxPaymentAmountPercent);var a=parseFloat(g.maxPaymentAmountMonthly);if(g.currency="KRW"){b=MiniCalculator.data.totalWonPayment+c}else{if(g.currency="USD"){b=MiniCalculator.data.totalPayment+c}}k=Math.floor(k*(MiniCalculator.data.totalWonPayment+c)/100);if(!isNaN(e)){b=e}if(!isNaN(k)){b=k}if(!isNaN(e)&&!isNaN(k)){b=Math.min(e,k)}if(!isNaN(a)){b=Math.min(a,b)}if(!isNaN(h)&&h>d){return 0}if(!isNaN(b)&&b<d){if(!isNaN(h)&&h>b){return 0}return MiniCalculator.getDigitAmount(b,j)}if(g.currency="KRW"){if(d>MiniCalculator.data.totalWonPayment+c){d=MiniCalculator.data.totalWonPayment+c}}else{if(g.currency="USD"){if(d>MiniCalculator.data.totalPayment+c){d=MiniCalculator.data.totalPayment+c}}}return MiniCalculator.getDigitAmount(d,j)},getDigitAmount:function(b,c){if(typeof(c)!="undefined"&&!isNaN(c)){c=parseInt(c);var a=Math.floor(b/Math.pow(10,c))*Math.pow(10,c);return a}return b},getDigitAmount:function(c,d,b){if(typeof(d)!="undefined"&&!isNaN(d)){d=parseInt(d);var a=0;if(b==true){a=Math.ceil(c/Math.pow(10,d))*Math.pow(10,d)}else{a=Math.floor(c/Math.pow(10,d))*Math.pow(10,d)}return a}return c},updateSavedMilageVal:function(amount){with(MiniCalculator){$("#totalSavedMileageUsedY").data("totalsavedmilage",amount);$("#totalSavedMileage").text("("+convertToFomat(data.totalWonAppliedSavedMileage,priceFormat.KRW)+")")}},validatePayment:function(d,b){if(!isEmpty(d.minimumPaymentAmount)){var a=parseFloat(d.minimumPaymentAmount);if(a>b){return false}}if(!isEmpty(d.maximumPaymentAmount)){var c=parseFloat(d.maximumPaymentAmount);if(d.isMaximumLimitAbsolute=="false"){c=MiniCalculator.data.totalPayment*c}if(c<b){return false}}return true},convertToCent:function(b,a){return MiniCalculator.round(b*Math.pow(10,a))},convertToFomat:function(e,g){var d=e.toString();var c=d.lastIndexOf(".");var f=g.centsLimit;if(c!=-1){f=d.length-c-1}else{f=0}if(g.centsLimit<f){f=g.centsLimit}var a=$.extend({},g);a.centsLimit=f;var b=$('<input type="text"></input>');b.val(MiniCalculator.convertToCent(e,a.centsLimit)).priceFormat(a);return b.val()},toUsdAmt:function(b){var a=MiniCalculator.exchangeRate.KRW;return MiniCalculator.round(b/a,2)},toWonAmt:function(c){var b=MiniCalculator.exchangeRate.KRW;var a=c*b;a=MiniCalculator.round(a,6);return parseInt(a)},round:function(b,a){if(!a){return Math.round(b)}return Math.round(round(b*Math.pow(10,parseInt(a,10)),a))/Math.pow(10,parseInt(a,10))},calc:function(){var a=0;var c=100;for(var b=0;b<arguments.length;b++){a+=arguments[b]*c}return(a/c)},refreshUseAllCheckbox:function(c,b,a,d){var e=false;if(!isNaN(d)&&a>d){if(b>0){if(b==d){e=true}else{if(MiniCalculator.data.totalWonPayment==0&&b<=d){e=true}}}}else{if(b==a&&b>0){e=true}}if(e){$(c).prop("checked",true)}else{$(c).prop("checked",false);$(c).next("label").css("background-position","0px 0px")}},refreshPage:function(){with(MiniCalculator){var usd=priceFormat.usd;var prodCoupons=[];if(typeof(data.appliedProductCoupons)!="undefined"&&data.appliedProductCoupons!=null){for(i=0;i<data.appliedProductCoupons.length;i++){prodCoupons.push(data.appliedProductCoupons[i].productcode+"|"+data.appliedProductCoupons[i].couponid)}$("#orderForm").find("input[name=prodCouponIds]").val(prodCoupons.join(","))}else{$("#orderForm").find("input[name=prodCouponIds]").val("")}if(typeof(data.appliedCartCoupon)!="undefined"&&data.appliedCartCoupon!=null){$("#orderForm").find("input[name=cartCouponId]").val(data.appliedCartCoupon.couponid)}else{$("#orderForm").find("input[name=cartCouponId]").val("")}$("#totalCouponDiscountAmount").text(convertToFomat(data.totalCouponDiscount,usd));$("#totalMileageUseAmount").text(convertToFomat(data.totalAppliedMileageUse,usd));$("#totalSavedMileageAmount").text(convertToFomat(data.totalAppliedSavedMileage,usd));$("#totalSavedMileageAmount1").text(convertToFomat(data.totalAppliedSavedMileage,usd));$("#totalUsedEventMileage1").text(convertToFomat(data.totalAppliedEventMileageUse,usd));$("#totalUnlimitMileageAmount").text(convertToFomat(data.totalAppliedUnlimitMileageUse,usd));$("#totalUnlimitMileageAmount1").text(convertToFomat(data.totalAppliedUnlimitMileageUse,usd));$("#totalDuplicateMileageAmount").text(convertToFomat(data.totalAppliedDuplicateMileageUse,usd));$("#totalUseAddtionalMileageAmount").text(convertToFomat(data.totalAppliedAdditionalMileageUse,usd));$("#totalUseMobileMileageAmount").text(convertToFomat(data.totalAppliedMobileMileageUse,usd));$("#totalUseSRewardAmount").text(convertToFomat(data.totalAppliedSRewardUsePoint,priceFormat.KRWWithoutSymbol)+"P("+convertToFomat(data.totalAppliedSRewardUse,priceFormat.usd)+")");$("#totalUseUsdVoucherMileageAmount").text(convertToFomat(data.totalAppliedUsdVoucherMileageUse,usd));$("#totalUseVoucherMileageAmount").text(convertToFomat(data.totalAppliedVoucherMileageUse,usd));if(isSRewardsIntgrPreOpen){$("#totalUseClubMileageAmount").text(convertToFomat(data.totalAppliedClubMileageUse,usd))}else{$("#totalUseOnlineRewardAmount").text(convertToFomat(data.totalAppliedClubMileageUsePoint+data.totalAppliedSpecialSRewardUsePoint,priceFormat.KRWWithoutSymbol)+"P("+convertToFomat(data.totalAppliedClubMileageUse+data.totalAppliedSpecialSRewardUse,priceFormat.usd)+")")}$("#spanUseShillaMnyAmt").text(data.totalWonAppliedShillaMoneyUse);$("#spanOnlineDiscountAmount").text(convertToFomat(data.totalWonBasisDiscount,usd));$("#spanUseCouponAmount").text(convertToFomat(data.totalCouponDiscount,usd));$("#spanUseMileageAmount").text(convertToFomat(data.totalWonAppliedMileageUse,usd));$("#spanUseUsdVoucherMileageAmount").text(convertToFomat(data.totalAppliedUsdVoucherMileageUse,usd));$("#spanUseVoucherMileageAmount").text(convertToFomat(data.totalAppliedVoucherMileageUse,usd));if(isSRewardsIntgrPreOpen){$("#spanUseClubMileageAmount").text(convertToFomat(data.totalAppliedClubMileageUse,priceFormat.usd));$("#usedClubMileage").val(data.totalAppliedClubMileageUse)}else{$("#spanUseOnlineRewardAmount").text(convertToFomat(data.totalAppliedClubMileageUsePoint+data.totalAppliedSpecialSRewardUsePoint,priceFormat.KRWWithoutSymbol)+"P("+convertToFomat(data.totalAppliedClubMileageUse+data.totalAppliedSpecialSRewardUse,priceFormat.usd)+")");$("#usedOnlineReward").val(data.totalAppliedClubMileageUsePoint)}$("#usedUsdVoucherMileage").val(data.totalAppliedUsdVoucherMileageUse);$("#usedVoucherMileage").val(data.totalWonAppliedVoucherMileageUse);$("#spanUseSRewardAmount").text(convertToFomat(data.totalAppliedSRewardUsePoint,priceFormat.KRWWithoutSymbol)+"P("+convertToFomat(data.totalAppliedSRewardUse,priceFormat.usd)+")");$("#totalUsedSReward2").val(data.totalAppliedSRewardUsePoint);$("#spanUseShillaMoneyAmount").text(convertToFomat(data.totalWonAppliedShillaMoneyUse,usd));$("#spanUseShillaDepositAmount").text(convertToFomat(data.totalWonAppliedShillaDepositUse,usd));$("#spanUseOkCashBackAmount").text(convertToFomat(data.totalWonAppliedOkCashBackUse,usd));$("#spanUseHappyMoneyAmount").text(convertToFomat(data.totalWonAppliedHappyMoneyUse,usd));$("#spanUseOhPointAmount").text(convertToFomat(data.totalWonAppliedOhPointUse,usd));$("#spanUseOllehAmount").text(convertToFomat(data.totalWonAppliedOllehPointUse,usd));$("#totalUsedMobileMileage2").val(data.totalAppliedMobileMileageUse);$("#useMobileMileageAmountSumBox span").text(convertToFomat(data.totalAppliedMobileMileageUse,usd));$("#spanUseMobileMileageAmount").text(convertToFomat(data.totalAppliedMobileMileageUse,usd));$("#usedMobileMileage").val(data.totalAppliedMobileMileageUse);$("#spanUseAddtionalMileageAmount").text(convertToFomat(data.totalAppliedAdditionalMileageUse,usd));$("#spanDuplicateMileageAmount").text(convertToFomat(data.totalAppliedDuplicateMileageUse,usd));$("#totalLimitMileageAmount").text(convertToFomat(data.totalAppliedLimitMileageUse-data.totalAppliedLimitAllianceMileageUse,usd));$("#totalLimitMileageAmount1").text(convertToFomat(data.totalAppliedLimitMileageUse,usd));$("#totalLimitAllianceMileageAmount").text(convertToFomat(data.totalAppliedLimitAllianceMileageUse,usd));if(data.totalAppliedSavedMileageReserve<=0){$("#totalSavedMileageAmount3").hide();if(data.totalAppliedSavedClubMileage<=0){$("#savedMileageTooltip").hide()}}else{$("#totalSavedMileageAmount3").show();$("#savedMileageTooltip").show()}if(data.appliedHappyMoneyInfo!=null){$("#availableHappyMoneyAmount").text(convertToFomat(data.appliedHappyMoneyInfo.availableAmount,usd))}else{$("#availableHappyMoneyAmount").text("0")}if(data.availableOPoint>0){$("#availableOhPointAmount").text(convertToFomat(data.availableOPoint,usd));$("input[name='opntTypeCode']").each(function(){$(this).attr("disabled",false)})}else{$("#availableOhPointAmount").text("0");$("input[name=opntTypeCode]").each(function(){$(this).attr("disabled",true)})}if(data.availableOkCashBack>0){$("#availableOcbAmount").text(convertToFomat(data.availableOkCashBack,usd));$("input[name='ocbTypeCode']").each(function(){$(this).attr("disabled",false)})}else{$("#availableOhPointAmount").text("0");$("input[name=ocbTypeCode]").each(function(){$(this).attr("disabled",true)})}$("input[name='totalUsedUnlimitMileage']").val(data.totalAppliedUnlimitMileageUse);$("input[name='totalUsedLimitMileage']").val(data.totalAppliedLimitMileageUse);$("input[name='totalUsedDuplicateMileage']").val(data.totalAppliedDuplicateMileageUse);$("input[name='totalUsedAdditionalMileage']").val(data.totalAppliedAdditionalMileageUse);$("input[name='totalUsedMobileMileage']").val(data.totalAppliedMobileMileageUse);$("input[name='totalUsedSReward']").val(data.totalAppliedSRewardUse);$("input[name='totalUsedSRewardPoint']").val(data.totalAppliedSRewardUsePoint);$("input[name='totalUsedUsdVoucherMileage']").val(data.totalAppliedUsdVoucherMileageUse);$("input[name='totalUsedVoucherMileage']").val(data.totalWonAppliedVoucherMileageUse);$("input[name='totalSavedMileage']").val(data.totalAppliedSavedMileageUse);$("input[name='totalUsedEventMileage']").val(data.totalAppliedEventMileageUse);$("input[name='totalUsedBasicClubMileage']").val(data.totalAppliedClubMileageUse);$("input[name='totalUsedClubMileage']").val(data.totalAppliedClubMileageUse);$("#totalUsableSavedMileage").html(convertToFomat(data.totalAppliedSavedMileage,priceFormat.usd));$("#totalSavedMileageReserve").html(convertToFomat(data.totalAppliedSavedMileageReserve,priceFormat.usd));$("#totalUsedUnlimitMileage2").val(convertToFomat(data.totalWonAppliedUnlimitMileageUse,priceFormat.usdWithoutSymbol));$("#totalMobileMileage").text(convertToFomat(getMobileMileageHurdle(),priceFormat.usdWithoutSymbol));if($("#maxUnlimitMileage").is(":checked")&&(data.totalWonPayment!=0&&data.totalAppliedUnlimitMileageUse!=data.availableUnlimtMileage)){$("#maxUnlimitMileage").removeAttr("checked");$("#maxUnlimitMileage").next("label").css("background-position","0 0px")}if($("#totalUsedUsdVoucherMileage").is(":checked")&&(data.totalPayment!=0&&data.totalAppliedUsdVoucherMileageUse!=data.availableUsdVoucherMileage)){$("#totalUsedUsdVoucherMileage").removeAttr("checked");$("#totalUsedUsdVoucherMileage").next("label").css("background-position","0 0px")}if($("#totalUsedVoucherMileage").is(":checked")&&(data.totalWonPayment!=0&&data.totalWonAppliedVoucherMileageUse!=data.availableVoucherMileage)){$("#totalUsedVoucherMileage").removeAttr("checked");$("#totalUsedVoucherMileage").next("label").css("background-position","0 0px")}if($("#useAllShillaMoney").is(":checked")&&(data.totalWonPayment!=0&&data.totalWonAppliedShillaMoneyUse!=data.availableShillaMoney)){$("#useAllShillaMoney").removeAttr("checked");$("#useAllShillaMoney").next("label").css("background-position","0 0px")}if($("#useAllShillaDeposit").is(":checked")&&(data.totalWonPayment!=0&&data.totalWonAppliedShillaDepositUse!=data.availableShillaDeposit)){$("#useAllShillaDeposit").removeAttr("checked");$("#useAllShillaDeposit").next("label").css("background-position","0 0px")}if(isSRewardsIntgrPreOpen){if($("#totalUsedClubMileage").is(":checked")&&(data.totalWonPayment!=0&&data.totalAppliedClubMileageUse!=data.sclubMlgeHurdleAmount)){$("#totalUsedClubMileage").removeAttr("checked");$("#totalUsedClubMileage").next("label").css("background-position","0 0px")}}else{if($("#totalUsedOnlineReward").is(":checked")&&(data.totalWonPayment!=0&&data.totalAppliedClubMileageUse!=data.sclubMlgeHurdleAmount)){$("#totalUsedOnlineReward").removeAttr("checked");$("#totalUsedOnlineReward").next("label").css("background-position","0 0px")}}$("#totalDiscountAmount").text("-"+convertToFomat(data.totalDiscount,usd));$("#totalWonDiscountAmount").html(convertToFomat(data.totalWonDiscount,priceFormat.usd)+" <em>"+parseInt(data.totalDiscount/(data.totalPayment+data.totalDiscount)*100)+"%↓</em>");$("#totalDiscountAmount2").text(convertToFomat(data.totalDiscount,usd));$("#totalWonDiscountAmount2").text("("+convertToFomat(data.totalWonDiscount,usd)+")");$("#totalPaymentAmount").text(convertToFomat(data.totalPayment,usd));$("#totalWonPaymentAmount").text(convertToFomat(data.totalWonPayment,usd));$("#totalPaymentAmount2").text(convertToFomat(data.totalPayment,usd));$("#totalWonPaymentAmount2").text("("+convertToFomat(data.totalWonPayment,usd)+")");$("input[name='totalCouponDiscount']").val(data.totalCouponDiscount);$("input[name='totalProductCouponDiscount']").val(data.totalProductCouponUse);$("input[name='totalOrderCouponDiscount']").val(data.totalOrderCouponDiscount);$("input[name='usdPaySumAmt']").val(data.totalPayment);$("input[name='wonPaySumAmt']").val(data.totalWonPayment);$("input[name='totalUsdPaymentAmount']").val(data.totalPayment);$("input[name='totalWonPaymentAmount']").val(data.totalWonPayment);var totalPaymentAmount=convertToFomat(data.totalPayment,usd);var totalWonPaymentAmount=convertToFomat(data.totalWonPayment,priceFormat.KRW);var totalCNYPaymentAmount=convertToFomat(data.totalCnyPayment,priceFormat.CNY);$("#totalPaymentAmount3").text("("+totalWonPaymentAmount+" / "+totalCNYPaymentAmount+")");$("#totalBasisDiscount").text(convertToFomat(data.totalBasisDiscount,usd));if(data.totalBasisDiscount>0){$("#totalBasisDiscount").parent().show()}else{$("#totalBasisDiscount").parent().hide()}if(data.totalCouponDiscount>0){$("#totalCouponDiscountAmount").parent().show()}else{$("#totalCouponDiscountAmount").parent().hide()}if(data.totalAppliedMileageUse>0){$("#totalMileageUseAmount").parent().show()}else{$("#totalMileageUseAmount").parent().hide()}if(data.totalAppliedUsdVoucherMileageUse>0){$("#totalUseUsdVoucherMileageAmount").parent().show()}else{$("#totalUseUsdVoucherMileageAmount").parent().hide()}if(data.totalAppliedVoucherMileageUse>0){$("#totalUseVoucherMileageAmount").parent().show()}else{$("#totalUseVoucherMileageAmount").parent().hide()}if(data.totalAppliedSRewardUse>0){$("#totalUseSRewardAmount").parent().show()}else{$("#totalUseSRewardAmount").parent().hide()}if(isSRewardsIntgrPreOpen){if(data.totalAppliedClubMileageUse>0){$("#totalUseClubMileageAmount").parent().show()}else{$("#totalUseClubMileageAmount").parent().hide()}}else{if(data.totalAppliedClubMileageUse>0||data.totalAppliedSpecialSRewardUse>0){$("#totalUseOnlineRewardAmount").parent().show()}else{$("#totalUseOnlineRewardAmount").parent().hide()}}}},displayTotalPaymentAmount:function(c,a,d){var b=c+"<span>"+a+"/"+d+"</span>";$("#totalPaymentAmount").html(b)},bindExchangeRateCalculatorKey:function(){$("#exchangeRateCalcultorInput").keyup(function(event){with(MiniCalculator){var usdAmount=$(this).val();if($.isNumeric(usdAmount)){var amount=parseFloat(usdAmount);$("#exchangeRateCalcultorKRWSpan").text(convertToFomat(exchange(amount,exchangeRate.KRW),priceFormat.usd))}else{$(this).val("");$("#exchangeRateCalcultorKRWSpan").text("")}return false}})},numberCheck:function(a){var b=/[^0-9\.]/gi;return a.replace(b,"")},numberCheck2:function(a){var b=/\D/g;return a.replace(b,"")},bindSavedMileageEvent:function(){$("#totalSavedMileageUsedY").click(function(event){var amount=$(this).data().totalsavedmilage;with(MiniCalculator){applySavedMileage(amount)}});$("#totalSavedMileageUsedN").click(function(event){var amount=$(this).data().totalsavedmilage;with(MiniCalculator){applySavedMileage(amount)}})},bindInputBoxEvent:function(){var keyTimeoutInterval=3000;$("#totalUsedUnlimitMileage2").keyup(function(event){with(MiniCalculator){if($(this).val()!=numberCheck($(this).val())){$(this).val(numberCheck($(this).val()))}var self=this;if(self.timer){clearTimeout(self.timer)}self.timer=setTimeout(function(){self.timer=null;var amount=numberCheck($("#totalUsedUnlimitMileage2").val());applyMileage(amount)},keyTimeoutInterval)}});$("#totalUsedMobileMileage2").keyup(function(event){with(MiniCalculator){if($(this).val()!=numberCheck($(this).val())){$(this).val(numberCheck($(this).val()))}var self=this;if(self.timer){clearTimeout(self.timer)}self.timer=setTimeout(function(){self.timer=null;var amount=numberCheck($("#totalUsedMobileMileage2").val());applyMobileMileage(amount)},keyTimeoutInterval)}});$("#totalUsedSReward2").keyup(function(event){with(MiniCalculator){if($(this).val()!=numberCheck($(this).val())){$(this).val(numberCheck($(this).val()))}var self=this;if(self.timer){clearTimeout(self.timer)}self.timer=setTimeout(function(){self.timer=null;var amount=numberCheck($("#totalUsedSReward2").val());MiniCalculator.applySReward(amount)},keyTimeoutInterval)}});$("#totalUsedUsdVoucherMileage2").keyup(function(event){with(MiniCalculator){if($(this).val()!=numberCheck($(this).val())){$(this).val(numberCheck($(this).val()))}var self=this;if(self.timer){clearTimeout(self.timer)}self.timer=setTimeout(function(){self.timer=null;var amount=numberCheck($("#totalUsedUsdVoucherMileage2").val());applyUsdVoucherMileage(amount)},keyTimeoutInterval)}});$("#totalUsedVoucherMileage2").keyup(function(event){with(MiniCalculator){if($(this).val()!=numberCheck($(this).val())){$(this).val(numberCheck($(this).val()))}var self=this;if(self.timer){clearTimeout(self.timer)}self.timer=setTimeout(function(){self.timer=null;var amount=numberCheck($("#totalUsedVoucherMileage2").val());applyVoucherMileage(amount)},keyTimeoutInterval)}});$("#totalUsedShillaDeposit2").keyup(function(event){with(MiniCalculator){if($(this).val()!=numberCheck($(this).val())){$(this).val(numberCheck($(this).val()))}var self=this;if(self.timer){clearTimeout(self.timer)}self.timer=setTimeout(function(){self.timer=null;var amount=numberCheck($("#totalUsedShillaDeposit2").val());applyShillaDeposit(amount)},keyTimeoutInterval)}});$("#totalUsedOcb2").keyup(function(event){with(MiniCalculator){if($(this).val()!=numberCheck($(this).val())){$(this).val(numberCheck($(this).val()))}var self=this;if(self.timer){clearTimeout(self.timer)}self.timer=setTimeout(function(){self.timer=null;var amount=numberCheck($("#totalUsedOcb2").val());applyOCB($("input[name=ocbTypeCode]:checked").val(),amount)},keyTimeoutInterval)}});$("#totalUsedOhPoint2").keyup(function(event){with(MiniCalculator){if($(this).val()!=numberCheck($(this).val())){$(this).val(numberCheck($(this).val()))}var self=this;if(self.timer){clearTimeout(self.timer)}self.timer=setTimeout(function(){self.timer=null;var amount=numberCheck($("#totalUsedOhPoint2").val());applyOPoint($("input[name=opntTypeCode]:checked").val(),amount)},keyTimeoutInterval)}});$("#discountInfo input[type=text]").on("focusin",function(){if($(this).val()=="0"){$(this).val("")}});$("#discountInfo input[type=text]").on("focusout",function(){if($(this).val()==""){$(this).val("0")}});$("#totalUsedUnlimitMileage2").on("focusout",function(){with(MiniCalculator){if(this.timer){clearTimeout(this.timer)}$(this).val(numberCheck($(this).val()));if($(this).val().lastIndexOf(".")!=($(this).val().length-1)){$(this).val(convertToFomat(parseFloat($(this).val()),priceFormat.usdWithoutSymbol))}var amount=numberCheck($(this).val());applyMileage(amount)}});$("#totalUsedMobileMileage2").on("focusout",function(){with(MiniCalculator){if(this.timer){clearTimeout(this.timer)}$(this).val(numberCheck($(this).val()));if($(this).val().lastIndexOf(".")!=($(this).val().length-1)){$(this).val(convertToFomat(parseFloat($(this).val()),priceFormat.usdWithoutSymbol))}var amount=numberCheck($(this).val());applyMobileMileage(amount)}});$("#totalUsedUsdVoucherMileage2").on("focusout",function(){with(MiniCalculator){if(this.timer){clearTimeout(this.timer)}$(this).val(numberCheck($(this).val()));if($(this).val().lastIndexOf(".")!=($(this).val().length-1)){$(this).val(convertToFomat(parseFloat($(this).val()),priceFormat.usdWithoutSymbol))}var amount=numberCheck($(this).val());applyUsdVoucherMileage(amount)}});$("#totalUsedVoucherMileage2").on("focusout",function(){with(MiniCalculator){if(this.timer){clearTimeout(this.timer)}$(this).val(numberCheck($(this).val()));if($(this).val().lastIndexOf(".")!=($(this).val().length-1)){$(this).val(convertToFomat(parseFloat($(this).val()),priceFormat.usdWithoutSymbol))}var amount=numberCheck($(this).val());applyVoucherMileage(amount)}});$("#totalUsedShillaDeposit2").on("focusout",function(){with(MiniCalculator){if(this.timer){clearTimeout(this.timer)}$(this).val(numberCheck($(this).val()));if($(this).val().lastIndexOf(".")!=($(this).val().length-1)){$(this).val(convertToFomat(parseFloat($(this).val()),priceFormat.usdWithoutSymbol))}var amount=numberCheck($(this).val());applyShillaDeposit(amount)}});$("#totalUsedOcb2").on("focusout",function(){with(MiniCalculator){if(this.timer){clearTimeout(this.timer)}$(this).val(numberCheck($(this).val()));if($(this).val().lastIndexOf(".")!=($(this).val().length-1)){$(this).val(convertToFomat(parseFloat($(this).val()),priceFormat.usdWithoutSymbol))}var amount=numberCheck($(this).val());applyOCB($("input[name=ocbTypeCode]:checked").val(),amount)}});$("#totalUsedOhPoint2").on("focusout",function(){with(MiniCalculator){if(this.timer){clearTimeout(this.timer)}$(this).val(numberCheck($(this).val()));if($(this).val().lastIndexOf(".")!=($(this).val().length-1)){$(this).val(convertToFomat(parseFloat($(this).val()),priceFormat.usdWithoutSymbol))}var amount=numberCheck($(this).val());applyOPoint($("input[name=opntTypeCode]:checked").val(),amount)}});$("#totalUsedClubMileage2").on("focusout",function(){with(MiniCalculator){if(this.timer){clearTimeout(this.timer)}$(this).val(numberCheck($(this).val()));if($(this).val().lastIndexOf(".")!=($(this).val().length-1)){$(this).val(convertToFomat(parseFloat($(this).val()),priceFormat.usdWithoutSymbol))}var amount=numberCheck($(this).val());applyClubMileage(amount)}})},bindAll:function(){with(MiniCalculator){bindInputBoxEvent();bindExchangeRateCalculatorKey();bindSavedMileageEvent()}},expectedSaveClubMileage:function(){if(MiniCalculator.data.expectedSClubMileage==null||MiniCalculator.data.expectedSClubMileage==false){return}var distributes=$.ShillaCheckout.orderDistributes();with(MiniCalculator){data.totalAppliedSavedClubMileage=0;if(distributes!=null){$.each(distributes,function(index,el){data.totalAppliedSavedClubMileage=Math.round((data.totalAppliedSavedClubMileage+el.savedClubMileage)*100)/100})}if(data.totalAppliedSavedClubMileage>0){$("#spanTotalSavedClubMileageDiv").show();var totalAppliedSavedClubMileage=convertToFomat(data.totalAppliedSavedClubMileage,priceFormat.usd);$("#totalSavedClubMileageAmount3").html(""+totalAppliedSavedClubMileage+"");$("#totalSavedClubMileageAmount3").show();var totalAppliedSavedClubMileagePoint=convertToFomat(data.totalAppliedSavedClubMileage*1000,priceFormat.KRWWithoutSymbol);$("#totalSavedOnlineReward3").html(""+totalAppliedSavedClubMileagePoint+"P");$("#totalSavedOnlineReward3").show();$("#savedMileageTooltip").show()}else{$("#spanTotalSavedClubMileageDiv").hide();$("#totalSavedClubMileageAmount3").hide();$("#totalSavedOnlineReward3").hide();if(data.totalAppliedSavedMileageReserve<=0){$("#savedMileageTooltip").hide()}}calculatorClubMielageHurdle(distributes)}},calculatorClubMielageHurdle:function(distributes){with(MiniCalculator){data.sclubMlgeHurdleAmount=0;if(distributes!=null){$.each(distributes,function(index,el){var entrySClubMileageHurdle=0;if(MiniCalculator.excludeSClubMileageProducts.indexOf(el.productCode)==-1){if(data.sclubMlgeHurdleRate>0){entrySClubMileageHurdle=Math.round(el.netAmount*data.sclubMlgeHurdleRate)/100;if(entrySClubMileageHurdle>(el.paymentUsdAmount+el.usedClubMileage)){entrySClubMileageHurdle=el.paymentUsdAmount+el.usedClubMileage}data.sclubMlgeHurdleAmount=Math.round((data.sclubMlgeHurdleAmount+entrySClubMileageHurdle)*100)/100}else{data.sclubMlgeHurdleAmount=Math.round((data.sclubMlgeHurdleAmount+el.paymentUsdAmount)*100)/100}}});if(data.sclubMlgeHurdleRate<=0){data.sclubMlgeHurdleAmount=Math.round((data.sclubMlgeHurdleAmount+data.totalAppliedClubMileageUse)*100)/100}}else{data.sclubMlgeHurdleAmount=data.sclubMlgeUseOrderLimitAmt}data.sclubMlgeHurdleAmount=data.sclubMlgeHurdleAmount>data.sclubMlgeUseOrderLimitAmt?data.sclubMlgeUseOrderLimitAmt:data.sclubMlgeHurdleAmount}}};$(document).ready(function(){$("#totalUnlimitAvailMileageAmount3").hide()});